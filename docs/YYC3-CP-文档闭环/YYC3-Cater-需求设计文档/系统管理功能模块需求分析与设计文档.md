# YYC³餐饮管理系统 - 系统管理功能模块需求分析与设计文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 系统管理功能模块需求分析与设计文档 |
| 文档版本 | V1.0.0 |
| 创建日期 | 2025-01-20 |
| 作者 | YYC³团队 |
| 文档状态 | 正式发布 |

## 1. 概述

### 1.1 模块简介

系统管理模块是YYC³餐饮管理系统的核心管理模块，负责管理系统的用户、角色、权限、部门、系统设置和审计日志等功能。该模块为系统管理员提供完整的系统管理能力，确保系统的安全性、可维护性和可扩展性。

### 1.2 模块目标

- 提供完整的用户生命周期管理
- 实现灵活的角色和权限管理
- 支持组织架构的部门管理
- 提供系统配置和参数管理
- 记录和审计所有系统操作
- 确保系统安全和数据完整性

### 1.3 适用范围

本模块适用于YYC³餐饮管理系统的所有版本，包括单店版和连锁版。

## 2. 功能需求

### 2.1 用户管理

#### 2.1.1 用户列表

**功能描述**：展示系统中所有用户的基本信息，支持搜索、筛选和分页。

**输入参数**：
- 关键词：用户名、真实姓名、邮箱、手机号
- 用户状态：活跃、未激活、锁定
- 角色：按角色筛选
- 部门：按部门筛选
- 页码：当前页码
- 每页数量：每页显示数量

**输出结果**：
- 用户列表：包含用户基本信息
- 总数：符合条件的用户总数

**字段说明**：
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 用户ID |
| username | string | 是 | 用户名 |
| email | string | 是 | 邮箱 |
| phone | string | 是 | 手机号 |
| realName | string | 是 | 真实姓名 |
| avatar | string | 否 | 头像URL |
| status | string | 是 | 用户状态：active/inactive/locked |
| roleIds | array | 是 | 角色ID列表 |
| departmentId | string | 否 | 部门ID |
| lastLoginAt | string | 否 | 最后登录时间 |
| createdAt | string | 是 | 创建时间 |
| updatedAt | string | 是 | 更新时间 |

#### 2.1.2 新增用户

**功能描述**：创建新的系统用户。

**输入参数**：
- 用户名：唯一标识
- 邮箱：唯一标识
- 手机号：唯一标识
- 密码：初始密码
- 真实姓名：用户真实姓名
- 角色列表：用户拥有的角色
- 部门：用户所属部门

**验证规则**：
- 用户名：4-20位字母数字下划线
- 邮箱：标准邮箱格式
- 手机号：11位数字
- 密码：6-20位，包含字母和数字
- 真实姓名：2-20位中文字符
- 角色列表：至少选择一个角色

**业务规则**：
- 用户名、邮箱、手机号必须唯一
- 新用户默认状态为活跃
- 自动记录创建时间和创建人
- 发送欢迎邮件通知用户

#### 2.1.3 编辑用户

**功能描述**：修改用户的基本信息。

**输入参数**：
- 用户ID：要编辑的用户ID
- 用户名：可修改
- 邮箱：可修改
- 手机号：可修改
- 密码：可选，不修改则留空
- 真实姓名：可修改
- 角色列表：可修改
- 部门：可修改
- 用户状态：可修改

**验证规则**：
- 用户名、邮箱、手机号修改后必须唯一
- 密码修改需符合密码规则
- 角色列表至少选择一个角色

**业务规则**：
- 记录修改时间和修改人
- 状态修改需要确认
- 密码修改后强制下次登录时修改密码

#### 2.1.4 删除用户

**功能描述**：删除指定的用户。

**输入参数**：
- 用户ID：要删除的用户ID

**业务规则**：
- 删除前需要二次确认
- 不能删除当前登录用户
- 不能删除系统管理员用户
- 删除后用户数据保留30天
- 记录删除操作到审计日志

#### 2.1.5 重置密码

**功能描述**：重置用户密码。

**输入参数**：
- 用户ID：要重置密码的用户ID
- 新密码：6-20位

**业务规则**：
- 需要管理员权限
- 重置后发送密码重置邮件
- 强制用户下次登录时修改密码
- 记录密码重置操作

#### 2.1.6 锁定/解锁用户

**功能描述**：锁定或解锁用户账号。

**输入参数**：
- 用户ID：要操作的用户ID

**业务规则**：
- 锁定后用户无法登录
- 解锁后用户可以正常登录
- 记录锁定/解锁操作
- 锁定原因需要记录到审计日志

### 2.2 角色管理

#### 2.2.1 角色列表

**功能描述**：展示系统中所有角色的基本信息，支持搜索、筛选和分页。

**输入参数**：
- 关键词：角色名、角色编码
- 角色状态：活跃、未激活
- 页码：当前页码
- 每页数量：每页显示数量

**输出结果**：
- 角色列表：包含角色基本信息
- 总数：符合条件的角色总数

**字段说明**：
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 角色ID |
| name | string | 是 | 角色名称 |
| code | string | 是 | 角色编码 |
| description | string | 否 | 角色描述 |
| permissions | array | 是 | 权限ID列表 |
| status | string | 是 | 角色状态：active/inactive |
| createdAt | string | 是 | 创建时间 |
| updatedAt | string | 是 | 更新时间 |

#### 2.2.2 新增角色

**功能描述**：创建新的系统角色。

**输入参数**：
- 角色名称：角色显示名称
- 角色编码：唯一标识
- 角色描述：角色说明
- 权限列表：角色拥有的权限

**验证规则**：
- 角色名称：2-20位中文字符
- 角色编码：2-20位字母数字下划线
- 权限列表：至少选择一个权限

**业务规则**：
- 角色编码必须唯一
- 新角色默认状态为活跃
- 自动记录创建时间和创建人

#### 2.2.3 编辑角色

**功能描述**：修改角色的基本信息。

**输入参数**：
- 角色ID：要编辑的角色ID
- 角色名称：可修改
- 角色编码：可修改
- 角色描述：可修改
- 权限列表：可修改
- 角色状态：可修改

**验证规则**：
- 角色编码修改后必须唯一
- 权限列表至少选择一个权限

**业务规则**：
- 记录修改时间和修改人
- 权限修改后立即生效

#### 2.2.4 删除角色

**功能描述**：删除指定的角色。

**输入参数**：
- 角色ID：要删除的角色ID

**业务规则**：
- 删除前需要二次确认
- 不能删除系统默认角色
- 不能删除仍有用户使用的角色
- 记录删除操作到审计日志

### 2.3 部门管理

#### 2.3.1 部门列表

**功能描述**：展示系统中所有部门的基本信息，支持搜索和筛选。

**输入参数**：
- 关键词：部门名、部门编码
- 部门状态：活跃、未激活

**输出结果**：
- 部门列表：包含部门基本信息

**字段说明**：
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 部门ID |
| name | string | 是 | 部门名称 |
| code | string | 是 | 部门编码 |
| parentId | string | 否 | 上级部门ID |
| leaderId | string | 否 | 部门负责人ID |
| description | string | 否 | 部门描述 |
| sort | number | 是 | 排序号 |
| status | string | 是 | 部门状态：active/inactive |
| createdAt | string | 是 | 创建时间 |
| updatedAt | string | 是 | 更新时间 |

#### 2.3.2 新增部门

**功能描述**：创建新的系统部门。

**输入参数**：
- 部门名称：部门显示名称
- 部门编码：唯一标识
- 上级部门：可选
- 部门负责人：可选
- 部门描述：部门说明
- 排序号：显示顺序

**验证规则**：
- 部门名称：2-20位中文字符
- 部门编码：2-20位字母数字下划线
- 排序号：非负整数

**业务规则**：
- 部门编码必须唯一
- 不能形成循环依赖
- 新部门默认状态为活跃

#### 2.3.3 编辑部门

**功能描述**：修改部门的基本信息。

**输入参数**：
- 部门ID：要编辑的部门ID
- 部门名称：可修改
- 部门编码：可修改
- 上级部门：可修改
- 部门负责人：可修改
- 部门描述：可修改
- 排序号：可修改
- 部门状态：可修改

**验证规则**：
- 部门编码修改后必须唯一
- 不能形成循环依赖

**业务规则**：
- 记录修改时间和修改人

#### 2.3.4 删除部门

**功能描述**：删除指定的部门。

**输入参数**：
- 部门ID：要删除的部门ID

**业务规则**：
- 删除前需要二次确认
- 不能删除仍有子部门的部门
- 不能删除仍有用户的部门
- 记录删除操作到审计日志

### 2.4 系统设置

#### 2.4.1 设置列表

**功能描述**：展示系统中所有可配置的设置项。

**字段说明**：
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 设置ID |
| key | string | 是 | 设置键 |
| value | string | 是 | 设置值 |
| type | string | 是 | 值类型：string/number/boolean/json |
| category | string | 是 | 设置分类 |
| description | string | 否 | 设置描述 |
| isPublic | boolean | 是 | 是否公开 |
| updatedAt | string | 是 | 更新时间 |

#### 2.4.2 更新设置

**功能描述**：修改系统设置项的值。

**输入参数**：
- 设置键：要修改的设置键
- 设置值：新的设置值

**业务规则**：
- 记录修改时间和修改人
- 关键设置修改需要管理员权限
- 记录修改操作到审计日志

### 2.5 审计日志

#### 2.5.1 日志列表

**功能描述**：展示系统中所有操作日志，支持搜索、筛选和分页。

**输入参数**：
- 用户ID：按用户筛选
- 操作类型：按操作筛选
- 模块：按模块筛选
- 操作状态：成功、失败
- 开始时间：操作开始时间
- 结束时间：操作结束时间
- 页码：当前页码
- 每页数量：每页显示数量

**输出结果**：
- 日志列表：包含日志详细信息
- 总数：符合条件的日志总数

**字段说明**：
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | string | 是 | 日志ID |
| userId | string | 是 | 用户ID |
| username | string | 是 | 用户名 |
| action | string | 是 | 操作类型 |
| module | string | 是 | 操作模块 |
| resource | string | 是 | 操作资源 |
| resourceId | string | 否 | 资源ID |
| ip | string | 是 | IP地址 |
| userAgent | string | 是 | 用户代理 |
| status | string | 是 | 操作状态：success/failure |
| errorMessage | string | 否 | 错误信息 |
| createdAt | string | 是 | 操作时间 |

#### 2.5.2 导出日志

**功能描述**：导出审计日志到Excel文件。

**输入参数**：
- 开始时间：导出开始时间
- 结束时间：导出结束时间
- 用户ID：按用户筛选
- 操作类型：按操作筛选
- 模块：按模块筛选

**业务规则**：
- 导出需要管理员权限
- 导出文件命名包含时间戳
- 记录导出操作到审计日志

## 3. 非功能需求

### 3.1 性能需求

- 用户列表加载时间 < 1秒
- 角色列表加载时间 < 1秒
- 部门列表加载时间 < 1秒
- 审计日志列表加载时间 < 2秒
- 支持至少10,000个用户
- 支持至少1,000个角色
- 支持至少500个部门
- 审计日志保留至少1年

### 3.2 安全需求

- 所有操作需要身份认证
- 敏感操作需要二次确认
- 密码加密存储
- 审计日志不可篡改
- 支持操作权限控制
- 支持数据访问权限控制
- 定期备份关键数据

### 3.3 可用性需求

- 系统可用性 ≥ 99.9%
- 支持多浏览器访问
- 支持移动端访问
- 提供友好的错误提示
- 提供操作帮助文档

### 3.4 可维护性需求

- 代码结构清晰
- 模块化设计
- 完善的日志记录
- 完善的错误处理
- 支持热更新
- 支持配置管理

## 4. 技术设计

### 4.1 技术栈

- 前端框架：Vue 3 + TypeScript
- UI组件库：Element Plus
- 状态管理：Pinia
- 路由管理：Vue Router
- HTTP客户端：Axios
- 表单验证：Zod
- 图表库：ECharts
- 构建工具：Vite

### 4.2 数据库设计

#### 用户表（users）

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|--------|------|
| id | varchar(36) | PRIMARY KEY | 用户ID |
| username | varchar(50) | UNIQUE | 用户名 |
| email | varchar(100) | UNIQUE | 邮箱 |
| phone | varchar(20) | UNIQUE | 手机号 |
| password | varchar(255) | NOT NULL | 密码哈希 |
| real_name | varchar(50) | NOT NULL | 真实姓名 |
| avatar | varchar(255) | NULL | 头像URL |
| status | varchar(20) | NOT NULL | 用户状态 |
| department_id | varchar(36) | FOREIGN KEY | 部门ID |
| created_at | timestamp | NOT NULL | 创建时间 |
| updated_at | timestamp | NOT NULL | 更新时间 |

#### 角色表（roles）

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|--------|------|
| id | varchar(36) | PRIMARY KEY | 角色ID |
| name | varchar(50) | NOT NULL | 角色名称 |
| code | varchar(50) | UNIQUE | 角色编码 |
| description | text | NULL | 角色描述 |
| status | varchar(20) | NOT NULL | 角色状态 |
| created_at | timestamp | NOT NULL | 创建时间 |
| updated_at | timestamp | NOT NULL | 更新时间 |

#### 部门表（departments）

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|--------|------|
| id | varchar(36) | PRIMARY KEY | 部门ID |
| name | varchar(50) | NOT NULL | 部门名称 |
| code | varchar(50) | UNIQUE | 部门编码 |
| parent_id | varchar(36) | FOREIGN KEY | 上级部门ID |
| leader_id | varchar(36) | FOREIGN KEY | 部门负责人ID |
| description | text | NULL | 部门描述 |
| sort | int | NOT NULL | 排序号 |
| status | varchar(20) | NOT NULL | 部门状态 |
| created_at | timestamp | NOT NULL | 创建时间 |
| updated_at | timestamp | NOT NULL | 更新时间 |

#### 审计日志表（audit_logs）

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|--------|------|
| id | varchar(36) | PRIMARY KEY | 日志ID |
| user_id | varchar(36) | FOREIGN KEY | 用户ID |
| action | varchar(50) | NOT NULL | 操作类型 |
| module | varchar(50) | NOT NULL | 操作模块 |
| resource | varchar(100) | NOT NULL | 操作资源 |
| resource_id | varchar(36) | NULL | 资源ID |
| ip | varchar(50) | NOT NULL | IP地址 |
| user_agent | varchar(500) | NOT NULL | 用户代理 |
| status | varchar(20) | NOT NULL | 操作状态 |
| error_message | text | NULL | 错误信息 |
| created_at | timestamp | NOT NULL | 操作时间 |

### 4.3 API设计

#### 用户管理API

```
GET    /api/system/users          # 获取用户列表
GET    /api/system/users/:id      # 获取用户详情
POST   /api/system/users          # 创建用户
PUT    /api/system/users/:id      # 更新用户
DELETE /api/system/users/:id      # 删除用户
POST   /api/system/users/:id/reset-password  # 重置密码
POST   /api/system/users/:id/lock          # 锁定用户
POST   /api/system/users/:id/unlock        # 解锁用户
```

#### 角色管理API

```
GET    /api/system/roles          # 获取角色列表
GET    /api/system/roles/:id      # 获取角色详情
POST   /api/system/roles          # 创建角色
PUT    /api/system/roles/:id      # 更新角色
DELETE /api/system/roles/:id      # 删除角色
```

#### 部门管理API

```
GET    /api/system/departments          # 获取部门列表
GET    /api/system/departments/tree     # 获取部门树
GET    /api/system/departments/:id      # 获取部门详情
POST   /api/system/departments          # 创建部门
PUT    /api/system/departments/:id      # 更新部门
DELETE /api/system/departments/:id      # 删除部门
```

#### 系统设置API

```
GET    /api/system/settings          # 获取设置列表
GET    /api/system/settings/:key    # 获取设置详情
PUT    /api/system/settings/:key    # 更新设置
PUT    /api/system/settings/batch  # 批量更新设置
```

#### 审计日志API

```
GET    /api/system/audit-logs          # 获取审计日志列表
GET    /api/system/audit-logs/:id      # 获取审计日志详情
GET    /api/system/audit-logs/export   # 导出审计日志
```

### 4.4 权限设计

#### 权限列表

| 权限编码 | 权限名称 | 模块 | 类型 |
|---------|---------|------|------|
| system:user:read | 查看用户 | system | menu |
| system:user:create | 创建用户 | system | button |
| system:user:update | 编辑用户 | system | button |
| system:user:delete | 删除用户 | system | button |
| system:user:reset-password | 重置密码 | system | button |
| system:user:lock | 锁定用户 | system | button |
| system:role:read | 查看角色 | system | menu |
| system:role:create | 创建角色 | system | button |
| system:role:update | 编辑角色 | system | button |
| system:role:delete | 删除角色 | system | button |
| system:department:read | 查看部门 | system | menu |
| system:department:create | 创建部门 | system | button |
| system:department:update | 编辑部门 | system | button |
| system:department:delete | 删除部门 | system | button |
| system:setting:read | 查看设置 | system | menu |
| system:setting:update | 修改设置 | system | button |
| system:audit:read | 查看审计日志 | system | menu |
| system:audit:export | 导出审计日志 | system | button |

## 5. 界面设计

### 5.1 用户管理界面

- 用户列表表格
- 搜索和筛选工具栏
- 新增用户按钮
- 操作按钮（编辑、删除、重置密码、锁定/解锁）
- 用户详情对话框
- 分页组件

### 5.2 角色管理界面

- 角色列表表格
- 搜索和筛选工具栏
- 新增角色按钮
- 操作按钮（编辑、删除）
- 角色详情对话框
- 权限选择树
- 分页组件

### 5.3 部门管理界面

- 部门列表表格
- 搜索和筛选工具栏
- 新增部门按钮
- 操作按钮（编辑、删除）
- 部门详情对话框
- 分页组件

### 5.4 系统设置界面

- 设置列表表格
- 设置编辑组件（根据类型显示不同的编辑器）
- 分类筛选

### 5.5 审计日志界面

- 日志列表表格
- 搜索和筛选工具栏
- 导出日志按钮
- 日志详情对话框
- 分页组件

## 6. 测试计划

### 6.1 单元测试

- 用户管理功能测试
- 角色管理功能测试
- 部门管理功能测试
- 系统设置功能测试
- 审计日志功能测试

### 6.2 集成测试

- 用户CRUD操作测试
- 角色权限分配测试
- 部门层级关系测试
- 系统设置更新测试
- 审计日志记录测试

### 6.3 性能测试

- 大数据量加载测试
- 并发操作测试
- 响应时间测试

### 6.4 安全测试

- 权限控制测试
- SQL注入测试
- XSS攻击测试
- CSRF攻击测试

## 7. 部署计划

### 7.1 开发环境

- 部署时间：2025-01-20
- 部署方式：本地开发环境
- 测试范围：功能测试

### 7.2 测试环境

- 部署时间：2025-01-25
- 部署方式：CI/CD自动部署
- 测试范围：集成测试、性能测试、安全测试

### 7.3 生产环境

- 部署时间：2025-02-01
- 部署方式：蓝绿部署
- 测试范围：冒烟测试

## 8. 附录

### 8.1 术语表

| 术语 | 说明 |
|------|------|
| 用户 | 系统的使用者 |
| 角色 | 权限的集合，分配给用户 |
| 权限 | 对系统资源的操作权限 |
| 部门 | 组织架构的基本单位 |
| 审计日志 | 记录系统操作历史的日志 |
| 系统设置 | 系统的可配置参数 |

### 8.2 参考文档

- YYC³餐饮管理系统总体设计文档
- YYC³餐饮管理系统数据库设计文档
- YYC³餐饮管理系统API文档
- YYC³餐饮管理系统安全规范

### 8.3 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| V1.0.0 | 2025-01-20 | 初始版本 | YYC³团队 |

---

**文档结束**
