# 厨房管理功能模块开发文档

## 模块概述

厨房管理模块是YYC³餐饮行业智能化平台的核心运营模块，提供厨房任务管理、员工分配、效率监控等功能。该模块采用Vue 3 + TypeScript + Element Plus技术栈，使用Pinia进行状态管理。

## 技术架构

### 1. 技术栈
- **前端框架**: Vue 3.4+ (Composition API)
- **UI组件库**: Element Plus 2.4+
- **图表库**: ECharts 5.4+
- **状态管理**: Pinia 2.1+
- **路由管理**: Vue Router 4.2+
- **HTTP客户端**: Fetch API
- **类型检查**: TypeScript 5.3+
- **构建工具**: Vite 5.4+

### 2. 目录结构
```
src/
├── views/
│   └── KitchenManagement.vue          # 厨房管理主页面
├── components/
│   └── Kitchen/
│       ├── KitchenEfficiency.vue       # 厨房效率分析组件
│       ├── KitchenTaskAssignment.vue   # 厨房任务分配组件
│       ├── KitchenTaskDetail.vue      # 厨房任务详情组件
│       ├── KitchenStaffManagement.vue # 厨房员工管理组件
│       ├── KitchenSchedule.vue        # 厨房排班管理组件
│       ├── KitchenEquipment.vue       # 厨房设备管理组件
│       ├── KitchenInventory.vue       # 厨房库存管理组件
│       └── __tests__/
│           ├── KitchenEfficiency.test.ts
│           ├── KitchenTaskAssignment.test.ts
│           ├── KitchenTaskDetail.test.ts
│           ├── KitchenStaffManagement.test.ts
│           ├── KitchenSchedule.test.ts
│           ├── KitchenEquipment.test.ts
│           └── KitchenInventory.test.ts
├── api/
│   └── kitchen.ts                   # 厨房管理API接口
├── stores/
│   └── kitchen.ts                   # 厨房状态管理
└── types/
    └── kitchen.ts                   # 厨房类型定义
```

## 核心组件

### 1. KitchenEfficiency组件

#### 1.1 组件说明
厨房效率分析组件，提供厨房运营效率的全面分析，包括时间趋势、完成量、岗位对比等。

#### 1.2 核心功能
- 效率指标展示
- 订单处理时间趋势图
- 任务完成量趋势图
- 各岗位效率对比图
- 高峰时段分析图
- 效率分析报告
- 优化建议

#### 1.3 效率指标
```typescript
interface EfficiencyMetrics {
  preparationTime: string
  completionRate: string
  onTimeRate: string
  efficiencyScore: string
}
```

### 2. KitchenTaskAssignment组件

#### 2.1 组件说明
厨房任务分配组件，提供任务的智能分配功能，支持拖拽分配、批量分配等操作。

#### 2.2 核心功能
- 员工列表展示
- 待分配任务列表
- 已分配任务展示
- 拖拽分配
- 手动分配
- 批量分配
- 任务筛选
- 员工统计

#### 2.3 分配规则
- 优先分配给岗位匹配的员工
- 考虑员工当前任务数量
- 考虑任务优先级
- 考虑员工技能等级

## API接口

### 1. 任务管理接口

#### 1.1 获取任务列表
```typescript
interface GetTasksParams {
  station?: string
  status?: string
  priority?: string
  search?: string
  page: number
  pageSize: number
}

interface GetTasksResponse {
  success: boolean
  data: {
    tasks: Task[]
    total: number
  }
}

export function getTasks(params: GetTasksParams): Promise<GetTasksResponse>
```

#### 1.2 获取任务详情
```typescript
export function getTaskDetail(taskId: number): Promise<{
  success: boolean
  data: Task
}>
```

#### 1.3 创建任务
```typescript
interface CreateTaskRequest {
  orderId: number
  itemId: number
  itemName: string
  quantity: number
  station: string
  priority: string
  tableNumber?: string
  estimatedTime?: number
}

export function createTask(data: CreateTaskRequest): Promise<{
  success: boolean
  data: Task
}>
```

#### 1.4 更新任务状态
```typescript
export function updateTaskStatus(taskId: number, status: string): Promise<{
  success: boolean
  data: Task
}>
```

#### 1.5 分配任务
```typescript
export function assignTask(taskId: number, staffId: number, options?: {
  priority?: string
  note?: string
}): Promise<{
  success: boolean
  data: Task
}>
```

#### 1.6 取消分配任务
```typescript
export function unassignTask(taskId: number, staffId: number): Promise<{
  success: boolean
  message: string
}>
```

### 2. 员工管理接口

#### 2.1 获取员工列表
```typescript
export function getKitchenStaff(): Promise<{
  success: boolean
  data: Staff[]
}>
```

#### 2.2 添加员工
```typescript
interface CreateStaffRequest {
  name: string
  phone: string
  role: string
  station: string
  skillLevel: string
}

export function createStaff(data: CreateStaffRequest): Promise<{
  success: boolean
  data: Staff
}>
```

#### 2.3 更新员工
```typescript
export function updateStaff(staffId: number, data: Partial<CreateStaffRequest>): Promise<{
  success: boolean
  data: Staff
}>
```

#### 2.4 删除员工
```typescript
export function deleteStaff(staffId: number): Promise<{
  success: boolean
  message: string
}>
```

### 3. 效率分析接口

#### 3.1 获取效率数据
```typescript
interface EfficiencyDataParams {
  startDate: string
  endDate: string
}

interface EfficiencyData {
  averagePreparationTime: number
  averageCompletionTime: number
  completionRate: number
  onTimeRate: number
  overdueTasks: number
  cancelledTasks: number
  peakHours: string
  efficiencyScore: number
  preparationTimeTrend: Array<{ date: string; value: number }>
  completionTrend: Array<{ date: string; value: number }>
  stationEfficiency: Array<{ station: string; value: number }>
  peakHoursData: Array<{ hour: string; value: number }>
}

export function getEfficiencyData(params: EfficiencyDataParams): Promise<{
  success: boolean
  data: EfficiencyData
}>
```

### 4. 排班管理接口

#### 4.1 获取排班列表
```typescript
interface GetScheduleParams {
  startDate: string
  endDate: string
}

export function getSchedule(params: GetScheduleParams): Promise<{
  success: boolean
  data: Schedule[]
}>
```

#### 4.2 创建排班
```typescript
interface CreateScheduleRequest {
  date: string
  shift: string
  staffIds: number[]
  stations: string[]
}

export function createSchedule(data: CreateScheduleRequest): Promise<{
  success: boolean
  data: Schedule
}>
```

### 5. 设备管理接口

#### 5.1 获取设备列表
```typescript
export function getEquipment(): Promise<{
  success: boolean
  data: Equipment[]
}>
```

#### 5.2 添加设备
```typescript
interface CreateEquipmentRequest {
  name: string
  model: string
  serialNumber: string
  station: string
}

export function createEquipment(data: CreateEquipmentRequest): Promise<{
  success: boolean
  data: Equipment
}>
```

#### 5.3 维护设备
```typescript
interface MaintenanceRequest {
  equipmentId: number
  type: string
  description: string
  maintenanceDate: string
  staffId: number
}

export function maintainEquipment(data: MaintenanceRequest): Promise<{
  success: boolean
  message: string
}>
```

### 6. 库存管理接口

#### 6.1 获取库存列表
```typescript
export function getInventory(): Promise<{
  success: boolean
  data: InventoryItem[]
}>
```

#### 6.2 入库操作
```typescript
interface StockInRequest {
  itemId: number
  quantity: number
  supplierId: number
  batchNumber?: string
  expiryDate?: string
}

export function stockIn(data: StockInRequest): Promise<{
  success: boolean
  data: InventoryItem
}>
```

#### 6.3 出库操作
```typescript
interface StockOutRequest {
  itemId: number
  quantity: number
  purpose: string
  taskId?: number
}

export function stockOut(data: StockOutRequest): Promise<{
  success: boolean
  message: string
}>
```

## 类型定义

### 1. 任务类型
```typescript
export interface Task {
  id: number
  taskId: string
  orderId: number
  orderNo: string
  itemId: number
  itemName: string
  quantity: number
  station: string
  priority: 'low' | 'normal' | 'high' | 'urgent'
  status: 'pending' | 'preparing' | 'ready' | 'served' | 'cancelled'
  tableNumber?: string
  estimatedTime?: number
  actualTime?: number
  assignedTo?: number
  createdAt: string
  startedAt?: string
  completedAt?: string
  notes?: string
}
```

### 2. 员工类型
```typescript
export interface Staff {
  id: number
  name: string
  phone: string
  role: 'chef' | 'assistant' | 'supervisor'
  station: string
  skillLevel: 'junior' | 'intermediate' | 'senior' | 'expert'
  status: 'online' | 'offline' | 'busy'
  activeTasks: number
  completedToday: number
  assignedTasks?: Task[]
  efficiencyScore: number
}
```

### 3. 设备类型
```typescript
export interface Equipment {
  id: number
  name: string
  model: string
  serialNumber: string
  station: string
  status: 'normal' | 'maintenance' | 'scrapped'
  purchaseDate: string
  lastMaintenanceDate?: string
  maintenanceRecords: MaintenanceRecord[]
  usageHours: number
  failureCount: number
}

export interface MaintenanceRecord {
  id: number
  equipmentId: number
  type: string
  description: string
  maintenanceDate: string
  staffId: number
  cost?: number
}
```

### 4. 库存类型
```typescript
export interface InventoryItem {
  id: number
  name: string
  category: string
  unit: string
  currentQuantity: number
  minQuantity: number
  maxQuantity: number
  expiryDate?: string
  supplierId: number
  supplierName: string
  batchNumber?: string
  lastStockInDate: string
  lastStockOutDate: string
}
```

### 5. 排班类型
```typescript
export interface Schedule {
  id: number
  date: string
  shift: string
  staffIds: number[]
  stations: string[]
  createdAt: string
  updatedAt: string
}
```

## 状态管理

### 1. Kitchen Store

```typescript
export const useKitchenStore = defineStore('kitchen', () => {
  const loading = ref(false)
  const error = ref<string | null>(null)
  const tasks = ref<Task[]>([])
  const staff = ref<Staff[]>([])
  const selectedTask = ref<Task | null>(null)
  const selectedStaff = ref<Staff | null>(null)

  async function fetchTasks(params: GetTasksParams) {
    loading.value = true
    try {
      const response = await getTasks(params)
      if (response.success) {
        tasks.value = response.data.tasks
      }
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'Unknown error'
    } finally {
      loading.value = false
    }
  }

  async function fetchStaff() {
    loading.value = true
    try {
      const response = await getKitchenStaff()
      if (response.success) {
        staff.value = response.data
      }
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'Unknown error'
    } finally {
      loading.value = false
    }
  }

  async function createTask(data: CreateTaskRequest) {
    loading.value = true
    try {
      const response = await createTask(data)
      if (response.success) {
        tasks.value.unshift(response.data)
      }
      return response
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'Unknown error'
      throw err
    } finally {
      loading.value = false
    }
  }

  async function updateTaskStatus(taskId: number, status: string) {
    loading.value = true
    try {
      const response = await updateTaskStatus(taskId, status)
      if (response.success) {
        const index = tasks.value.findIndex(t => t.id === taskId)
        if (index !== -1) {
          tasks.value[index] = response.data
        }
      }
      return response
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'Unknown error'
      throw err
    } finally {
      loading.value = false
    }
  }

  async function assignTask(taskId: number, staffId: number, options?: any) {
    loading.value = true
    try {
      const response = await assignTask(taskId, staffId, options)
      if (response.success) {
        const index = tasks.value.findIndex(t => t.id === taskId)
        if (index !== -1) {
          tasks.value[index] = response.data
        }
      }
      return response
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'Unknown error'
      throw err
    } finally {
      loading.value = false
    }
  }

  return {
    loading,
    error,
    tasks,
    staff,
    selectedTask,
    selectedStaff,
    fetchTasks,
    fetchStaff,
    createTask,
    updateTaskStatus,
    assignTask
  }
})
```

## 测试

### 1. 单元测试

#### 1.1 KitchenEfficiency组件测试
```typescript
describe('KitchenEfficiency组件', () => {
  it('应该正确渲染效率指标卡片', () => {
    const wrapper = mount(KitchenEfficiency)
    expect(wrapper.find('.metrics-row').exists()).toBe(true)
  })

  it('应该能够加载效率数据', async () => {
    const wrapper = mount(KitchenEfficiency)
    await wrapper.vm.loadEfficiencyData()
    expect(wrapper.vm.loading).toBe(false)
  })

  it('应该能够更新图表', async () => {
    const wrapper = mount(KitchenEfficiency)
    const mockData = {
      preparationTimeTrend: [
        { date: '2025-01-20', value: 12 },
        { date: '2025-01-21', value: 13 }
      ],
      completionTrend: [
        { date: '2025-01-20', value: 45 },
        { date: '2025-01-21', value: 50 }
      ]
    }
    await wrapper.vm.updateCharts(mockData)
    expect(wrapper.vm.preparationTimeChartInstance).toBeTruthy()
  })
})
```

#### 1.2 KitchenTaskAssignment组件测试
```typescript
describe('KitchenTaskAssignment组件', () => {
  it('应该正确渲染员工列表', () => {
    const wrapper = mount(KitchenTaskAssignment)
    expect(wrapper.find('.staff-list').exists()).toBe(true)
  })

  it('应该能够选择员工', async () => {
    const wrapper = mount(KitchenTaskAssignment)
    const mockStaff = {
      id: 1,
      name: '张三',
      role: 'chef',
      station: 'hot_dish',
      activeTasks: 3,
      completedToday: 25
    }
    await wrapper.vm.selectStaff(mockStaff)
    expect(wrapper.vm.selectedStaff).toEqual(mockStaff)
  })

  it('应该能够拖拽分配任务', async () => {
    const wrapper = mount(KitchenTaskAssignment)
    const mockTask = {
      id: 1,
      taskId: 'TASK-001',
      orderNo: 'ORD-001',
      itemName: '宫保鸡丁',
      quantity: 2,
      station: 'hot_dish',
      priority: 'urgent',
      status: 'pending',
      tableNumber: 'A1',
      createdAt: new Date().toISOString()
    }
    const mockStaff = {
      id: 1,
      name: '张三',
      role: 'chef',
      station: 'hot_dish',
      activeTasks: 3,
      completedToday: 25
    }
    
    const mockEvent = {
      dataTransfer: {
        setData: vi.fn(),
        getData: vi.fn(() => JSON.stringify(mockTask))
      },
      preventDefault: vi.fn()
    } as any
    
    await wrapper.vm.handleDrop(mockEvent, mockStaff)
    expect(mockEvent.preventDefault).toHaveBeenCalled()
  })
})
```

## 性能优化

### 1. 组件优化
- 使用Vue 3 Composition API减少不必要的重渲染
- 使用computed缓存计算结果
- 使用v-memo优化列表渲染
- 使用虚拟滚动优化大数据量列表

### 2. 数据优化
- 使用请求缓存减少重复请求
- 使用分页加载减少数据传输量
- 使用数据预加载提升用户体验
- 使用WebSocket实现实时数据更新

### 3. 图表优化
- 使用ECharts的按需加载
- 合理设置图表刷新间隔
- 使用数据采样减少渲染负担
- 使用Web Worker处理大数据计算

## 部署说明

### 1. 环境要求
- Node.js >= 18.0.0
- npm >= 9.0.0

### 2. 安装依赖
```bash
npm install
```

### 3. 开发环境
```bash
npm run dev
```

### 4. 生产构建
```bash
npm run build
```

### 5. 运行测试
```bash
npm run test
```

### 6. 代码检查
```bash
npm run lint
npm run type-check
```

## 开发规范

### 1. 代码风格
- 使用TypeScript进行类型检查
- 遵循ESLint代码规范
- 使用Prettier进行代码格式化
- 遵循Vue 3 Composition API最佳实践

### 2. 命名规范
- 组件名使用PascalCase
- 文件名使用PascalCase
- 变量名使用camelCase
- 常量名使用UPPER_SNAKE_CASE

### 3. 注释规范
- 使用JSDoc注释函数和类
- 使用单行注释解释复杂逻辑
- 使用TODO标记待完成功能

### 4. Git提交规范
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建/工具相关
```

## 版本历史

### v1.0.0 (2025-01-20)
- 初始版本发布
- 实现任务管理功能
- 实现员工管理功能
- 实现任务分配功能
- 实现效率分析功能
- 实现排班管理功能
- 实现设备管理功能
- 实现库存管理功能
- 完成单元测试覆盖
- 完成用户手册和开发文档

## 联系方式

如有任何问题或建议，请联系开发团队：
- 邮箱: dev@yyc3.com
- 项目地址: https://github.com/yyc3/catering-platform
