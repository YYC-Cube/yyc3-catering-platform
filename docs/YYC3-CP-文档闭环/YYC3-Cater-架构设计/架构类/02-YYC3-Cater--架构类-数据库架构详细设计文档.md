---

**@file**ï¼šYYCÂ³-æ•°æ®åº“æ¶æ„è¯¦ç»†è®¾è®¡æ–‡æ¡£
**@description**ï¼šYYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°çš„æ•°æ®åº“æ¶æ„è¯¦ç»†è®¾è®¡æ–‡æ¡£ï¼ŒåŒ…å«æ•°æ®åº“è®¾è®¡åŸåˆ™ã€è¡¨ç»“æ„è®¾è®¡ã€ç´¢å¼•è®¾è®¡ã€åˆ†åº“åˆ†è¡¨ç­–ç•¥ã€æ•°æ®è¿ç§»æ–¹æ¡ˆç­‰æ ¸å¿ƒå†…å®¹
**@author**ï¼šYYCÂ³
**@version**ï¼šv1.0.0
**@created**ï¼š2025-01-30
**@updated**ï¼š2025-01-30
**@status**ï¼špublished
**@tags**ï¼šæ¶æ„è®¾è®¡,æ•°æ®åº“,YYCÂ³,æ•°æ®å­˜å‚¨

---
# ğŸ”– YYCÂ³ æ•°æ®åº“æ¶æ„è¯¦ç»†è®¾è®¡æ–‡æ¡£

> ***YanYuCloudCube***
> **æ ‡è¯­**ï¼šè¨€å¯è±¡é™ | è¯­æ¢æœªæ¥
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **æ ‡è¯­**ï¼šä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| å±æ€§ | å†…å®¹ |
|------|------|
| **æ–‡æ¡£æ ‡é¢˜** | YYCÂ³ æ•°æ®åº“æ¶æ„è¯¦ç»†è®¾è®¡æ–‡æ¡£ |
| **æ–‡æ¡£ç±»å‹** | æ¶æ„è®¾è®¡ç±»æ–‡æ¡£ |
| **æ‰€å±é˜¶æ®µ** | æ¶æ„è®¾è®¡ |
| **éµå¾ªè§„èŒƒ** | YYCÂ³ å›¢é˜Ÿæ ‡å‡†åŒ–è§„èŒƒ v1.0.0 |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-01-30 |
| **ä½œè€…** | YYCÂ³ Team |
| **æ›´æ–°æ—¥æœŸ** | 2025-01-30 |

---

## ğŸ“‘ ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#1-æ¶æ„æ¦‚è¿°)
2. [æ•°æ®åº“è®¾è®¡åŸåˆ™](#2-æ•°æ®åº“è®¾è®¡åŸåˆ™)
3. [æ•°æ®åº“é€‰å‹](#3-æ•°æ®åº“é€‰å‹)
4. [æ ¸å¿ƒæ•°æ®åº“è®¾è®¡](#4-æ ¸å¿ƒæ•°æ®åº“è®¾è®¡)
5. [ç¼“å­˜è®¾è®¡](#5-ç¼“å­˜è®¾è®¡)
6. [æ•°æ®è¿ç§»ç­–ç•¥](#6-æ•°æ®è¿ç§»ç­–ç•¥)
7. [å¤‡ä»½ä¸æ¢å¤](#7-å¤‡ä»½ä¸æ¢å¤)
8. [æ€§èƒ½ä¼˜åŒ–](#8-æ€§èƒ½ä¼˜åŒ–)
9. [å®‰å…¨ç­–ç•¥](#9-å®‰å…¨ç­–ç•¥)
10. [ç›‘æ§ä¸ç»´æŠ¤](#10-ç›‘æ§ä¸ç»´æŠ¤)

---

## 1. æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

æœ¬æ¶æ„è®¾è®¡æ–‡æ¡£æ—¨åœ¨ä¸ºYYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°æä¾›æ¸…æ™°ã€å®Œæ•´çš„æŠ€æœ¯æ¶æ„æŒ‡å¯¼ã€‚ä¸»è¦ç›®æ ‡åŒ…æ‹¬ï¼š

- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒä¸šåŠ¡å¿«é€Ÿæ‰©å±•ï¼Œæ¨¡å—åŒ–è®¾è®¡ä¾¿äºåŠŸèƒ½è¿­ä»£
- **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Œç¡®ä¿é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šè¿è¡Œ
- **é«˜å¯ç”¨æ€§**ï¼šå®ç°ç³»ç»Ÿé«˜å¯ç”¨ï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤ï¼Œä¿éšœä¸šåŠ¡è¿ç»­æ€§
- **å®‰å…¨æ€§**ï¼šå»ºç«‹å®Œå–„çš„å®‰å…¨ä½“ç³»ï¼Œä¿æŠ¤æ•°æ®å’Œç³»ç»Ÿå®‰å…¨
- **æ˜“ç»´æŠ¤æ€§**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„ï¼Œä¾¿äºå›¢é˜Ÿåä½œå’Œç»´æŠ¤

é€šè¿‡æœ¬æ¶æ„è®¾è®¡ï¼Œç¡®ä¿å¹³å°èƒ½å¤Ÿæ»¡è¶³å½“å‰ä¸šåŠ¡éœ€æ±‚ï¼Œå¹¶ä¸ºæœªæ¥çš„å‘å±•å¥ å®šåšå®åŸºç¡€ã€‚

### 1.2 è®¾è®¡åŸåˆ™

æ¶æ„è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

- **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„ä¸šåŠ¡åŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- **ä¾èµ–å€’ç½®åŸåˆ™**ï¼šé«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡
- **æ¥å£éš”ç¦»åŸåˆ™**ï¼šä½¿ç”¨ç»†ç²’åº¦çš„æ¥å£ï¼Œé¿å…æ¥å£æ±¡æŸ“
- **æœ€å°‘çŸ¥è¯†åŸåˆ™**ï¼šæ¨¡å—é—´æœ€å°åŒ–ä¾èµ–ï¼Œé™ä½è€¦åˆåº¦

åŒæ—¶éµå¾ªYYCÂ³ã€Œäº”é«˜äº”æ ‡äº”åŒ–ã€æ ¸å¿ƒç†å¿µï¼š
- **äº”é«˜**ï¼šé«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜å®‰å…¨ã€é«˜æ‰©å±•ã€é«˜å¯ç»´æŠ¤
- **äº”æ ‡**ï¼šæ ‡å‡†åŒ–ã€è§„èŒƒåŒ–ã€è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€å¯è§†åŒ–
- **äº”åŒ–**ï¼šæµç¨‹åŒ–ã€æ–‡æ¡£åŒ–ã€å·¥å…·åŒ–ã€æ•°å­—åŒ–ã€ç”Ÿæ€åŒ–

### 1.3 æŠ€æœ¯é€‰å‹

æŠ€æœ¯æ ˆé€‰æ‹©åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

**å‰ç«¯æŠ€æœ¯æ ˆ**
- React 18+ï¼šé‡‡ç”¨ç°ä»£åŒ–å‰ç«¯æ¡†æ¶ï¼Œç»„ä»¶åŒ–å¼€å‘
- TypeScript 5.0+ï¼šç±»å‹å®‰å…¨ï¼Œæé«˜ä»£ç è´¨é‡
- Next.js 14+ï¼šSSR/SSGæ”¯æŒï¼Œä¼˜åŒ–SEOå’Œæ€§èƒ½
- Tailwind CSSï¼šåŸå­åŒ–CSSï¼Œå¿«é€Ÿæ„å»ºUI

**åç«¯æŠ€æœ¯æ ˆ**
- Node.js 18+ï¼šé«˜æ€§èƒ½JavaScriptè¿è¡Œæ—¶
- Express/Fastifyï¼šè½»é‡çº§Webæ¡†æ¶
- PostgreSQL 15+ï¼šå…³ç³»å‹æ•°æ®åº“ï¼ŒACIDä¿è¯
- Redis 7+ï¼šç¼“å­˜å’Œä¼šè¯å­˜å‚¨

**åŸºç¡€è®¾æ–½**
- Dockerï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¯å¢ƒä¸€è‡´æ€§
- Kubernetesï¼šå®¹å™¨ç¼–æ’ï¼Œè‡ªåŠ¨åŒ–è¿ç»´
- Nginxï¼šåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
- Prometheus + Grafanaï¼šç›‘æ§å’Œå‘Šè­¦

**å¼€å‘å·¥å…·**
- Gitï¼šç‰ˆæœ¬æ§åˆ¶
- ESLint + Prettierï¼šä»£ç è§„èŒƒ
- Jest + Vitestï¼šå•å…ƒæµ‹è¯•
- GitHub Actionsï¼šCI/CDè‡ªåŠ¨åŒ–

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

YYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºä»¥ä¸‹å±‚æ¬¡ï¼š

**è¡¨ç°å±‚ï¼ˆPresentation Layerï¼‰**
- Webå‰ç«¯ï¼šReact + Next.jsæ„å»ºçš„å•é¡µåº”ç”¨
- ç§»åŠ¨ç«¯ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šè®¾å¤‡è®¿é—®
- ç®¡ç†åå°ï¼šç‹¬ç«‹çš„ç®¡ç†ç•Œé¢

**åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰**
- APIç½‘å…³ï¼šç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±åˆ†å‘
- ä¸šåŠ¡æœåŠ¡ï¼šè®¢å•ã€ç”¨æˆ·ã€å•†å“ç­‰æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- è®¤è¯æˆæƒï¼šJWTè®¤è¯ï¼ŒRBACæƒé™æ§åˆ¶

**é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰**
- é¢†åŸŸæ¨¡å‹ï¼šæ ¸å¿ƒä¸šåŠ¡å®ä½“å’Œè§„åˆ™
- é¢†åŸŸæœåŠ¡ï¼šå¤æ‚ä¸šåŠ¡é€»è¾‘å°è£…
- ä»“å‚¨æ¥å£ï¼šæ•°æ®è®¿é—®æŠ½è±¡

**åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructure Layerï¼‰**
- æ•°æ®åº“ï¼šPostgreSQLä¸»ä»æ¶æ„
- ç¼“å­˜ï¼šRedisé›†ç¾¤
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ/Kafka
- æ–‡ä»¶å­˜å‚¨ï¼šOSS/MinIO

**è·¨å±‚å…³æ³¨ç‚¹**
- æ—¥å¿—ç›‘æ§ï¼šELK Stack
- é…ç½®ç®¡ç†ï¼šApollo/Nacos
- æœåŠ¡å‘ç°ï¼šConsul/Eureka
- é“¾è·¯è¿½è¸ªï¼šJaeger/SkyWalking

### 2.2 æ¨¡å—åˆ’åˆ†

ç³»ç»ŸæŒ‰ç…§ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†ä¸ºä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š

**ç”¨æˆ·æ¨¡å—ï¼ˆUser Moduleï¼‰**
- ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€è®¤è¯
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- æƒé™å’Œè§’è‰²ç®¡ç†

**å•†å“æ¨¡å—ï¼ˆProduct Moduleï¼‰**
- å•†å“ä¿¡æ¯ç®¡ç†
- å•†å“åˆ†ç±»å’Œæ ‡ç­¾
- åº“å­˜ç®¡ç†

**è®¢å•æ¨¡å—ï¼ˆOrder Moduleï¼‰**
- è®¢å•åˆ›å»ºå’Œæ”¯ä»˜
- è®¢å•çŠ¶æ€æµè½¬
- è®¢å•æŸ¥è¯¢å’Œç»Ÿè®¡

**æ”¯ä»˜æ¨¡å—ï¼ˆPayment Moduleï¼‰**
- æ”¯ä»˜æ¥å£é›†æˆ
- æ”¯ä»˜çŠ¶æ€åŒæ­¥
- é€€æ¬¾å¤„ç†

**è¥é”€æ¨¡å—ï¼ˆMarketing Moduleï¼‰**
- ä¼˜æƒ åˆ¸ç®¡ç†
- ä¿ƒé”€æ´»åŠ¨
- ä¼šå‘˜ç§¯åˆ†

**æŠ¥è¡¨æ¨¡å—ï¼ˆReport Moduleï¼‰**
- é”€å”®æŠ¥è¡¨
- æ•°æ®åˆ†æ
- å¯è§†åŒ–å±•ç¤º

**ç³»ç»Ÿæ¨¡å—ï¼ˆSystem Moduleï¼‰**
- é…ç½®ç®¡ç†
- æ—¥å¿—ç®¡ç†
- ç›‘æ§å‘Šè­¦

### 2.3 æ•°æ®æµå‘

## 3. æŠ€æœ¯å®ç°

### 3.1 æ ¸å¿ƒæŠ€æœ¯

### 3.2 å…³é”®ç®—æ³•

### 3.3 æ€§èƒ½ä¼˜åŒ–

## 4. æ¥å£è®¾è®¡

### 4.1 APIæ¥å£

### 4.2 æ•°æ®æ¥å£

### 4.3 æ¶ˆæ¯æ¥å£

## 5. éƒ¨ç½²æ–¹æ¡ˆ

### 5.1 éƒ¨ç½²æ¶æ„

### 5.2 é…ç½®ç®¡ç†

### 5.3 ç›‘æ§å‘Šè­¦

## 6. é™„å½•

### 6.1 æœ¯è¯­è¡¨

### 6.2 å‚è€ƒèµ„æ–™

## 1. æ¶æ„æ¦‚è¿°

### 1.1 æ•°æ®åº“æ¶æ„å±‚æ¬¡

YYCÂ³ é¤é¥®ç®¡ç†å¹³å°é‡‡ç”¨å¤šå±‚æ•°æ®åº“æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åº”ç”¨å±‚ (Application)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ORM å±‚ (Prisma/Sequelize)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ç¼“å­˜å±‚ (Redis/Memcached)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®åº“å±‚ (PostgreSQL/MySQL)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å­˜å‚¨å±‚ (SSD/NVMe)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ•°æ®åº“æ¶æ„ç‰¹ç‚¹

- **é«˜å¯ç”¨æ€§**ï¼šä¸»ä»å¤åˆ¶ã€è¯»å†™åˆ†ç¦»
- **é«˜æ€§èƒ½**ï¼šç¼“å­˜åŠ é€Ÿã€ç´¢å¼•ä¼˜åŒ–
- **é«˜æ‰©å±•æ€§**ï¼šåˆ†åº“åˆ†è¡¨ã€æ°´å¹³æ‰©å±•
- **æ•°æ®ä¸€è‡´æ€§**ï¼šäº‹åŠ¡æ”¯æŒã€ACID ç‰¹æ€§
- **æ•°æ®å®‰å…¨**ï¼šå¤‡ä»½æ¢å¤ã€æƒé™æ§åˆ¶

### 1.3 æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | ç”¨é€” |
|------|---------|------|------|
| å…³ç³»å‹æ•°æ®åº“ | PostgreSQL | 15+ | ä¸»æ•°æ®å­˜å‚¨ |
| ç¼“å­˜æ•°æ®åº“ | Redis | 7+ | ä¼šè¯ç¼“å­˜ã€çƒ­ç‚¹æ•°æ® |
| ORM æ¡†æ¶ | Prisma | 5+ | æ•°æ®è®¿é—®å±‚ |
| æ•°æ®åº“è¿æ¥æ±  | pg-pool | 3+ | è¿æ¥ç®¡ç† |
| æ•°æ®è¿ç§» | Prisma Migrate | 5+ | ç‰ˆæœ¬æ§åˆ¶ |

---

## 2. æ•°æ®åº“è®¾è®¡åŸåˆ™

### 2.1 è®¾è®¡åŸåˆ™

- **è§„èŒƒåŒ–**ï¼šéµå¾ªç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šåˆç†åè§„èŒƒåŒ–
- **å¯æ‰©å±•æ€§**ï¼šé¢„ç•™æ‰©å±•ç©ºé—´
- **æ•°æ®å®Œæ•´æ€§**ï¼šçº¦æŸå’Œè§¦å‘å™¨
- **å®‰å…¨æ€§**ï¼šæœ€å°æƒé™åŸåˆ™

### 2.2 å‘½åè§„èŒƒ

- **è¡¨å**ï¼šä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼ˆsnake_caseï¼‰ï¼Œå¤æ•°å½¢å¼
- **å­—æ®µå**ï¼šä½¿ç”¨è›‡å½¢å‘½åæ³•ï¼ˆsnake_caseï¼‰ï¼Œå•æ•°å½¢å¼
- **ç´¢å¼•å**ï¼š`idx_è¡¨å_å­—æ®µå`
- **å¤–é”®å**ï¼š`fk_è¡¨å_å­—æ®µå`
- **ä¸»é”®å**ï¼š`id`

### 2.3 å­—æ®µç±»å‹è§„èŒƒ

| æ•°æ®ç±»å‹ | PostgreSQL ç±»å‹ | è¯´æ˜ |
|---------|----------------|------|
| ä¸»é”® | BIGINT | è‡ªå¢ä¸»é”® |
| å­—ç¬¦ä¸² | VARCHAR(n) | å¯å˜é•¿åº¦å­—ç¬¦ä¸² |
| æ–‡æœ¬ | TEXT | é•¿æ–‡æœ¬ |
| æ•´æ•° | INTEGER | æ•´æ•° |
| å°æ•° | DECIMAL(10,2) | é‡‘é¢ç­‰ç²¾ç¡®æ•°å€¼ |
| å¸ƒå°” | BOOLEAN | çœŸ/å‡ |
| æ—¥æœŸæ—¶é—´ | TIMESTAMP | æ—¶é—´æˆ³ |
| JSON | JSONB | JSON æ•°æ® |

---

## 3. æ•°æ®åº“é€‰å‹

### 3.1 PostgreSQL é€‰å‹ç†ç”±

**ä¼˜åŠ¿ï¼š**
- å¼€æºå…è´¹ï¼Œç¤¾åŒºæ´»è·ƒ
- æ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼ˆJSONBã€æ•°ç»„ç­‰ï¼‰
- å¼ºå¤§çš„æŸ¥è¯¢ä¼˜åŒ–å™¨
- å®Œå–„çš„äº‹åŠ¡æ”¯æŒ
- ä¼˜ç§€çš„æ‰©å±•æ€§
- é«˜å¯ç”¨æ€§æ”¯æŒ

**é€‚ç”¨åœºæ™¯ï¼š**
- å¤æ‚æŸ¥è¯¢éœ€æ±‚
- æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜
- éœ€è¦äº‹åŠ¡æ”¯æŒ
- éœ€è¦æ‰©å±•æ•°æ®ç±»å‹

### 3.2 Redis é€‰å‹ç†ç”±

**ä¼˜åŠ¿ï¼š**
- é«˜æ€§èƒ½è¯»å†™
- ä¸°å¯Œçš„æ•°æ®ç»“æ„
- æŒä¹…åŒ–æ”¯æŒ
- ä¸»ä»å¤åˆ¶
- é›†ç¾¤æ”¯æŒ

**é€‚ç”¨åœºæ™¯ï¼š**
- ä¼šè¯å­˜å‚¨
- çƒ­ç‚¹æ•°æ®ç¼“å­˜
- æ’è¡Œæ¦œ
- æ¶ˆæ¯é˜Ÿåˆ—
- åˆ†å¸ƒå¼é”

---

## 4. æ ¸å¿ƒæ•°æ®åº“è®¾è®¡

### 4.1 ç”¨æˆ·ç›¸å…³è¡¨

#### 4.1.1 ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20) UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(100) NOT NULL,
    avatar_url VARCHAR(500),
    role VARCHAR(20) NOT NULL DEFAULT 'user',
    status VARCHAR(20) NOT NULL DEFAULT 'active',
    email_verified BOOLEAN DEFAULT FALSE,
    last_login_at TIMESTAMP,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_phone ON users(phone);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_created_at ON users(created_at);

-- æ³¨é‡Š
COMMENT ON TABLE users IS 'ç”¨æˆ·è¡¨';
COMMENT ON COLUMN users.email IS 'ç”¨æˆ·é‚®ç®±';
COMMENT ON COLUMN users.phone IS 'ç”¨æˆ·æ‰‹æœºå·';
COMMENT ON COLUMN users.password_hash IS 'å¯†ç å“ˆå¸Œ';
COMMENT ON COLUMN users.role IS 'ç”¨æˆ·è§’è‰²ï¼šadmin, manager, staff, user';
COMMENT ON COLUMN users.status IS 'ç”¨æˆ·çŠ¶æ€ï¼šactive, inactive, suspended, deleted';
```

#### 4.1.2 ç”¨æˆ·ä¼šè¯è¡¨ (user_sessions)

```sql
CREATE TABLE user_sessions (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    token VARCHAR(500) UNIQUE NOT NULL,
    refresh_token VARCHAR(500) UNIQUE,
    device_info JSONB,
    ip_address INET,
    expires_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_used_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_user_sessions_user_id ON user_sessions(user_id);
CREATE INDEX idx_user_sessions_token ON user_sessions(token);
CREATE INDEX idx_user_sessions_expires_at ON user_sessions(expires_at);

-- æ³¨é‡Š
COMMENT ON TABLE user_sessions IS 'ç”¨æˆ·ä¼šè¯è¡¨';
COMMENT ON COLUMN user_sessions.token IS 'è®¿é—®ä»¤ç‰Œ';
COMMENT ON COLUMN user_sessions.refresh_token IS 'åˆ·æ–°ä»¤ç‰Œ';
COMMENT ON COLUMN user_sessions.device_info IS 'è®¾å¤‡ä¿¡æ¯';
```

### 4.2 å•†æˆ·ç›¸å…³è¡¨

#### 4.2.1 å•†æˆ·è¡¨ (merchants)

```sql
CREATE TABLE merchants (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    name VARCHAR(200) NOT NULL,
    logo_url VARCHAR(500),
    description TEXT,
    business_type VARCHAR(50) NOT NULL,
    business_hours JSONB,
    address VARCHAR(500),
    city VARCHAR(100),
    province VARCHAR(100),
    country VARCHAR(100) DEFAULT 'China',
    postal_code VARCHAR(20),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    contact_name VARCHAR(100),
    contact_phone VARCHAR(20),
    contact_email VARCHAR(255),
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    verification_status VARCHAR(20) NOT NULL DEFAULT 'unverified',
    rating DECIMAL(3, 2) DEFAULT 0,
    review_count INTEGER DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_merchants_user_id ON merchants(user_id);
CREATE INDEX idx_merchants_status ON merchants(status);
CREATE INDEX idx_merchants_verification_status ON merchants(verification_status);
CREATE INDEX idx_merchants_city ON merchants(city);
CREATE INDEX idx_merchants_rating ON merchants(rating);
CREATE INDEX idx_merchants_created_at ON merchants(created_at);

-- æ³¨é‡Š
COMMENT ON TABLE merchants IS 'å•†æˆ·è¡¨';
COMMENT ON COLUMN merchants.business_type IS 'ä¸šåŠ¡ç±»å‹ï¼šrestaurant, cafe, bar, etc.';
COMMENT ON COLUMN merchants.business_hours IS 'è¥ä¸šæ—¶é—´ JSON';
COMMENT ON COLUMN merchants.status IS 'çŠ¶æ€ï¼špending, active, inactive, suspended';
COMMENT ON COLUMN merchants.verification_status IS 'è®¤è¯çŠ¶æ€ï¼šunverified, verified, rejected';
```

#### 4.2.2 å•†æˆ·è®¾ç½®è¡¨ (merchant_settings)

```sql
CREATE TABLE merchant_settings (
    id BIGSERIAL PRIMARY KEY,
    merchant_id BIGINT NOT NULL REFERENCES merchants(id) ON DELETE CASCADE,
    currency VARCHAR(10) DEFAULT 'CNY',
    language VARCHAR(10) DEFAULT 'zh-CN',
    timezone VARCHAR(50) DEFAULT 'Asia/Shanghai',
    tax_rate DECIMAL(5, 4) DEFAULT 0,
    service_fee_rate DECIMAL(5, 4) DEFAULT 0,
    delivery_fee DECIMAL(10, 2) DEFAULT 0,
    min_order_amount DECIMAL(10, 2) DEFAULT 0,
    free_delivery_threshold DECIMAL(10, 2),
    notification_settings JSONB,
    payment_methods JSONB,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(merchant_id)
);

-- æ³¨é‡Š
COMMENT ON TABLE merchant_settings IS 'å•†æˆ·è®¾ç½®è¡¨';
COMMENT ON COLUMN merchant_settings.tax_rate IS 'ç¨ç‡';
COMMENT ON COLUMN merchant_settings.service_fee_rate IS 'æœåŠ¡è´¹ç‡';
```

### 4.3 å•†å“ç›¸å…³è¡¨

#### 4.3.1 å•†å“åˆ†ç±»è¡¨ (product_categories)

```sql
CREATE TABLE product_categories (
    id BIGSERIAL PRIMARY KEY,
    merchant_id BIGINT NOT NULL REFERENCES merchants(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    parent_id BIGINT REFERENCES product_categories(id) ON DELETE CASCADE,
    icon_url VARCHAR(500),
    sort_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_product_categories_merchant_id ON product_categories(merchant_id);
CREATE INDEX idx_product_categories_parent_id ON product_categories(parent_id);
CREATE INDEX idx_product_categories_sort_order ON product_categories(sort_order);

-- æ³¨é‡Š
COMMENT ON TABLE product_categories IS 'å•†å“åˆ†ç±»è¡¨';
```

#### 4.3.2 å•†å“è¡¨ (products)

```sql
CREATE TABLE products (
    id BIGSERIAL PRIMARY KEY,
    merchant_id BIGINT NOT NULL REFERENCES merchants(id) ON DELETE CASCADE,
    category_id BIGINT REFERENCES product_categories(id) ON DELETE SET NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    images JSONB,
    price DECIMAL(10, 2) NOT NULL,
    original_price DECIMAL(10, 2),
    cost_price DECIMAL(10, 2),
    sku VARCHAR(100) UNIQUE,
    barcode VARCHAR(100),
    unit VARCHAR(50) DEFAULT 'piece',
    stock_quantity INTEGER DEFAULT 0,
    min_stock_quantity INTEGER DEFAULT 0,
    max_stock_quantity INTEGER,
    is_available BOOLEAN DEFAULT TRUE,
    is_featured BOOLEAN DEFAULT FALSE,
    attributes JSONB,
    nutrition_info JSONB,
    allergen_info JSONB,
    preparation_time INTEGER,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_products_merchant_id ON products(merchant_id);
CREATE INDEX idx_products_category_id ON products(category_id);
CREATE INDEX idx_products_sku ON products(sku);
CREATE INDEX idx_products_barcode ON products(barcode);
CREATE INDEX idx_products_is_available ON products(is_available);
CREATE INDEX idx_products_is_featured ON products(is_featured);
CREATE INDEX idx_products_created_at ON products(created_at);

-- å…¨æ–‡æœç´¢ç´¢å¼•
CREATE INDEX idx_products_name_search ON products USING gin(to_tsvector('chinese', name));
CREATE INDEX idx_products_description_search ON products USING gin(to_tsvector('chinese', description));

-- æ³¨é‡Š
COMMENT ON TABLE products IS 'å•†å“è¡¨';
COMMENT ON COLUMN products.attributes IS 'å•†å“å±æ€§ JSON';
COMMENT ON COLUMN products.nutrition_info IS 'è¥å…»ä¿¡æ¯ JSON';
COMMENT ON COLUMN products.allergen_info IS 'è¿‡æ•åŸä¿¡æ¯ JSON';
```

#### 4.3.3 å•†å“è§„æ ¼è¡¨ (product_variants)

```sql
CREATE TABLE product_variants (
    id BIGSERIAL PRIMARY KEY,
    product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
    name VARCHAR(200) NOT NULL,
    sku VARCHAR(100) UNIQUE,
    price DECIMAL(10, 2) NOT NULL,
    cost_price DECIMAL(10, 2),
    stock_quantity INTEGER DEFAULT 0,
    attributes JSONB,
    is_available BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_product_variants_product_id ON product_variants(product_id);
CREATE INDEX idx_product_variants_sku ON product_variants(sku);

-- æ³¨é‡Š
COMMENT ON TABLE product_variants IS 'å•†å“è§„æ ¼è¡¨';
```

### 4.4 è®¢å•ç›¸å…³è¡¨

#### 4.4.1 è®¢å•è¡¨ (orders)

```sql
CREATE TABLE orders (
    id BIGSERIAL PRIMARY KEY,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    merchant_id BIGINT NOT NULL REFERENCES merchants(id) ON DELETE CASCADE,
    user_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    order_type VARCHAR(20) NOT NULL DEFAULT 'dine_in',
    table_number VARCHAR(20),
    delivery_address JSONB,
    contact_name VARCHAR(100),
    contact_phone VARCHAR(20),
    subtotal DECIMAL(10, 2) NOT NULL,
    tax_amount DECIMAL(10, 2) DEFAULT 0,
    service_fee DECIMAL(10, 2) DEFAULT 0,
    delivery_fee DECIMAL(10, 2) DEFAULT 0,
    discount_amount DECIMAL(10, 2) DEFAULT 0,
    total_amount DECIMAL(10, 2) NOT NULL,
    paid_amount DECIMAL(10, 2) DEFAULT 0,
    payment_method VARCHAR(50),
    payment_status VARCHAR(20) NOT NULL DEFAULT 'unpaid',
    payment_time TIMESTAMP,
    notes TEXT,
    estimated_time TIMESTAMP,
    completed_at TIMESTAMP,
    cancelled_at TIMESTAMP,
    cancellation_reason TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_orders_order_number ON orders(order_number);
CREATE INDEX idx_orders_merchant_id ON orders(merchant_id);
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_payment_status ON orders(payment_status);
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_orders_completed_at ON orders(completed_at);

-- æ³¨é‡Š
COMMENT ON TABLE orders IS 'è®¢å•è¡¨';
COMMENT ON COLUMN orders.status IS 'è®¢å•çŠ¶æ€ï¼špending, confirmed, preparing, ready, completed, cancelled';
COMMENT ON COLUMN orders.order_type IS 'è®¢å•ç±»å‹ï¼šdine_in, takeout, delivery';
COMMENT ON COLUMN orders.payment_status IS 'æ”¯ä»˜çŠ¶æ€ï¼šunpaid, processing, paid, failed, refunded';
```

#### 4.4.2 è®¢å•æ˜ç»†è¡¨ (order_items)

```sql
CREATE TABLE order_items (
    id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    product_id BIGINT NOT NULL REFERENCES products(id),
    product_variant_id BIGINT REFERENCES product_variants(id),
    product_name VARCHAR(200) NOT NULL,
    product_sku VARCHAR(100),
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    total_price DECIMAL(10, 2) NOT NULL,
    special_instructions TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);

-- æ³¨é‡Š
COMMENT ON TABLE order_items IS 'è®¢å•æ˜ç»†è¡¨';
```

#### 4.4.3 è®¢å•çŠ¶æ€å†å²è¡¨ (order_status_history)

```sql
CREATE TABLE order_status_history (
    id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    status VARCHAR(20) NOT NULL,
    notes TEXT,
    created_by BIGINT REFERENCES users(id),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_order_status_history_order_id ON order_status_history(order_id);
CREATE INDEX idx_order_status_history_created_at ON order_status_history(created_at);

-- æ³¨é‡Š
COMMENT ON TABLE order_status_history IS 'è®¢å•çŠ¶æ€å†å²è¡¨';
```

### 4.5 æ”¯ä»˜ç›¸å…³è¡¨

#### 4.5.1 æ”¯ä»˜è®°å½•è¡¨ (payments)

```sql
CREATE TABLE payments (
    id BIGSERIAL PRIMARY KEY,
    order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
    user_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
    payment_method VARCHAR(50) NOT NULL,
    payment_gateway VARCHAR(50) NOT NULL,
    transaction_id VARCHAR(200),
    amount DECIMAL(10, 2) NOT NULL,
    currency VARCHAR(10) DEFAULT 'CNY',
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    payment_time TIMESTAMP,
    refund_amount DECIMAL(10, 2) DEFAULT 0,
    refund_time TIMESTAMP,
    gateway_response JSONB,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_payments_order_id ON payments(order_id);
CREATE INDEX idx_payments_user_id ON payments(user_id);
CREATE INDEX idx_payments_transaction_id ON payments(transaction_id);
CREATE INDEX idx_payments_status ON payments(status);
CREATE INDEX idx_payments_created_at ON payments(created_at);

-- æ³¨é‡Š
COMMENT ON TABLE payments IS 'æ”¯ä»˜è®°å½•è¡¨';
COMMENT ON COLUMN payments.status IS 'æ”¯ä»˜çŠ¶æ€ï¼špending, processing, completed, failed, refunded';
```

### 4.6 åº“å­˜ç›¸å…³è¡¨

#### 4.6.1 åº“å­˜è®°å½•è¡¨ (inventory_logs)

```sql
CREATE TABLE inventory_logs (
    id BIGSERIAL PRIMARY KEY,
    merchant_id BIGINT NOT NULL REFERENCES merchants(id) ON DELETE CASCADE,
    product_id BIGINT NOT NULL REFERENCES products(id),
    product_variant_id BIGINT REFERENCES product_variants(id),
    type VARCHAR(20) NOT NULL,
    quantity INTEGER NOT NULL,
    quantity_before INTEGER NOT NULL,
    quantity_after INTEGER NOT NULL,
    reason VARCHAR(100),
    reference_type VARCHAR(50),
    reference_id BIGINT,
    operator_id BIGINT REFERENCES users(id),
    notes TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_inventory_logs_merchant_id ON inventory_logs(merchant_id);
CREATE INDEX idx_inventory_logs_product_id ON inventory_logs(product_id);
CREATE INDEX idx_inventory_logs_type ON inventory_logs(type);
CREATE INDEX idx_inventory_logs_created_at ON inventory_logs(created_at);

-- æ³¨é‡Š
COMMENT ON TABLE inventory_logs IS 'åº“å­˜è®°å½•è¡¨';
COMMENT ON COLUMN inventory_logs.type IS 'ç±»å‹ï¼šin, out, adjustment, transfer';
```

### 4.7 å®¢æˆ·ç›¸å…³è¡¨

#### 4.7.1 å®¢æˆ·è¡¨ (customers)

```sql
CREATE TABLE customers (
    id BIGSERIAL PRIMARY KEY,
    merchant_id BIGINT NOT NULL REFERENCES merchants(id) ON DELETE CASCADE,
    user_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
    name VARCHAR(100),
    phone VARCHAR(20),
    email VARCHAR(255),
    address VARCHAR(500),
    city VARCHAR(100),
    birthday DATE,
    gender VARCHAR(10),
    level VARCHAR(20) DEFAULT 'normal',
    points INTEGER DEFAULT 0,
    total_orders INTEGER DEFAULT 0,
    total_spent DECIMAL(10, 2) DEFAULT 0,
    last_order_at TIMESTAMP,
    tags JSONB,
    preferences JSONB,
    notes TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_customers_merchant_id ON customers(merchant_id);
CREATE INDEX idx_customers_user_id ON customers(user_id);
CREATE INDEX idx_customers_phone ON customers(phone);
CREATE INDEX idx_customers_email ON customers(email);
CREATE INDEX idx_customers_level ON customers(level);
CREATE INDEX idx_customers_created_at ON customers(created_at);

-- æ³¨é‡Š
COMMENT ON TABLE customers IS 'å®¢æˆ·è¡¨';
COMMENT ON COLUMN customers.level IS 'å®¢æˆ·ç­‰çº§ï¼šnormal, vip, premium';
```

### 4.8 è¥é”€ç›¸å…³è¡¨

#### 4.8.1 ä¼˜æƒ åˆ¸è¡¨ (coupons)

```sql
CREATE TABLE coupons (
    id BIGSERIAL PRIMARY KEY,
    merchant_id BIGINT NOT NULL REFERENCES merchants(id) ON DELETE CASCADE,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    code VARCHAR(50) UNIQUE NOT NULL,
    type VARCHAR(20) NOT NULL,
    discount_type VARCHAR(20) NOT NULL,
    discount_value DECIMAL(10, 2) NOT NULL,
    min_order_amount DECIMAL(10, 2) DEFAULT 0,
    max_discount_amount DECIMAL(10, 2),
    usage_limit INTEGER,
    used_count INTEGER DEFAULT 0,
    user_usage_limit INTEGER DEFAULT 1,
    valid_from TIMESTAMP NOT NULL,
    valid_until TIMESTAMP NOT NULL,
    applicable_products JSONB,
    applicable_categories JSONB,
    status VARCHAR(20) NOT NULL DEFAULT 'active',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_coupons_merchant_id ON coupons(merchant_id);
CREATE INDEX idx_coupons_code ON coupons(code);
CREATE INDEX idx_coupons_status ON coupons(status);
CREATE INDEX idx_coupons_valid_from ON coupons(valid_from);
CREATE INDEX idx_coupons_valid_until ON coupons(valid_until);

-- æ³¨é‡Š
COMMENT ON TABLE coupons IS 'ä¼˜æƒ åˆ¸è¡¨';
COMMENT ON COLUMN coupons.type IS 'ç±»å‹ï¼špublic, private';
COMMENT ON COLUMN coupons.discount_type IS 'æŠ˜æ‰£ç±»å‹ï¼špercentage, fixed_amount';
```

#### 4.8.2 ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨ (user_coupons)

```sql
CREATE TABLE user_coupons (
    id BIGSERIAL PRIMARY KEY,
    coupon_id BIGINT NOT NULL REFERENCES coupons(id) ON DELETE CASCADE,
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    customer_id BIGINT REFERENCES customers(id) ON DELETE CASCADE,
    status VARCHAR(20) NOT NULL DEFAULT 'unused',
    used_at TIMESTAMP,
    order_id BIGINT REFERENCES orders(id) ON DELETE SET NULL,
    expires_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_user_coupons_coupon_id ON user_coupons(coupon_id);
CREATE INDEX idx_user_coupons_user_id ON user_coupons(user_id);
CREATE INDEX idx_user_coupons_customer_id ON user_coupons(customer_id);
CREATE INDEX idx_user_coupons_status ON user_coupons(status);
CREATE INDEX idx_user_coupons_expires_at ON user_coupons(expires_at);

-- æ³¨é‡Š
COMMENT ON TABLE user_coupons IS 'ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨';
COMMENT ON COLUMN user_coupons.status IS 'çŠ¶æ€ï¼šunused, used, expired';
```

---

## 5. ç¼“å­˜è®¾è®¡

### 5.1 ç¼“å­˜ç­–ç•¥

#### 5.1.1 ç¼“å­˜ç±»å‹

| ç¼“å­˜ç±»å‹ | ç”¨é€” | è¿‡æœŸæ—¶é—´ |
|---------|------|---------|
| ä¼šè¯ç¼“å­˜ | ç”¨æˆ·ä¼šè¯æ•°æ® | 24 å°æ—¶ |
| çƒ­ç‚¹æ•°æ® | é¢‘ç¹è®¿é—®çš„å•†å“ã€å•†æˆ· | 1 å°æ—¶ |
| æŸ¥è¯¢ç¼“å­˜ | å¤æ‚æŸ¥è¯¢ç»“æœ | 30 åˆ†é’Ÿ |
| è®¡æ•°å™¨ç¼“å­˜ | è®¢å•æ•°ã€æµè§ˆæ•°ç­‰ | å®æ—¶æ›´æ–° |

#### 5.1.2 ç¼“å­˜é”®è®¾è®¡

```
# ä¼šè¯ç¼“å­˜
session:{user_id}:{session_id}

# å•†æˆ·ç¼“å­˜
merchant:{merchant_id}
merchant:products:{merchant_id}
merchant:categories:{merchant_id}

# å•†å“ç¼“å­˜
product:{product_id}
product:variants:{product_id}

# ç”¨æˆ·ç¼“å­˜
user:{user_id}
user:profile:{user_id}

# è®¢å•ç¼“å­˜
order:{order_id}
order:items:{order_id}
```

### 5.2 Redis é…ç½®

```typescript
import Redis from 'ioredis';

const redis = new Redis({
  host: process.env.REDIS_HOST || 'localhost',
  port: parseInt(process.env.REDIS_PORT || '6379'),
  password: process.env.REDIS_PASSWORD,
  db: parseInt(process.env.REDIS_DB || '0'),
  retryStrategy: (times) => {
    const delay = Math.min(times * 50, 2000);
    return delay;
  },
  maxRetriesPerRequest: 3,
  enableReadyCheck: true,
  enableOfflineQueue: true
});

export default redis;
```

---

## 6. æ•°æ®è¿ç§»ç­–ç•¥

### 6.1 è¿ç§»å·¥å…·

ä½¿ç”¨ Prisma Migrate è¿›è¡Œæ•°æ®åº“è¿ç§»ï¼š

```typescript
// schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        BigInt   @id @default(autoincrement())
  email     String   @unique
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### 6.2 è¿ç§»æµç¨‹

```bash
# åˆ›å»ºè¿ç§»
npx prisma migrate dev --name add_user_table

# åº”ç”¨è¿ç§»
npx prisma migrate deploy

# é‡ç½®æ•°æ®åº“ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
npx prisma migrate reset

# ç”Ÿæˆå®¢æˆ·ç«¯
npx prisma generate
```

### 6.3 è¿ç§»æœ€ä½³å®è·µ

- æ¯æ¬¡è¿ç§»å‰å¤‡ä»½æ•°æ®åº“
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿è¿ç§»åŸå­æ€§
- åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯è¿ç§»
- å‡†å¤‡å›æ»šè„šæœ¬
- è®°å½•è¿ç§»å†å²

---

## 7. å¤‡ä»½ä¸æ¢å¤

### 7.1 å¤‡ä»½ç­–ç•¥

#### 7.1.1 å…¨é‡å¤‡ä»½

```bash
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹è¿›è¡Œå…¨é‡å¤‡ä»½
pg_dump -h localhost -U postgres -d yyc3_catering \
  -F c -f /backup/yyc3_catering_$(date +%Y%m%d).backup
```

#### 7.1.2 å¢é‡å¤‡ä»½

```bash
# æ¯å°æ—¶è¿›è¡Œå¢é‡å¤‡ä»½
pg_dump -h localhost -U postgres -d yyc3_catering \
  --format=directory --file=/backup/incremental/$(date +%Y%m%d_%H)
```

#### 7.1.3 å¤‡ä»½ä¿ç•™ç­–ç•¥

- å…¨é‡å¤‡ä»½ï¼šä¿ç•™ 7 å¤©
- å¢é‡å¤‡ä»½ï¼šä¿ç•™ 24 å°æ—¶
- å½’æ¡£å¤‡ä»½ï¼šæ¯æœˆä¿ç•™ 1 ä»½

### 7.2 æ¢å¤ç­–ç•¥

#### 7.2.1 å…¨é‡æ¢å¤

```bash
# æ¢å¤å…¨é‡å¤‡ä»½
pg_restore -h localhost -U postgres -d yyc3_catering \
  /backup/yyc3_catering_20250130.backup
```

#### 7.2.2 æ—¶é—´ç‚¹æ¢å¤

```bash
# æ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹
pg_restore -h localhost -U postgres -d yyc3_catering \
  --recovery-target-time="2025-01-30 10:00:00" \
  /backup/yyc3_catering_20250130.backup
```

---

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 ç´¢å¼•ä¼˜åŒ–

#### 8.1.1 åˆ›å»ºç´¢å¼•

```sql
-- å•åˆ—ç´¢å¼•
CREATE INDEX idx_users_email ON users(email);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_orders_merchant_status ON orders(merchant_id, status);

-- å”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX idx_users_email ON users(email);

-- éƒ¨åˆ†ç´¢å¼•
CREATE INDEX idx_active_users ON users(email) WHERE status = 'active';

-- è¡¨è¾¾å¼ç´¢å¼•
CREATE INDEX idx_users_lower_email ON users(LOWER(email));
```

#### 8.1.2 ç´¢å¼•ç»´æŠ¤

```sql
-- åˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT * FROM pg_stat_user_indexes;

-- é‡å»ºç´¢å¼•
REINDEX INDEX idx_users_email;

-- æ¸…ç†è¡¨
VACUUM ANALYZE users;
```

### 8.2 æŸ¥è¯¢ä¼˜åŒ–

#### 8.2.1 æŸ¥è¯¢è®¡åˆ’åˆ†æ

```sql
-- æŸ¥çœ‹æŸ¥è¯¢è®¡åˆ’
EXPLAIN ANALYZE
SELECT * FROM orders
WHERE merchant_id = 1 AND status = 'pending'
ORDER BY created_at DESC
LIMIT 10;
```

#### 8.2.2 æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§

- ä½¿ç”¨ç´¢å¼•å­—æ®µè¿›è¡Œè¿‡æ»¤
- é¿å… SELECT *
- ä½¿ç”¨ LIMIT é™åˆ¶ç»“æœé›†
- é¿å…åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨å‡½æ•°
- åˆç†ä½¿ç”¨ JOIN

### 8.3 è¿æ¥æ± é…ç½®

```typescript
import { Pool } from 'pg';

const pool = new Pool({
  host: process.env.DB_HOST,
  port: parseInt(process.env.DB_PORT || '5432'),
  database: process.env.DB_NAME,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  max: 20, // æœ€å¤§è¿æ¥æ•°
  min: 5, // æœ€å°è¿æ¥æ•°
  idleTimeoutMillis: 30000, // ç©ºé—²è¶…æ—¶
  connectionTimeoutMillis: 2000, // è¿æ¥è¶…æ—¶
  acquireTimeoutMillis: 10000, // è·å–è¿æ¥è¶…æ—¶
});

export default pool;
```

---

## 9. å®‰å…¨ç­–ç•¥

### 9.1 è®¿é—®æ§åˆ¶

#### 9.1.1 ç”¨æˆ·æƒé™

```sql
-- åˆ›å»ºåªè¯»ç”¨æˆ·
CREATE USER readonly_user WITH PASSWORD 'readonly_password';
GRANT CONNECT ON DATABASE yyc3_catering TO readonly_user;
GRANT USAGE ON SCHEMA public TO readonly_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;

-- åˆ›å»ºåº”ç”¨ç”¨æˆ·
CREATE USER app_user WITH PASSWORD 'app_password';
GRANT CONNECT ON DATABASE yyc3_catering TO app_user;
GRANT USAGE ON SCHEMA public TO app_user;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user;
```

#### 9.1.2 è¡Œçº§å®‰å…¨

```sql
-- å¯ç”¨è¡Œçº§å®‰å…¨
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- åˆ›å»ºç­–ç•¥
CREATE POLICY merchant_isolation ON orders
  FOR ALL
  TO app_user
  USING (merchant_id = current_setting('app.merchant_id')::bigint);
```

### 9.2 æ•°æ®åŠ å¯†

#### 9.2.1 ä¼ è¾“åŠ å¯†

- ä½¿ç”¨ SSL/TLS åŠ å¯†æ•°æ®åº“è¿æ¥
- é…ç½®å¼ºåˆ¶ SSL è¿æ¥

```bash
# postgresql.conf
ssl = on
ssl_cert_file = 'server.crt'
ssl_key_file = 'server.key'
```

#### 9.2.2 å­˜å‚¨åŠ å¯†

- æ•æ„Ÿå­—æ®µä½¿ç”¨ pgcrypto åŠ å¯†
- å¯†ç ä½¿ç”¨ bcrypt å“ˆå¸Œ

```sql
-- åˆ›å»ºæ‰©å±•
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- åŠ å¯†æ•°æ®
SELECT encrypt('sensitive data', 'encryption_key', 'aes');
```

### 9.3 å®¡è®¡æ—¥å¿—

```sql
-- åˆ›å»ºå®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE audit_logs (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT,
    action VARCHAR(50) NOT NULL,
    table_name VARCHAR(100) NOT NULL,
    record_id BIGINT,
    old_data JSONB,
    new_data JSONB,
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºè§¦å‘å™¨
CREATE OR REPLACE FUNCTION audit_trigger()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO audit_logs (action, table_name, record_id, new_data)
        VALUES ('INSERT', TG_TABLE_NAME, NEW.id, to_jsonb(NEW));
        RETURN NEW;
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO audit_logs (action, table_name, record_id, old_data, new_data)
        VALUES ('UPDATE', TG_TABLE_NAME, NEW.id, to_jsonb(OLD), to_jsonb(NEW));
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO audit_logs (action, table_name, record_id, old_data)
        VALUES ('DELETE', TG_TABLE_NAME, OLD.id, to_jsonb(OLD));
        RETURN OLD;
    END IF;
END;
$$ LANGUAGE plpgsql;
```

---

## 10. ç›‘æ§ä¸ç»´æŠ¤

### 10.1 æ€§èƒ½ç›‘æ§

#### 10.1.1 æ…¢æŸ¥è¯¢ç›‘æ§

```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
ALTER SYSTEM SET log_min_duration_statement = '1000'; -- 1ç§’

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT query, mean_exec_time, calls, total_exec_time
FROM pg_stat_statements
ORDER BY mean_exec_time DESC
LIMIT 10;
```

#### 10.1.2 è¿æ¥ç›‘æ§

```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥
SELECT * FROM pg_stat_activity;

-- æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
SELECT state, COUNT(*)
FROM pg_stat_activity
GROUP BY state;
```

### 10.2 å®¹é‡è§„åˆ’

#### 10.2.1 ç£ç›˜ç©ºé—´ç›‘æ§

```sql
-- æŸ¥çœ‹è¡¨å¤§å°
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

#### 10.2.2 æ•°æ®å¢é•¿é¢„æµ‹

```sql
-- æŸ¥çœ‹æ•°æ®å¢é•¿è¶‹åŠ¿
SELECT
    date_trunc('day', created_at) AS day,
    COUNT(*) AS records
FROM orders
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY day
ORDER BY day;
```

### 10.3 å®šæœŸç»´æŠ¤

#### 10.3.1 å®šæœŸæ¸…ç†

```bash
# æ¯å‘¨æ‰§è¡Œ VACUUM
0 2 * * 0 psql -U postgres -d yyc3_catering -c "VACUUM ANALYZE;"

# æ¯æœˆæ¸…ç†è¿‡æœŸæ•°æ®
0 3 1 * * psql -U postgres -d yyc3_catering -c "DELETE FROM user_sessions WHERE expires_at < NOW();"
```

#### 10.3.2 ç»Ÿè®¡ä¿¡æ¯æ›´æ–°

```sql
-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- æ›´æ–°ç‰¹å®šè¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE orders;
```

---

## ğŸ“„ æ–‡æ¡£æ ‡å°¾ (Footer)

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for Future***ã€
> ã€Œ***All things converge in cloud pivot; Deep stacks ignite a new era of intelligence***ã€




## æ¦‚è¿°

### æ¶æ„æ¦‚è¿°

æœ¬æ¶æ„æ–‡æ¡£è¯¦ç»†æè¿°äº†ç³»ç»Ÿçš„æ•´ä½“æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æ¶æ„ç›®æ ‡ã€è®¾è®¡åŸåˆ™ã€æŠ€æœ¯é€‰å‹ç­‰å…³é”®ä¿¡æ¯ã€‚

#### æ¶æ„ç›®æ ‡

- **é«˜å¯ç”¨æ€§**ï¼šç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤
- **é«˜æ€§èƒ½**ï¼šå“åº”è¿…é€Ÿï¼Œèµ„æºåˆ©ç”¨é«˜æ•ˆ
- **é«˜å®‰å…¨æ€§**ï¼šæ•°æ®åŠ å¯†ï¼Œæƒé™ä¸¥æ ¼æ§åˆ¶
- **é«˜æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºåŠŸèƒ½æ‰©å±•
- **é«˜å¯ç»´æŠ¤æ€§**ï¼šä»£ç æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„

#### è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **ä¾èµ–å€’ç½®**ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
- **æ¥å£éš”ç¦»**ï¼šä½¿ç”¨ç»†ç²’åº¦çš„æ¥å£
- **è¿ªç±³ç‰¹æ³•åˆ™**ï¼šæœ€å°‘çŸ¥è¯†åŸåˆ™



## æ¶æ„è®¾è®¡

### æ¶æ„è®¾è®¡

#### æ•´ä½“æ¶æ„

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

- **è¡¨ç°å±‚**ï¼šè´Ÿè´£ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
- **åº”ç”¨å±‚**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘
- **ä¸šåŠ¡å±‚**ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
- **æ•°æ®å±‚**ï¼šç®¡ç†æ•°æ®å­˜å‚¨å’Œè®¿é—®
- **åŸºç¡€è®¾æ–½å±‚**ï¼šæä¾›åŸºç¡€æœåŠ¡æ”¯æŒ

#### æ¨¡å—åˆ’åˆ†

ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šåŠŸèƒ½ï¼š

- **ç”¨æˆ·æ¨¡å—**ï¼šç”¨æˆ·ç®¡ç†å’Œè®¤è¯
- **è®¢å•æ¨¡å—**ï¼šè®¢å•å¤„ç†å’Œç®¡ç†
- **æ”¯ä»˜æ¨¡å—**ï¼šæ”¯ä»˜é›†æˆå’Œå¤„ç†
- **é€šçŸ¥æ¨¡å—**ï¼šæ¶ˆæ¯é€šçŸ¥å’Œæ¨é€
- **æŠ¥è¡¨æ¨¡å—**ï¼šæ•°æ®ç»Ÿè®¡å’Œåˆ†æ

#### æŠ€æœ¯é€‰å‹

- **å‰ç«¯æ¡†æ¶**ï¼šReact / Vue
- **åç«¯æ¡†æ¶**ï¼šNode.js / Express / Fastify
- **æ•°æ®åº“**ï¼šPostgreSQL / MongoDB
- **ç¼“å­˜**ï¼šRedis
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQ / Kafka



## æŠ€æœ¯å®ç°

### æŠ€æœ¯å®ç°

#### æ ¸å¿ƒæŠ€æœ¯æ ˆ

```typescript
// æ ¸å¿ƒä¾èµ–
{
  "dependencies": {
    "react": "^18.0.0",
    "typescript": "^5.0.0",
    "express": "^4.18.0",
    "prisma": "^5.0.0",
    "redis": "^4.6.0"
  }
}
```

#### å…³é”®å®ç°

1. **æœåŠ¡å±‚å®ç°**
```typescript
class UserService {
  async createUser(data: CreateUserDto): Promise<User> {
    // éªŒè¯è¾“å…¥
    this.validateUserData(data);
    
    // åŠ å¯†å¯†ç 
    const hashedPassword = await this.hashPassword(data.password);
    
    // åˆ›å»ºç”¨æˆ·
    const user = await this.userRepository.create({
      ...data,
      password: hashedPassword
    });
    
    return user;
  }
}
```

2. **ä¸­é—´ä»¶å®ç°**
```typescript
const authMiddleware = async (req: Request, res: Response, next: NextFunction) => {
  const token = req.headers.authorization?.split(' ')[1];
  
  if (!token) {
    return res.status(401).json({ error: 'æœªæˆæƒè®¿é—®' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'ä»¤ç‰Œæ— æ•ˆ' });
  }
};
```



## éƒ¨ç½²æ–¹æ¡ˆ

### éƒ¨ç½²æ–¹æ¡ˆ

#### éƒ¨ç½²æ¶æ„

é‡‡ç”¨å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼Œä½¿ç”¨Dockerå’ŒKubernetesè¿›è¡Œç¼–æ’ã€‚

#### éƒ¨ç½²æ­¥éª¤

1. **ç¯å¢ƒå‡†å¤‡**
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com | sh

# å®‰è£…Kubernetes
# æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„å®‰è£…æ–¹å¼
```

2. **æ„å»ºé•œåƒ**
```bash
# æ„å»ºåº”ç”¨é•œåƒ
docker build -t yyc3-app:latest .

# æ¨é€åˆ°é•œåƒä»“åº“
docker push registry.example.com/yyc3-app:latest
```

3. **éƒ¨ç½²åˆ°Kubernetes**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: yyc3-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: yyc3-app
  template:
    metadata:
      labels:
        app: yyc3-app
    spec:
      containers:
      - name: app
        image: registry.example.com/yyc3-app:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
```

4. **é…ç½®æœåŠ¡**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: yyc3-app-service
spec:
  selector:
    app: yyc3-app
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer
```



## æ€§èƒ½ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–

#### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**
```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));

function App() {
  return (
    <Suspense fallback={<Loading />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const MemoizedComponent = React.memo(({ data }) => {
  return <div>{data.value}</div>;
});

// useMemo ç¼“å­˜è®¡ç®—ç»“æœ
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(data);
}, [data]);
```

#### åç«¯ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**
```typescript
// ä½¿ç”¨ç´¢å¼•
CREATE INDEX idx_user_email ON users(email);

// æŸ¥è¯¢ä¼˜åŒ–
const users = await prisma.user.findMany({
  select: {
    id: true,
    name: true,
    email: true
  },
  where: {
    active: true
  },
  take: 100
});
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// Redisç¼“å­˜
async function getUser(id: string): Promise<User> {
  const cacheKey = `user:${id}`;
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }
  
  // ä»æ•°æ®åº“è·å–
  const user = await prisma.user.findUnique({ where: { id } });
  
  // å†™å…¥ç¼“å­˜
  await redis.setex(cacheKey, 3600, JSON.stringify(user));
  
  return user;
}
```



## å®‰å…¨è€ƒè™‘

### å®‰å…¨è€ƒè™‘

#### è®¤è¯ä¸æˆæƒ

1. **JWTè®¤è¯**
```typescript
// ç”ŸæˆJWTä»¤ç‰Œ
const token = jwt.sign(
  { userId: user.id, role: user.role },
  process.env.JWT_SECRET,
  { expiresIn: '24h' }
);

// éªŒè¯JWTä»¤ç‰Œ
const decoded = jwt.verify(token, process.env.JWT_SECRET);
```

2. **RBACæˆæƒ**
```typescript
// è§’è‰²æƒé™æ£€æŸ¥
function checkPermission(user: User, resource: string, action: string): boolean {
  const permissions = rolePermissions[user.role];
  return permissions.some(p => 
    p.resource === resource && p.actions.includes(action)
  );
}
```

#### æ•°æ®ä¿æŠ¤

1. **è¾“å…¥éªŒè¯**
```typescript
// ä½¿ç”¨Zodè¿›è¡Œè¾“å…¥éªŒè¯
const createUserSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8).regex(/[A-Z]/),
  name: z.string().min(2)
});

const validated = createUserSchema.parse(input);
```

2. **æ•°æ®åŠ å¯†**
```typescript
// ä½¿ç”¨bcryptåŠ å¯†å¯†ç 
const hashedPassword = await bcrypt.hash(password, 10);

// éªŒè¯å¯†ç 
const isValid = await bcrypt.compare(password, hashedPassword);
```

#### å®‰å…¨å¤´é…ç½®

```typescript
// Expresså®‰å…¨å¤´é…ç½®
app.use(helmet());
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS?.split(','),
  credentials: true
}));
```



## ç›‘æ§å‘Šè­¦

### ç›‘æ§å‘Šè­¦

#### ç›‘æ§æŒ‡æ ‡

1. **ç³»ç»ŸæŒ‡æ ‡**
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œI/O

2. **åº”ç”¨æŒ‡æ ‡**
- è¯·æ±‚é‡(RPS)
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
- å¹¶å‘ç”¨æˆ·æ•°

3. **ä¸šåŠ¡æŒ‡æ ‡**
- ç”¨æˆ·æ³¨å†Œæ•°
- è®¢å•åˆ›å»ºæ•°
- æ”¯ä»˜æˆåŠŸç‡
- ç”¨æˆ·æ´»è·ƒåº¦

#### ç›‘æ§å·¥å…·

```typescript
// PrometheusæŒ‡æ ‡æ”¶é›†
import { Counter, Histogram, Gauge } from 'prom-client';

const requestCounter = new Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status']
});

const responseTime = new Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTP request duration in seconds',
  labelNames: ['method', 'route']
});

// ä½¿ç”¨ä¸­é—´ä»¶è®°å½•æŒ‡æ ‡
app.use((req, res, next) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;
    requestCounter.inc({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    });
    responseTime.observe({
      method: req.method,
      route: req.route?.path || req.path
    }, duration);
  });
  
  next();
});
```

#### å‘Šè­¦è§„åˆ™

```yaml
groups:
- name: api_alerts
  rules:
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "APIé”™è¯¯ç‡è¿‡é«˜"
      description: "5åˆ†é’Ÿå†…é”™è¯¯ç‡è¶…è¿‡5%"
  
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, http_request_duration_seconds) > 1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "APIå“åº”æ—¶é—´è¿‡é•¿"
      description: "95%åˆ†ä½å“åº”æ—¶é—´è¶…è¿‡1ç§’"
```



## æœ€ä½³å®è·µ

### æœ€ä½³å®è·µ

#### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
```typescript
// å˜é‡ï¼šcamelCase
const userName = 'John';

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_RETRY_COUNT = 3;

// ç±»ï¼šPascalCase
class UserService { }

// æ¥å£ï¼šPascalCaseï¼Œå‰ç¼€Iï¼ˆå¯é€‰ï¼‰
interface IUserService { }
```

2. **æ³¨é‡Šè§„èŒƒ**
```typescript
/**
 * åˆ›å»ºç”¨æˆ·
 * @param email - ç”¨æˆ·é‚®ç®±
 * @param password - ç”¨æˆ·å¯†ç 
 * @returns åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
 * @throws {Error} å½“é‚®ç®±å·²å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 */
async function createUser(
  email: string, 
  password: string
): Promise<User> {
  // å®ç°
}
```

#### é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message);
    this.name = this.constructor.name;
    Error.captureStackTrace(this, this.constructor);
  }
}

// ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      success: false,
      error: err.message
    });
  }
  
  // è®°å½•æœªé¢„æœŸçš„é”™è¯¯
  logger.error('Unexpected error:', err);
  
  return res.status(500).json({
    success: false,
    error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  });
});
```

#### æ—¥å¿—è®°å½•

```typescript
// ç»“æ„åŒ–æ—¥å¿—
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// ä½¿ç”¨æ—¥å¿—
logger.info('User created', { userId: user.id, email: user.email });
logger.error('Database connection failed', { error: error.message });
```


## ç›¸å…³æ–‡æ¡£

- [ğŸ”– YYCÂ³ æ•°æ®æ¶æ„è¯¦ç»†è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/04-YYC3-Cater--æ¶æ„ç±»-æ•°æ®æ¶æ„è¯¦ç»†è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [YYC3 åˆç°ç³»ç»Ÿè‰²](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/16-YYC3-Cater--æ¶æ„ç±»-ç³»ç»Ÿè‰²è®¾è®¡è§„èŒƒ.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ ç›‘æ§æ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/09-YYC3-Cater--æ¶æ„ç±»-ç›‘æ§æ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ éƒ¨ç½²æ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/07-YYC3-Cater--æ¶æ„ç±»-éƒ¨ç½²æ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ æ™ºèƒ½æ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/08-YYC3-Cater--æ¶æ„ç±»-æ™ºèƒ½æ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
