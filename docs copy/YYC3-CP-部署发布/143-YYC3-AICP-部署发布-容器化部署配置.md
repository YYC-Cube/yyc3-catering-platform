---
@file: 143-YYC3-AICP-éƒ¨ç½²å‘å¸ƒ-å®¹å™¨åŒ–éƒ¨ç½²é…ç½®.md
@description: YYC3-AICP Docker+K8så®¹å™¨åŒ–éƒ¨ç½²çš„é…ç½®æ–‡ä»¶ã€é•œåƒæ„å»ºã€ç¼–æ’è§„åˆ™
@author: YanYuCloudCube Team
@version: v1.0.0
@created: 2025-12-29
@updated: 2025-12-29
@status: published
@tags: [éƒ¨ç½²å‘å¸ƒ],[å®¹å™¨åŒ–],[Docker]
---

> ***YanYuCloudCube***
> **æ ‡è¯­**ï¼šè¨€å¯è±¡é™ | è¯­æ¢æœªæ¥
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **æ ‡è¯­**ï¼šä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 143-YYC3-AICP-éƒ¨ç½²å‘å¸ƒ-å®¹å™¨åŒ–éƒ¨ç½²é…ç½®

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°YYC3-YYC3-AICP-éƒ¨ç½²å‘å¸ƒ-å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ç›¸å…³å†…å®¹ï¼Œç¡®ä¿é¡¹ç›®æŒ‰ç…§YYCÂ³æ ‡å‡†è§„èŒƒè¿›è¡Œå¼€å‘å’Œå®æ–½ã€‚

## æ ¸å¿ƒå†…å®¹

### 1. èƒŒæ™¯ä¸ç›®æ ‡

#### 1.1 é¡¹ç›®èƒŒæ™¯
YYCÂ³(YanYuCloudCube)-ã€Œæ™ºèƒ½æ•™è‚²ã€é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºã€Œäº”é«˜äº”æ ‡äº”åŒ–ã€ç†å¿µçš„æ™ºèƒ½åŒ–åº”ç”¨ç³»ç»Ÿï¼Œè‡´åŠ›äºæä¾›é«˜è´¨é‡ã€é«˜å¯ç”¨ã€é«˜å®‰å…¨çš„æˆé•¿å®ˆæŠ¤ä½“ç³»ã€‚

#### 1.2 æ–‡æ¡£ç›®æ ‡
- è§„èŒƒå®¹å™¨åŒ–éƒ¨ç½²é…ç½®ç›¸å…³çš„ä¸šåŠ¡æ ‡å‡†ä¸æŠ€æœ¯è½åœ°è¦æ±‚
- ä¸ºé¡¹ç›®ç›¸å…³äººå‘˜æä¾›æ¸…æ™°çš„å‚è€ƒä¾æ®
- ä¿éšœç›¸å…³æ¨¡å—å¼€å‘ã€å®æ–½ã€è¿ç»´çš„ä¸€è‡´æ€§ä¸è§„èŒƒæ€§

### 2. è®¾è®¡åŸåˆ™

#### 2.1 äº”é«˜åŸåˆ™
- **é«˜å¯ç”¨æ€§**ï¼šç¡®ä¿ç³»ç»Ÿ7x24å°æ—¶ç¨³å®šè¿è¡Œ
- **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–å“åº”æ—¶é—´å’Œå¤„ç†èƒ½åŠ›
- **é«˜å®‰å…¨æ€§**ï¼šä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œéšç§å®‰å…¨
- **é«˜æ‰©å±•æ€§**ï¼šæ”¯æŒä¸šåŠ¡å¿«é€Ÿæ‰©å±•
- **é«˜å¯ç»´æŠ¤æ€§**ï¼šä¾¿äºåç»­ç»´æŠ¤å’Œå‡çº§

#### 2.2 äº”æ ‡ä½“ç³»
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„æŠ€æœ¯å’Œæµç¨‹æ ‡å‡†
- **è§„èŒƒåŒ–**ï¼šä¸¥æ ¼çš„å¼€å‘å’Œç®¡ç†è§„èŒƒ
- **è‡ªåŠ¨åŒ–**ï¼šæé«˜å¼€å‘æ•ˆç‡å’Œè´¨é‡
- **æ™ºèƒ½åŒ–**ï¼šåˆ©ç”¨AIæŠ€æœ¯æå‡èƒ½åŠ›
- **å¯è§†åŒ–**ï¼šç›´è§‚çš„ç›‘æ§å’Œç®¡ç†ç•Œé¢

#### 2.3 äº”åŒ–æ¶æ„
- **æµç¨‹åŒ–**ï¼šæ ‡å‡†åŒ–çš„å¼€å‘æµç¨‹
- **æ–‡æ¡£åŒ–**ï¼šå®Œå–„çš„æ–‡æ¡£ä½“ç³»
- **å·¥å…·åŒ–**ï¼šé«˜æ•ˆçš„å¼€å‘å·¥å…·é“¾
- **æ•°å­—åŒ–**ï¼šæ•°æ®é©±åŠ¨çš„å†³ç­–
- **ç”Ÿæ€åŒ–**ï¼šå¼€æ”¾çš„ç”Ÿæ€ç³»ç»Ÿ

### 3. å®¹å™¨åŒ–éƒ¨ç½²é…ç½®

#### 3.1 Dockerfile é…ç½®

##### 3.1.1 å‰ç«¯ Dockerfile

```dockerfile
# å¤šé˜¶æ®µæ„å»º - æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ package æ–‡ä»¶
COPY package*.json ./
COPY pnpm-lock.yaml ./

# å®‰è£… pnpm
RUN npm install -g pnpm

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN pnpm build

# ç”Ÿäº§é˜¶æ®µ
FROM node:18-alpine AS production

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/package*.json ./

# å®‰è£…ç”Ÿäº§ä¾èµ–
RUN npm install -g pnpm && pnpm install --prod --frozen-lockfile

# æš´éœ²ç«¯å£
EXPOSE 3000

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=production
ENV PORT=3000

# å¯åŠ¨å‘½ä»¤
CMD ["pnpm", "start"]
```

##### 3.1.2 åç«¯ Dockerfile

```dockerfile
# å¤šé˜¶æ®µæ„å»º - æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ package æ–‡ä»¶
COPY package*.json ./
COPY pnpm-lock.yaml ./

# å®‰è£… pnpm
RUN npm install -g pnpm

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN pnpm build

# ç”Ÿäº§é˜¶æ®µ
FROM node:18-alpine AS production

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# åˆ›å»ºé root ç”¨æˆ·
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nextjs -u 1001

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/package*.json ./

# å®‰è£…ç”Ÿäº§ä¾èµ–
RUN npm install -g pnpm && pnpm install --prod --frozen-lockfile

# æ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€…
RUN chown -R nextjs:nodejs /app

# åˆ‡æ¢ç”¨æˆ·
USER nextjs

# æš´éœ²ç«¯å£
EXPOSE 3100

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=production
ENV PORT=3100

# å¯åŠ¨å‘½ä»¤
CMD ["node", "dist/main.js"]
```

#### 3.2 Kubernetes éƒ¨ç½²é…ç½®

##### 3.2.1 å‰ç«¯ Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: yyc3-catering-frontend
  namespace: yyc3-catering
  labels:
    app: yyc3-catering-frontend
    version: v1.0.0
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: yyc3-catering-frontend
  template:
    metadata:
      labels:
        app: yyc3-catering-frontend
        version: v1.0.0
    spec:
      containers:
      - name: frontend
        image: registry.example.com/yyc3-catering/frontend:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 3000
          name: http
          protocol: TCP
        env:
        - name: NODE_ENV
          value: "production"
        - name: API_BASE_URL
          valueFrom:
            configMapKeyRef:
              name: yyc3-catering-config
              key: api_base_url
        - name: NEXT_PUBLIC_API_URL
          valueFrom:
            configMapKeyRef:
              name: yyc3-catering-config
              key: next_public_api_url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /health
            port: 3000
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
        volumeMounts:
        - name: config
          mountPath: /app/.env.local
          subPath: .env.local
          readOnly: true
      volumes:
      - name: config
        configMap:
          name: yyc3-catering-config
          items:
          - key: frontend_env
            path: .env.local
```

##### 3.2.2 åç«¯ Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: yyc3-catering-backend
  namespace: yyc3-catering
  labels:
    app: yyc3-catering-backend
    version: v1.0.0
spec:
  replicas: 2
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: yyc3-catering-backend
  template:
    metadata:
      labels:
        app: yyc3-catering-backend
        version: v1.0.0
    spec:
      containers:
      - name: backend
        image: registry.example.com/yyc3-catering/backend:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 3100
          name: http
          protocol: TCP
        env:
        - name: NODE_ENV
          value: "production"
        - name: PORT
          value: "3100"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: yyc3-catering-secrets
              key: database_url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: yyc3-catering-secrets
              key: redis_url
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: yyc3-catering-secrets
              key: jwt_secret
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3100
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /health
            port: 3100
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
      volumes:
      - name: logs
        emptyDir: {}
```

##### 3.2.3 Service é…ç½®

```yaml
apiVersion: v1
kind: Service
metadata:
  name: yyc3-catering-frontend-service
  namespace: yyc3-catering
  labels:
    app: yyc3-catering-frontend
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 3000
    protocol: TCP
    name: http
  selector:
    app: yyc3-catering-frontend
---
apiVersion: v1
kind: Service
metadata:
  name: yyc3-catering-backend-service
  namespace: yyc3-catering
  labels:
    app: yyc3-catering-backend
spec:
  type: ClusterIP
  ports:
  - port: 3100
    targetPort: 3100
    protocol: TCP
    name: http
  selector:
    app: yyc3-catering-backend
```

##### 3.2.4 Ingress é…ç½®

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: yyc3-catering-ingress
  namespace: yyc3-catering
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
spec:
  tls:
  - hosts:
    - api.yyc3-catering.com
    - www.yyc3-catering.com
    secretName: yyc3-catering-tls
  rules:
  - host: api.yyc3-catering.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: yyc3-catering-backend-service
            port:
              number: 3100
  - host: www.yyc3-catering.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: yyc3-catering-frontend-service
            port:
              number: 80
```

#### 3.3 Helm Charts é…ç½®

##### 3.3.1 Chart.yaml

```yaml
apiVersion: v2
name: yyc3-catering-platform
description: YYC3 Catering Platform - A Helm chart for Kubernetes
type: application
version: 1.0.0
appVersion: "1.0.0"
keywords:
  - catering
  - platform
  - yyc3
maintainers:
  - name: YYC Team
    email: admin@0379.email
```

##### 3.3.2 values.yaml

```yaml
global:
  imageRegistry: registry.example.com
  imagePullSecrets: []
  storageClass: standard

frontend:
  enabled: true
  replicaCount: 3
  image:
    repository: yyc3-catering/frontend
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 80
    targetPort: 3000
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  nodeSelector: {}
  tolerations: []
  affinity: {}

backend:
  enabled: true
  replicaCount: 2
  image:
    repository: yyc3-catering/backend
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 3100
    targetPort: 3100
  resources:
    requests:
      memory: 512Mi
      cpu: 500m
    limits:
      memory: 1Gi
      cpu: 1000m
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  nodeSelector: {}
  tolerations: []
  affinity: {}

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: www.yyc3-catering.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
    - host: api.yyc3-catering.com
      paths:
        - path: /
          pathType: Prefix
          service: backend
  tls:
    - secretName: yyc3-catering-tls
      hosts:
        - www.yyc3-catering.com
        - api.yyc3-catering.com

database:
  enabled: true
  host: postgres.yyc3-catering.svc.cluster.local
  port: 5432
  database: yyc3_catering
  username: yyc3_user
  existingSecret: yyc3-catering-secrets
  existingSecretKey: database_url

redis:
  enabled: true
  host: redis.yyc3-catering.svc.cluster.local
  port: 6379
  existingSecret: yyc3-catering-secrets
  existingSecretKey: redis_url

secrets:
  enabled: true
  databaseUrl: postgresql://user:password@postgres:5432/yyc3_catering
  redisUrl: redis://redis:6379
  jwtSecret: your-jwt-secret-key-here

configMap:
  enabled: true
  apiBaseUrl: https://api.yyc3-catering.com
  nextPublicApiUrl: https://api.yyc3-catering.com
  frontendEnv: |
    NEXT_PUBLIC_API_URL=https://api.yyc3-catering.com
    NODE_ENV=production
```

##### 3.3.3 éƒ¨ç½²æ¨¡æ¿

```yaml
# templates/frontend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "yyc3-catering-platform.fullname" . }}-frontend
  labels:
    {{- include "yyc3-catering-platform.labels" . | nindent 4 }}
    app.kubernetes.io/component: frontend
spec:
  {{- if not .Values.frontend.autoscaling.enabled }}
  replicas: {{ .Values.frontend.replicaCount }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "yyc3-catering-platform.selectorLabels" . | nindent 6 }}
      app.kubernetes.io/component: frontend
  template:
    metadata:
      labels:
        {{- include "yyc3-catering-platform.selectorLabels" . | nindent 8 }}
        app.kubernetes.io/component: frontend
    spec:
      containers:
      - name: frontend
        image: "{{ .Values.global.imageRegistry }}/{{ .Values.frontend.image.repository }}:{{ .Values.frontend.image.tag | default .Chart.AppVersion }}"
        imagePullPolicy: {{ .Values.frontend.image.pullPolicy }}
        ports:
        - containerPort: 3000
          name: http
          protocol: TCP
        env:
        - name: NODE_ENV
          value: "production"
        - name: NEXT_PUBLIC_API_URL
          value: {{ .Values.configMap.nextPublicApiUrl | quote }}
        resources:
          {{- toYaml .Values.frontend.resources | nindent 10 }}
        livenessProbe:
          httpGet:
            path: /health
            port: http
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: http
          initialDelaySeconds: 10
          periodSeconds: 5
```

#### 3.4 é•œåƒæ„å»ºæµç¨‹

##### 3.4.1 æ„å»ºè„šæœ¬

```bash
#!/bin/bash
# build-images.sh

set -e

REGISTRY="registry.example.com/yyc3-catering"
VERSION="${1:-latest}"
FRONTEND_TAG="${REGISTRY}/frontend:${VERSION}"
BACKEND_TAG="${REGISTRY}/backend:${VERSION}"

echo "ğŸ”¨ æ„å»ºå‰ç«¯é•œåƒ..."
docker build -t ${FRONTEND_TAG} -f docker/frontend/Dockerfile .

echo "ğŸ”¨ æ„å»ºåç«¯é•œåƒ..."
docker build -t ${BACKEND_TAG} -f docker/backend/Dockerfile .

echo "ğŸ“¤ æ¨é€é•œåƒåˆ°ä»“åº“..."
docker push ${FRONTEND_TAG}
docker push ${BACKEND_TAG}

echo "âœ… é•œåƒæ„å»ºå®Œæˆï¼"
echo "å‰ç«¯é•œåƒ: ${FRONTEND_TAG}"
echo "åç«¯é•œåƒ: ${BACKEND_TAG}"
```

##### 3.4.2 CI/CD é…ç½®

```yaml
name: Build and Push Docker Images

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
    
    - name: Login to Docker Registry
      uses: docker/login-action@v2
      with:
        registry: registry.example.com
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
    
    - name: Build and push Frontend
      uses: docker/build-push-action@v4
      with:
        context: .
        file: ./docker/frontend/Dockerfile
        push: true
        tags: |
          registry.example.com/yyc3-catering/frontend:latest
          registry.example.com/yyc3-catering/frontend:${{ github.sha }}
        cache-from: type=registry,ref=registry.example.com/yyc3-catering/frontend:buildcache
        cache-to: type=registry,ref=registry.example.com/yyc3-catering/frontend:buildcache,mode=max
    
    - name: Build and push Backend
      uses: docker/build-push-action@v4
      with:
        context: .
        file: ./docker/backend/Dockerfile
        push: true
        tags: |
          registry.example.com/yyc3-catering/backend:latest
          registry.example.com/yyc3-catering/backend:${{ github.sha }}
        cache-from: type=registry,ref=registry.example.com/yyc3-catering/backend:buildcache
        cache-to: type=registry,ref=registry.example.com/yyc3-catering/backend:buildcache,mode=max
```

#### 3.5 ç¯å¢ƒå˜é‡é…ç½®

##### 3.5.1 ConfigMap

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: yyc3-catering-config
  namespace: yyc3-catering
data:
  api_base_url: "https://api.yyc3-catering.com"
  next_public_api_url: "https://api.yyc3-catering.com"
  frontend_env: |
    NEXT_PUBLIC_API_URL=https://api.yyc3-catering.com
    NEXT_PUBLIC_APP_NAME=YYC3 Catering Platform
    NEXT_PUBLIC_APP_VERSION=1.0.0
    NODE_ENV=production
```

##### 3.5.2 Secret

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: yyc3-catering-secrets
  namespace: yyc3-catering
type: Opaque
stringData:
  database_url: "postgresql://yyc3_user:password@postgres.yyc3-catering.svc.cluster.local:5432/yyc3_catering"
  redis_url: "redis://redis.yyc3-catering.svc.cluster.local:6379"
  jwt_secret: "your-jwt-secret-key-here"
```

#### 3.6 å®¹å™¨ç¼–æ’è§„åˆ™

##### 3.6.1 å¥åº·æ£€æŸ¥

```yaml
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1
```

##### 3.6.2 èµ„æºé™åˆ¶

```yaml
resources:
  requests:
    memory: "256Mi"
    cpu: "250m"
  limits:
    memory: "512Mi"
    cpu: "500m"
```

##### 3.6.3 è‡ªåŠ¨æ‰©ç¼©å®¹

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: yyc3-catering-frontend-hpa
  namespace: yyc3-catering
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: yyc3-catering-frontend
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

### 4. éƒ¨ç½²æµç¨‹

#### 4.1 æœ¬åœ°éƒ¨ç½²

```bash
# 1. æ„å»ºé•œåƒ
./scripts/build-images.sh

# 2. ä½¿ç”¨ Helm éƒ¨ç½²
helm install yyc3-catering ./helm/yyc3-catering-platform \
  --namespace yyc3-catering \
  --create-namespace \
  --values helm/yyc3-catering-platform/values-production.yaml

# 3. éªŒè¯éƒ¨ç½²
kubectl get pods -n yyc3-catering
kubectl get services -n yyc3-catering
kubectl get ingress -n yyc3-catering
```

#### 4.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. æ›´æ–°é•œåƒç‰ˆæœ¬
helm upgrade yyc3-catering ./helm/yyc3-catering-platform \
  --namespace yyc3-catering \
  --values helm/yyc3-catering-platform/values-production.yaml \
  --set frontend.image.tag=v1.0.1 \
  --set backend.image.tag=v1.0.1 \
  --wait

# 2. å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
helm rollback yyc3-catering -n yyc3-catering

# 3. æŸ¥çœ‹éƒ¨ç½²å†å²
helm history yyc3-catering -n yyc3-catering
```

### 5. ç›‘æ§ä¸æ—¥å¿—

#### 5.1 Prometheus é…ç½®

```yaml
apiVersion: v1
kind: Service
metadata:
  name: yyc3-catering-backend-metrics
  namespace: yyc3-catering
  labels:
    app: yyc3-catering-backend
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "3100"
    prometheus.io/path: "/metrics"
spec:
  selector:
    app: yyc3-catering-backend
  ports:
  - port: 3100
    targetPort: 3100
    name: metrics
```

#### 5.2 æ—¥å¿—æ”¶é›†

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-config
  namespace: yyc3-catering
data:
  fluent.conf: |
    <source>
      @type tail
      path /var/log/containers/*.log
      pos_file /var/log/fluentd-containers.log.pos
      tag kubernetes.*
      read_from_head true
      <parse>
        @type json
      </parse>
    </source>

    <match **>
      @type elasticsearch
      host elasticsearch.logging.svc.cluster.local
      port 9200
      logstash_format true
      logstash_prefix yyc3-catering
      <buffer>
        @type file
        path /var/log/fluentd-buffers/kubernetes.system.buffer
        flush_mode interval
        flush_interval 5s
      </buffer>
    </match>
```

### 6. å®‰å…¨é…ç½®

#### 6.1 ç½‘ç»œç­–ç•¥

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: yyc3-catering-network-policy
  namespace: yyc3-catering
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    ports:
    - protocol: TCP
      port: 3000
    - protocol: TCP
      port: 3100
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: yyc3-catering
    ports:
    - protocol: TCP
      port: 5432
    - protocol: TCP
      port: 6379
  - to:
    - namespaceSelector: {}
    ports:
    - protocol: TCP
      port: 53
    - protocol: UDP
      port: 53
```

#### 6.2 Pod å®‰å…¨ç­–ç•¥

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: yyc3-catering-backend
  namespace: yyc3-catering
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    fsGroup: 1001
  containers:
  - name: backend
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
        - ALL
```

---

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for the Future***ã€
> ã€Œ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***ã€
