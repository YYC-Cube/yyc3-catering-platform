# YYC³餐饮管理系统 - 订单管理功能模块需求分析与设计文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | 订单管理功能模块需求分析与设计文档 |
| 文档版本 | V1.0.0 |
| 创建日期 | 2025-01-20 |
| 作者 | YYC³团队 |
| 文档状态 | 正式发布 |

## 1. 概述

### 1.1 模块简介

订单管理模块是YYC³餐饮管理系统的核心业务模块，负责订单创建、查询、更新、批量操作等全方位的订单管理功能。该模块为餐饮企业提供了完整的订单管理解决方案，实现了订单处理流程的标准化、规范化和数字化。

### 1.2 模块目标

- 提供完整的订单创建和管理功能
- 实现订单状态跟踪和流程可视化
- 支持多种订单类型（堂食、外卖、自提等）
- 提供订单搜索、筛选和排序功能
- 实现订单批量操作
- 支持订单详情查看和编辑
- 提供订单数据统计和分析
- 确保订单处理符合业务流程

### 1.3 适用范围

本模块适用于YYC³餐饮管理系统的所有版本，支持单店和连锁店的订单管理。

## 2. 功能需求

### 2.1 订单列表管理

#### 2.1.1 订单列表展示

**功能描述**：展示系统中所有订单信息，支持搜索、筛选、排序和分页。

**输入参数**：
- 关键词：订单号、客户姓名、电话
- 订单状态：待确认、已确认、制作中、已完成、已取消、已退款
- 订单类型：堂食、外卖、自提
- 时间范围：下单时间区间
- 支付状态：待支付、已支付、已退款
- 页码：当前页码
- 每页数量：每页显示数量

**输出结果**：
- 订单列表：包含订单基本信息
- 总数：符合条件的订单总数
- 统计数据：各状态订单数量

**字段说明**：
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | number | 是 | 订单ID |
| orderNo | string | 是 | 订单编号 |
| customerId | number | 是 | 客户ID |
| customerName | string | 是 | 客户姓名 |
| customerPhone | string | 是 | 客户电话 |
| type | string | 是 | 订单类型：dine_in/takeaway/delivery |
| status | string | 是 | 订单状态：pending/confirmed/preparing/completed/cancelled/refunded |
| paymentStatus | string | 是 | 支付状态：unpaid/paid/refunded |
| totalAmount | number | 是 | 订单总金额 |
| discountAmount | number | 否 | 优惠金额 |
| actualAmount | number | 是 | 实付金额 |
| paymentMethod | string | 是 | 支付方式：wechat/alipay/cash/card |
| tableNumber | string | 否 | 桌号（堂食订单） |
| address | object | 否 | 配送地址（外卖订单） |
| items | array | 是 | 订单商品列表 |
| notes | string | 否 | 订单备注 |
| priority | string | 是 | 优先级：normal/urgent/emergency |
| estimatedTime | number | 否 | 预计完成时间（分钟） |
| actualTime | number | 否 | 实际完成时间（分钟） |
| createdAt | string | 是 | 创建时间 |
| updatedAt | string | 否 | 更新时间 |
| completedAt | string | 否 | 完成时间 |

**订单商品字段**：
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | number | 是 | 商品ID |
| itemId | number | 是 | 菜品ID |
| itemName | string | 是 | 菜品名称 |
| quantity | number | 是 | 数量 |
| price | number | 是 | 单价 |
| subtotal | number | 是 | 小计 |
| specifications | object | 否 | 规格选项 |
| notes | string | 否 | 商品备注 |

#### 2.1.2 订单筛选

**功能描述**：根据多种条件筛选订单列表。

**筛选条件**：
- 订单状态：单选或多选
- 订单类型：单选或多选
- 支付状态：单选或多选
- 时间范围：日期时间范围选择
- 优先级：单选或多选
- 桌号：模糊搜索
- 配送区域：区域选择（外卖订单）

#### 2.1.3 订单搜索

**功能描述**：通过关键词搜索订单。

**搜索字段**：
- 订单号：精确匹配
- 客户姓名：模糊匹配
- 客户电话：模糊匹配
- 菜品名称：模糊匹配

#### 2.1.4 订单排序

**功能描述**：对订单列表进行排序。

**排序字段**：
- 下单时间：升序/降序
- 订单金额：升序/降序
- 完成时间：升序/降序
- 优先级：升序/降序

#### 2.1.5 订单分页

**功能描述**：实现订单列表的分页展示。

**分页参数**：
- 当前页码
- 每页数量：10/20/50/100
- 总数
- 总页数

### 2.2 订单创建

#### 2.2.1 创建订单

**功能描述**：创建新的订单。

**输入参数**：
- 客户信息：姓名、电话、会员ID
- 订单类型：堂食/外卖/自提
- 桌号：堂食订单必填
- 配送地址：外卖订单必填
- 订单商品：菜品列表
- 订单备注：特殊要求
- 优惠信息：优惠券、折扣
- 预计时间：预计完成时间

**验证规则**：
- 客户信息必填
- 订单商品不能为空
- 商品数量必须大于0
- 堂食订单必须选择桌号
- 外卖订单必须填写配送地址
- 订单总金额必须大于0

**业务规则**：
- 自动生成订单编号
- 根据订单类型分配订单状态
- 堂食订单默认为待确认
- 外卖订单需要确认配送地址
- 自提订单需要确认取餐时间
- 计算订单总金额和实付金额
- 应用优惠券和折扣

#### 2.2.2 添加商品

**功能描述**：向订单中添加商品。

**输入参数**：
- 菜品ID
- 数量
- 规格选项
- 商品备注

**业务规则**：
- 检查菜品是否可用
- 检查库存是否充足
- 计算商品小计
- 更新订单总金额

#### 2.2.3 修改商品

**功能描述**：修改订单中的商品信息。

**输入参数**：
- 商品ID
- 新数量
- 新规格
- 新备注

**业务规则**：
- 数量不能为0（删除商品使用删除功能）
- 更新商品小计
- 更新订单总金额

#### 2.2.4 删除商品

**功能描述**：从订单中删除商品。

**输入参数**：
- 商品ID

**业务规则**：
- 更新订单总金额
- 如果是最后一个商品，提示确认删除

### 2.3 订单详情

#### 2.3.1 查看订单详情

**功能描述**：查看订单的详细信息。

**展示内容**：
- 订单基本信息：订单号、状态、类型、时间
- 客户信息：姓名、电话、地址
- 订单商品：商品列表、数量、金额
- 金额信息：总金额、优惠、实付
- 支付信息：支付方式、支付状态、支付时间
- 配送信息：配送地址、配送时间、配送员
- 备注信息：订单备注、商品备注
- 状态历史：订单状态变更记录
- 操作日志：订单操作记录

#### 2.3.2 订单流程可视化

**功能描述**：以可视化方式展示订单流程。

**展示内容**：
- 状态步骤：当前状态、已完成步骤、待完成步骤
- 时间线：每个状态的时间点
- 操作按钮：可执行的操作
- 阻塞提示：当前阻塞原因

**状态步骤**：
1. 待确认 → 已确认
2. 已确认 → 制作中
3. 制作中 → 已完成
4. 已完成 → 已上菜/已配送
5. 可取消：待确认、已确认
6. 可退款：已完成

### 2.4 订单状态管理

#### 2.4.1 确认订单

**功能描述**：将订单状态从待确认改为已确认。

**业务规则**：
- 只有待确认状态的订单可以确认
- 确认后订单进入制作流程
- 发送确认通知给客户
- 记录确认时间和操作人

#### 2.4.2 开始制作

**功能描述**：将订单状态从已确认改为制作中。

**业务规则**：
- 只有已确认状态的订单可以开始制作
- 分配厨房任务
- 发送制作通知给厨房
- 记录开始制作时间

#### 2.4.3 完成订单

**功能描述**：将订单状态从制作中改为已完成。

**业务规则**：
- 只有制作中状态的订单可以完成
- 堂食订单：通知服务员上菜
- 外卖订单：通知配送员取餐
- 自提订单：通知客户取餐
- 记录完成时间

#### 2.4.4 上菜/配送

**功能描述**：将订单状态从已完成改为已上菜/已配送。

**业务规则**：
- 堂食订单：标记为已上菜
- 外卖订单：标记为已配送
- 自提订单：标记为已取餐
- 记录上菜/配送时间

#### 2.4.5 取消订单

**功能描述**：取消订单。

**业务规则**：
- 待确认和已确认状态的订单可以取消
- 制作中的订单需要经理权限
- 已完成的订单不能取消
- 取消原因必填
- 发送取消通知给客户
- 处理退款（如已支付）
- 记录取消时间和原因

#### 2.4.6 退款订单

**功能描述**：对已完成订单进行退款。

**业务规则**：
- 只有已完成的订单可以退款
- 退款原因必填
- 退款金额不能超过实付金额
- 处理退款流程
- 发送退款通知
- 记录退款信息

### 2.5 订单批量操作

#### 2.5.1 批量确认

**功能描述**：批量确认多个订单。

**业务规则**：
- 只能批量确认待确认状态的订单
- 显示确认数量和总金额
- 确认后发送批量通知

#### 2.5.2 批量取消

**功能描述**：批量取消多个订单。

**业务规则**：
- 只能批量取消待确认和已确认状态的订单
- 取消原因统一填写
- 处理批量退款

#### 2.5.3 批量导出

**功能描述**：批量导出订单数据。

**导出格式**：
- Excel格式
- CSV格式
- PDF格式

**导出内容**：
- 订单基本信息
- 客户信息
- 订单商品
- 金额信息
- 状态信息

#### 2.5.4 批量打印

**功能描述**：批量打印订单小票。

**打印内容**：
- 订单基本信息
- 订单商品
- 金额信息
- 客户信息
- 时间信息

### 2.6 订单统计

#### 2.6.1 订单概览统计

**功能描述**：展示订单的概览统计数据。

**统计指标**：
- 今日订单数
- 今日完成数
- 今日取消数
- 今日营业额
- 待处理订单数
- 制作中订单数
- 平均完成时间
- 订单完成率

#### 2.6.2 订单趋势分析

**功能描述**：展示订单的时间趋势。

**分析维度**：
- 按小时：24小时趋势
- 按天：7天趋势
- 按周：4周趋势
- 按月：12个月趋势

**展示方式**：
- 折线图
- 柱状图

#### 2.6.3 订单类型分析

**功能描述**：分析不同类型订单的占比。

**分析维度**：
- 堂食订单占比
- 外卖订单占比
- 自提订单占比

**展示方式**：
- 饼图
- 环形图

#### 2.6.4 订单状态分析

**功能描述**：分析订单状态的分布。

**分析维度**：
- 各状态订单数量
- 各状态订单占比
- 状态流转时间

**展示方式**：
- 柱状图
- 饼图

#### 2.6.5 订单金额分析

**功能描述**：分析订单金额的分布。

**分析维度**：
- 金额区间分布
- 平均订单金额
- 最高/最低订单金额
- 客单价

**展示方式**：
- 直方图
- 统计卡片

### 2.7 订单视图模式

#### 2.7.1 列表视图

**功能描述**：以表格形式展示订单列表。

**展示内容**：
- 订单号
- 客户信息
- 订单类型
- 订单状态
- 订单金额
- 下单时间
- 操作按钮

#### 2.7.2 看板视图

**功能描述**：以看板形式展示订单，按状态分组。

**分组方式**：
- 待确认
- 已确认
- 制作中
- 已完成
- 已取消

**展示内容**：
- 订单卡片
- 客户信息
- 订单商品
- 订单金额
- 时间信息
- 操作按钮

#### 2.7.3 时间线视图

**功能描述**：以时间线形式展示订单。

**排序方式**：
- 按下单时间
- 按完成时间

**展示内容**：
- 时间节点
- 订单信息
- 状态标识
- 操作按钮

## 3. 非功能需求

### 3.1 性能需求

- 订单列表加载时间 < 1秒
- 订单详情加载时间 < 0.5秒
- 支持同时展示1000+订单
- 批量操作响应时间 < 2秒
- 统计数据计算时间 < 1秒

### 3.2 可用性需求

- 界面简洁直观，易于操作
- 支持键盘快捷键
- 提供操作提示和帮助
- 支持多语言切换

### 3.3 安全需求

- 订单数据加密传输
- 敏感信息脱敏显示
- 操作日志记录
- 权限控制

### 3.4 兼容性需求

- 支持主流浏览器
- 支持移动端访问
- 支持不同分辨率屏幕

## 4. 接口设计

### 4.1 订单列表接口

**接口地址**: `GET /api/orders`

**请求参数**:
```typescript
{
  page: number
  limit: number
  status?: string[]
  type?: string[]
  paymentStatus?: string[]
  dateRange?: [string, string]
  search?: string
  sortBy?: string
  sortOrder?: 'asc' | 'desc'
}
```

**响应数据**:
```typescript
{
  success: boolean
  data: {
    items: Order[]
    pagination: {
      page: number
      limit: number
      total: number
      totalPages: number
    }
  }
}
```

### 4.2 订单详情接口

**接口地址**: `GET /api/orders/:id`

**响应数据**:
```typescript
{
  success: boolean
  data: Order
}
```

### 4.3 创建订单接口

**接口地址**: `POST /api/orders`

**请求参数**:
```typescript
{
  customerId?: number
  customerName: string
  customerPhone: string
  type: 'dine_in' | 'takeaway' | 'delivery'
  tableNumber?: string
  address?: DeliveryAddress
  items: OrderItem[]
  notes?: string
  couponId?: string
  estimatedTime?: number
}
```

**响应数据**:
```typescript
{
  success: boolean
  data: Order
}
```

### 4.4 更新订单接口

**接口地址**: `PUT /api/orders/:id`

**请求参数**:
```typescript
{
  notes?: string
  estimatedTime?: number
  priority?: string
}
```

**响应数据**:
```typescript
{
  success: boolean
  data: Order
}
```

### 4.5 更新订单状态接口

**接口地址**: `PUT /api/orders/:id/status`

**请求参数**:
```typescript
{
  status: string
  reason?: string
}
```

**响应数据**:
```typescript
{
  success: boolean
  data: Order
}
```

### 4.6 取消订单接口

**接口地址**: `POST /api/orders/:id/cancel`

**请求参数**:
```typescript
{
  reason: string
}
```

**响应数据**:
```typescript
{
  success: boolean
  message: string
}
```

### 4.7 退款订单接口

**接口地址**: `POST /api/orders/:id/refund`

**请求参数**:
```typescript
{
  reason: string
  amount?: number
}
```

**响应数据**:
```typescript
{
  success: boolean
  message: string
}
```

### 4.8 批量操作接口

**接口地址**: `POST /api/orders/batch`

**请求参数**:
```typescript
{
  action: 'confirm' | 'cancel' | 'export' | 'print'
  orderIds: number[]
  reason?: string
}
```

**响应数据**:
```typescript
{
  success: boolean
  data: {
    success: number[]
    failed: Array<{ id: number; reason: string }>
  }
}
```

### 4.9 订单统计接口

**接口地址**: `GET /api/orders/statistics`

**请求参数**:
```typescript
{
  startDate?: string
  endDate?: string
  groupBy?: 'hour' | 'day' | 'week' | 'month'
}
```

**响应数据**:
```typescript
{
  success: boolean
  data: {
    overview: OrderOverview
    trends: OrderTrend[]
    typeDistribution: TypeDistribution
    statusDistribution: StatusDistribution
    amountDistribution: AmountDistribution
  }
}
```

## 5. 数据模型

### 5.1 订单实体

```typescript
interface Order {
  id: number
  orderNo: string
  customerId?: number
  customerName: string
  customerPhone: string
  type: 'dine_in' | 'takeaway' | 'delivery'
  status: OrderStatus
  paymentStatus: PaymentStatus
  totalAmount: number
  discountAmount: number
  actualAmount: number
  paymentMethod: PaymentMethod
  tableNumber?: string
  address?: DeliveryAddress
  items: OrderItem[]
  notes?: string
  priority: 'normal' | 'urgent' | 'emergency'
  estimatedTime?: number
  actualTime?: number
  createdAt: string
  updatedAt?: string
  completedAt?: string
}
```

### 5.2 订单商品实体

```typescript
interface OrderItem {
  id: number
  itemId: number
  itemName: string
  quantity: number
  price: number
  subtotal: number
  specifications?: ItemSpecifications
  notes?: string
}
```

### 5.3 订单状态枚举

```typescript
enum OrderStatus {
  PENDING = 'pending',
  CONFIRMED = 'confirmed',
  PREPARING = 'preparing',
  COMPLETED = 'completed',
  SERVED = 'served',
  CANCELLED = 'cancelled',
  REFUNDED = 'refunded'
}
```

### 5.4 支付状态枚举

```typescript
enum PaymentStatus {
  UNPAID = 'unpaid',
  PAID = 'paid',
  REFUNDED = 'refunded'
}
```

### 5.5 支付方式枚举

```typescript
enum PaymentMethod {
  WECHAT = 'wechat',
  ALIPAY = 'alipay',
  CASH = 'cash',
  CARD = 'card'
}
```

## 6. 用户界面设计

### 6.1 页面布局

- 顶部：订单统计概览卡片
- 中部：筛选和操作工具栏
- 主体：订单列表/看板/时间线视图
- 底部：分页控件

### 6.2 交互设计

- 点击订单查看详情
- 拖拽改变订单状态（看板视图）
- 右键菜单快速操作
- 键盘快捷键支持

### 6.3 响应式设计

- 桌面端：完整功能展示
- 平板端：优化布局
- 手机端：简化界面

## 7. 测试需求

### 7.1 单元测试

- 组件功能测试
- 工具函数测试
- 状态管理测试
- API接口测试

### 7.2 集成测试

- 订单流程测试
- 批量操作测试
- 状态流转测试

### 7.3 性能测试

- 大数据量测试
- 并发操作测试
- 响应时间测试

## 8. 部署要求

### 8.1 环境要求

- Node.js 18+
- 浏览器支持：Chrome 90+, Firefox 88+, Safari 14+, Edge 90+

### 8.2 配置要求

- API接口地址配置
- 文件上传配置
- 打印配置

## 9. 维护和升级

### 9.1 日志记录

- 操作日志
- 错误日志
- 性能日志

### 9.2 监控告警

- 订单异常监控
- 性能监控
- 错误告警

### 9.3 版本升级

- 数据迁移
- 功能兼容
- 用户通知

## 10. 附录

### 10.1 术语表

| 术语 | 说明 |
|------|------|
| 订单 | 客户购买商品的单据 |
| 订单号 | 订单的唯一标识 |
| 订单状态 | 订单当前的处理状态 |
| 订单类型 | 订单的服务方式：堂食、外卖、自提 |
| 订单商品 | 订单中包含的商品 |
| 订单金额 | 订单的总金额 |

### 10.2 参考文档

- YYC³餐饮管理系统总体设计文档
- YYC³餐饮管理系统技术架构文档
- YYC³餐饮管理系统数据库设计文档
