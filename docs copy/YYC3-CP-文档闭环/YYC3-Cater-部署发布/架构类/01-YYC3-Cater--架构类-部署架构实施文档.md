---

**@file**ï¼šYYCÂ³-éƒ¨ç½²æ¶æ„å®æ–½æ–‡æ¡£
**@description**ï¼šYYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°çš„éƒ¨ç½²æ¶æ„å®æ–½æ–‡æ¡£
**@author**ï¼šYYCÂ³
**@version**ï¼šv1.0.0
**@created**ï¼š2025-01-30
**@updated**ï¼š2025-01-30
**@status**ï¼špublished
**@tags**ï¼šæ¶æ„è®¾è®¡,éƒ¨ç½²,YYCÂ³,å®¹å™¨åŒ–

---
# ğŸ”– YYCÂ³ éƒ¨ç½²æ¶æ„å®æ–½æ–‡æ¡£

> ***YanYuCloudCube***
> **æ ‡è¯­**ï¼šè¨€å¯è±¡é™ | è¯­æ¢æœªæ¥
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **æ ‡è¯­**ï¼šä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| å±æ€§ | å†…å®¹ |
|------|------|
| **æ–‡æ¡£æ ‡é¢˜** | YYCÂ³ éƒ¨ç½²æ¶æ„å®æ–½æ–‡æ¡£ |
| **æ–‡æ¡£ç±»å‹** | æ¶æ„ç±»æ–‡æ¡£ |
| **æ‰€å±é˜¶æ®µ** | éƒ¨ç½²å‘å¸ƒ |
| **éµå¾ªè§„èŒƒ** | YYCÂ³ å›¢é˜Ÿæ ‡å‡†åŒ–è§„èŒƒ v1.0.0 |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-01-30 |
| **ä½œè€…** | YYCÂ³ Team |
| **æ›´æ–°æ—¥æœŸ** | 2025-01-30 |

---

## ğŸ“‘ ç›®å½•

1. [éƒ¨ç½²æ¶æ„æ¦‚è¿°](#1-éƒ¨ç½²æ¶æ„æ¦‚è¿°)
2. [åŸºç¡€è®¾æ–½è§„åˆ’](#2-åŸºç¡€è®¾æ–½è§„åˆ’)
3. [å®¹å™¨åŒ–éƒ¨ç½²](#3-å®¹å™¨åŒ–éƒ¨ç½²)
4. [Kubernetes ç¼–æ’](#4-kubernetes-ç¼–æ’)
5. [å¤šç¯å¢ƒç®¡ç†](#5-å¤šç¯å¢ƒç®¡ç†)
6. [ç›‘æ§ä¸æ—¥å¿—](#6-ç›‘æ§ä¸æ—¥å¿—)
7. [å¤‡ä»½ä¸æ¢å¤](#7-å¤‡ä»½ä¸æ¢å¤)
8. [æ€§èƒ½ä¼˜åŒ–](#8-æ€§èƒ½ä¼˜åŒ–)
9. [å®‰å…¨åŠ å›º](#9-å®‰å…¨åŠ å›º)
10. [è¿ç»´è‡ªåŠ¨åŒ–](#10-è¿ç»´è‡ªåŠ¨åŒ–)

---

## 1. æ¦‚è¿°

### 1.1 è¯´æ˜

æœ¬æ–‡æ¡£æ˜¯YYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°æ–‡æ¡£ä½“ç³»çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ—¨åœ¨æä¾›æ¸…æ™°ã€å®Œæ•´ã€å‡†ç¡®çš„ä¿¡æ¯ã€‚

é€šè¿‡æœ¬æ–‡æ¡£ï¼Œè¯»è€…å¯ä»¥ï¼š
- äº†è§£ç›¸å…³æ¦‚å¿µå’ŒèƒŒæ™¯
- æŒæ¡æ ¸å¿ƒå†…å®¹å’Œè¦ç‚¹
- è·å¾—å®ç”¨çš„æŒ‡å¯¼å’Œå¸®åŠ©
- å‚è€ƒç›¸å…³çš„èµ„æºå’Œèµ„æ–™

æ–‡æ¡£éµå¾ªYYCÂ³å›¢é˜Ÿæ ‡å‡†åŒ–è§„èŒƒï¼Œç¡®ä¿å†…å®¹è´¨é‡å’Œä¸€è‡´æ€§ã€‚

### 1.2 ç›®æ ‡

æœ¬æ–‡æ¡£çš„ä¸»è¦ç›®æ ‡åŒ…æ‹¬ï¼š

- **ä¿¡æ¯ä¼ é€’**ï¼šå‡†ç¡®ä¼ é€’ç›¸å…³ä¿¡æ¯å’ŒçŸ¥è¯†
- **æŒ‡å¯¼å®è·µ**ï¼šæä¾›å®ç”¨çš„æŒ‡å¯¼å’Œå‚è€ƒ
- **é™ä½æˆæœ¬**ï¼šå‡å°‘æ²Ÿé€šæˆæœ¬å’Œå­¦ä¹ æˆæœ¬
- **æé«˜æ•ˆç‡**ï¼šå¸®åŠ©è¯»è€…å¿«é€Ÿç†è§£å’Œåº”ç”¨

é€šè¿‡å®ç°è¿™äº›ç›®æ ‡ï¼Œæ–‡æ¡£èƒ½å¤Ÿä¸ºé¡¹ç›®çš„æˆåŠŸåšå‡ºé‡è¦è´¡çŒ®ã€‚

### 1.3 èŒƒå›´

æœ¬æ–‡æ¡£çš„é€‚ç”¨èŒƒå›´ï¼š

- **é€‚ç”¨å¯¹è±¡**ï¼šå¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜ã€è¿ç»´äººå‘˜ã€äº§å“ç»ç†ç­‰
- **é€‚ç”¨é˜¶æ®µ**ï¼šå¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€è¿ç»´ç­‰å„ä¸ªé˜¶æ®µ
- **é€‚ç”¨åœºæ™¯**ï¼šæ—¥å¸¸å¼€å‘ã€é—®é¢˜æ’æŸ¥ã€ç³»ç»Ÿç»´æŠ¤ç­‰

è¶…å‡ºæœ¬æ–‡æ¡£èŒƒå›´çš„å†…å®¹ï¼Œè¯·å‚è€ƒå…¶ä»–ç›¸å…³æ–‡æ¡£ã€‚

## 2. è¯¦ç»†å†…å®¹

### 2.1 æ ¸å¿ƒå†…å®¹

### 2.2 å®ç°ç»†èŠ‚

### 2.3 æ³¨æ„äº‹é¡¹

## 3. å‚è€ƒä¿¡æ¯

### 3.1 ç›¸å…³æ–‡æ¡£

### 3.2 å‚è€ƒèµ„æ–™

### 3.3 é™„å½•

## 1. éƒ¨ç½²æ¶æ„æ¦‚è¿°

### 1.1 æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è´Ÿè½½å‡è¡¡å±‚                        â”‚
â”‚      - Nginx / Cloudflare                 â”‚
â”‚      - SSL ç»ˆæ­¢                           â”‚
â”‚      - DDoS é˜²æŠ¤                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åº”ç”¨å±‚                            â”‚
â”‚      - Web æœåŠ¡                          â”‚
â”‚      - API æœåŠ¡                          â”‚
â”‚      - åå°ä»»åŠ¡                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®å±‚                            â”‚
â”‚      - PostgreSQL                        â”‚
â”‚      - Redis                             â”‚
â”‚      - MinIO (å¯¹è±¡å­˜å‚¨)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         åŸºç¡€è®¾æ–½å±‚                        â”‚
â”‚      - Kubernetes é›†ç¾¤                    â”‚
â”‚      - Docker å®¹å™¨                        â”‚
â”‚      - ç½‘ç»œä¸å­˜å‚¨                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 éƒ¨ç½²åŸåˆ™

- **é«˜å¯ç”¨æ€§**ï¼šç¡®ä¿ç³»ç»Ÿ 99.9% ä»¥ä¸Šçš„å¯ç”¨æ€§
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ°´å¹³å’Œå‚ç›´æ‰©å±•
- **è‡ªåŠ¨åŒ–**ï¼šå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ç›‘æ§å’Œæ¢å¤
- **å®‰å…¨æ€§**ï¼šç¡®ä¿éƒ¨ç½²è¿‡ç¨‹å’Œè¿è¡Œç¯å¢ƒçš„å®‰å…¨
- **å¯è§‚æµ‹æ€§**ï¼šæä¾›å®Œæ•´çš„ç›‘æ§ã€æ—¥å¿—å’Œè¿½è¸ªèƒ½åŠ›

### 1.3 ç«¯å£è§„åˆ’

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| Web æœåŠ¡ | 3200 | ä¸»åº”ç”¨æœåŠ¡ |
| API æœåŠ¡ | 3201 | API æ¥å£æœåŠ¡ |
| ç®¡ç†åå° | 3202 | ç®¡ç†åå°æœåŠ¡ |
| PostgreSQL | 5432 | æ•°æ®åº“æœåŠ¡ |
| Redis | 6379 | ç¼“å­˜æœåŠ¡ |
| MinIO | 9000 | å¯¹è±¡å­˜å‚¨æœåŠ¡ |

---

## 2. åŸºç¡€è®¾æ–½è§„åˆ’

### 2.1 æœåŠ¡å™¨è§„åˆ’

```yaml
# æœåŠ¡å™¨é…ç½®
servers:
  # ç”Ÿäº§ç¯å¢ƒ
  production:
    web:
      count: 3
      cpu: "4æ ¸"
      memory: "8GB"
      disk: "100GB SSD"
    api:
      count: 2
      cpu: "4æ ¸"
      memory: "8GB"
      disk: "100GB SSD"
    database:
      count: 2
      cpu: "8æ ¸"
      memory: "32GB"
      disk: "500GB SSD"
    redis:
      count: 2
      cpu: "2æ ¸"
      memory: "8GB"
      disk: "50GB SSD"

  # é¢„å‘å¸ƒç¯å¢ƒ
  staging:
    web:
      count: 2
      cpu: "2æ ¸"
      memory: "4GB"
      disk: "50GB SSD"
    api:
      count: 1
      cpu: "2æ ¸"
      memory: "4GB"
      disk: "50GB SSD"
    database:
      count: 1
      cpu: "4æ ¸"
      memory: "16GB"
      disk: "200GB SSD"
    redis:
      count: 1
      cpu: "1æ ¸"
      memory: "4GB"
      disk: "30GB SSD"
```

### 2.2 ç½‘ç»œè§„åˆ’

```yaml
# ç½‘ç»œé…ç½®
network:
  # VPC é…ç½®
  vpc:
    cidr: "10.0.0.0/16"
    subnets:
      public:
        cidr: "10.0.1.0/24"
        availability_zones: ["ap-northeast-1a", "ap-northeast-1c"]
      private:
        cidr: "10.0.2.0/24"
        availability_zones: ["ap-northeast-1a", "ap-northeast-1c"]
      database:
        cidr: "10.0.3.0/24"
        availability_zones: ["ap-northeast-1a", "ap-northeast-1c"]

  # å®‰å…¨ç»„è§„åˆ™
  security_groups:
    web:
      inbound:
        - port: 80
          protocol: tcp
          source: "0.0.0.0/0"
        - port: 443
          protocol: tcp
          source: "0.0.0.0/0"
      outbound:
        - port: 0
          protocol: "-1"
          destination: "0.0.0.0/0"

    api:
      inbound:
        - port: 3201
          protocol: tcp
          source: "10.0.0.0/16"
      outbound:
        - port: 0
          protocol: "-1"
          destination: "0.0.0.0/0"

    database:
      inbound:
        - port: 5432
          protocol: tcp
          source: "10.0.0.0/16"
      outbound:
        - port: 0
          protocol: "-1"
          destination: "0.0.0.0/0"
```

### 2.3 å­˜å‚¨è§„åˆ’

```yaml
# å­˜å‚¨é…ç½®
storage:
  # æ•°æ®åº“å­˜å‚¨
  database:
    type: "SSD"
    size: "500GB"
    iops: 10000
    throughput: "300 MB/s"
    backup:
      enabled: true
      retention: "30 days"
      schedule: "0 2 * * *"

  # å¯¹è±¡å­˜å‚¨
  object_storage:
    type: "MinIO"
    size: "1TB"
    buckets:
      - name: "uploads"
        versioning: true
        lifecycle:
          rules:
            - id: "delete_old_files"
              status: "Enabled"
              expiration:
                days: 90
      - name: "backups"
        versioning: true
        lifecycle:
          rules:
            - id: "delete_old_backups"
              status: "Enabled"
              expiration:
                days: 30

  # æ—¥å¿—å­˜å‚¨
  logs:
    type: "SSD"
    size: "200GB"
    retention: "7 days"
```

---

## 3. å®¹å™¨åŒ–éƒ¨ç½²

### 3.1 Dockerfile ç¤ºä¾‹

```dockerfile
# åŸºç¡€é•œåƒ
FROM node:18-alpine AS base

# å®‰è£…ä¾èµ–
FROM base AS deps
WORKDIR /app

# å¤åˆ¶ package æ–‡ä»¶
COPY package.json pnpm-lock.yaml* ./

# å®‰è£… pnpm
RUN npm install -g pnpm

# å®‰è£…ä¾èµ–
RUN pnpm install --frozen-lockfile

# æ„å»ºé˜¶æ®µ
FROM base AS builder
WORKDIR /app

COPY --from=deps /app/node_modules ./node_modules
COPY . .

# æ„å»ºåº”ç”¨
RUN pnpm build

# ç”Ÿäº§é•œåƒ
FROM base AS runner
WORKDIR /app

ENV NODE_ENV=production

# åˆ›å»ºé root ç”¨æˆ·
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# å¤åˆ¶å¿…è¦æ–‡ä»¶
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

# è®¾ç½®æƒé™
RUN chown -R nextjs:nodejs /app

USER nextjs

EXPOSE 3200

ENV PORT=3200
ENV HOSTNAME="0.0.0.0"

CMD ["node", "server.js"]
```

### 3.2 Docker Compose é…ç½®

```yaml
version: '3.8'

services:
  # Web æœåŠ¡
  web:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "3200:3200"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://user:password@postgres:5432/yyc3_cater
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3200/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # API æœåŠ¡
  api:
    build:
      context: .
      dockerfile: Dockerfile
    command: node api-server.js
    ports:
      - "3201:3201"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://user:password@postgres:5432/yyc3_cater
      - REDIS_URL=redis://redis:6379
    depends_on:
      - postgres
      - redis
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3201/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=yyc3_cater
    volumes:
      - postgres_data:/var/lib/postgresql/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d yyc3_cater"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis ç¼“å­˜
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # MinIO å¯¹è±¡å­˜å‚¨
  minio:
    image: minio/minio:latest
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

volumes:
  postgres_data:
  redis_data:
  minio_data:
```

---

## 4. Kubernetes ç¼–æ’

### 4.1 Deployment é…ç½®

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: yyc3-cater-web
  namespace: production
  labels:
    app: yyc3-cater
    component: web
spec:
  replicas: 3
  selector:
    matchLabels:
      app: yyc3-cater
      component: web
  template:
    metadata:
      labels:
        app: yyc3-cater
        component: web
    spec:
      containers:
      - name: web
        image: registry.example.com/yyc3-cater/web:latest
        ports:
        - containerPort: 3200
          name: http
        env:
        - name: NODE_ENV
          value: "production"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: yyc3-cater-secrets
              key: database-url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: yyc3-cater-secrets
              key: redis-url
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 3200
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /ready
            port: 3200
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
      imagePullSecrets:
      - name: registry-credentials
```

### 4.2 Service é…ç½®

```yaml
apiVersion: v1
kind: Service
metadata:
  name: yyc3-cater-web
  namespace: production
  labels:
    app: yyc3-cater
    component: web
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 3200
    protocol: TCP
    name: http
  selector:
    app: yyc3-cater
    component: web

---

apiVersion: v1
kind: Service
metadata:
  name: yyc3-cater-api
  namespace: production
  labels:
    app: yyc3-cater
    component: api
spec:
  type: ClusterIP
  ports:
  - port: 80
    targetPort: 3201
    protocol: TCP
    name: http
  selector:
    app: yyc3-cater
    component: api
```

### 4.3 Ingress é…ç½®

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: yyc3-cater-ingress
  namespace: production
  annotations:
    kubernetes.io/ingress.class: "nginx"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
spec:
  tls:
  - hosts:
    - api.yyc3-cater.com
    secretName: yyc3-cater-tls
  rules:
  - host: api.yyc3-cater.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: yyc3-cater-api
            port:
              number: 80
```

### 4.4 ConfigMap é…ç½®

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: yyc3-cater-config
  namespace: production
data:
  NODE_ENV: "production"
  LOG_LEVEL: "info"
  REDIS_MAX_RETRIES: "3"
  DATABASE_POOL_SIZE: "20"
  DATABASE_TIMEOUT: "30000"
```

### 4.5 Secret é…ç½®

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: yyc3-cater-secrets
  namespace: production
type: Opaque
stringData:
  database-url: "postgresql://user:password@postgres:5432/yyc3_cater"
  redis-url: "redis://redis:6379"
  jwt-secret: "your-jwt-secret"
  encryption-key: "your-encryption-key"
```

---

## 5. å¤šç¯å¢ƒç®¡ç†

### 5.1 ç¯å¢ƒé…ç½®

```typescript
// ç¯å¢ƒé…ç½®
export const environments = {
  development: {
    name: 'development',
    apiUrl: 'http://localhost:3201',
    webUrl: 'http://localhost:3200',
    databaseUrl: 'postgresql://user:password@localhost:5432/yyc3_cater_dev',
    redisUrl: 'redis://localhost:6379',
    minio: {
      endpoint: 'http://localhost:9000',
      accessKey: 'minioadmin',
      secretKey: 'minioadmin',
      bucket: 'yyc3-cater-dev'
    },
    logLevel: 'debug'
  },

  staging: {
    name: 'staging',
    apiUrl: 'https://api-staging.yyc3-cater.com',
    webUrl: 'https://staging.yyc3-cater.com',
    databaseUrl: process.env.DATABASE_URL,
    redisUrl: process.env.REDIS_URL,
    minio: {
      endpoint: process.env.MINIO_ENDPOINT,
      accessKey: process.env.MINIO_ACCESS_KEY,
      secretKey: process.env.MINIO_SECRET_KEY,
      bucket: 'yyc3-cater-staging'
    },
    logLevel: 'info'
  },

  production: {
    name: 'production',
    apiUrl: 'https://api.yyc3-cater.com',
    webUrl: 'https://www.yyc3-cater.com',
    databaseUrl: process.env.DATABASE_URL,
    redisUrl: process.env.REDIS_URL,
    minio: {
      endpoint: process.env.MINIO_ENDPOINT,
      accessKey: process.env.MINIO_ACCESS_KEY,
      secretKey: process.env.MINIO_SECRET_KEY,
      bucket: 'yyc3-cater-production'
    },
    logLevel: 'warn'
  }
};

// è·å–å½“å‰ç¯å¢ƒé…ç½®
export function getEnvConfig() {
  const env = process.env.NODE_ENV || 'development';
  return environments[env as keyof typeof environments] || environments.development;
}
```

### 5.2 ç¯å¢ƒå˜é‡ç®¡ç†

```bash
# .env.example
NODE_ENV=development
PORT=3200

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/yyc3_cater
DATABASE_POOL_SIZE=20
DATABASE_TIMEOUT=30000

# Redis é…ç½®
REDIS_URL=redis://localhost:6379
REDIS_MAX_RETRIES=3

# JWT é…ç½®
JWT_SECRET=your-jwt-secret
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=7d

# MinIO é…ç½®
MINIO_ENDPOINT=http://localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=yyc3-cater

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FORMAT=json

# ç›‘æ§é…ç½®
SENTRY_DSN=
SENTRY_ENVIRONMENT=development

# ç¬¬ä¸‰æ–¹æœåŠ¡
ALIYUN_ACCESS_KEY_ID=
ALIYUN_ACCESS_KEY_SECRET=
ALIYUN_SMS_SIGN_NAME=
ALIYUN_SMS_TEMPLATE_CODE=
```

---

## 6. ç›‘æ§ä¸æ—¥å¿—

### 6.1 ç›‘æ§é…ç½®

```yaml
# Prometheus é…ç½®
global:
  scrape_interval: 15s
  evaluation_interval: 15s

alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - alertmanager:9093

rule_files:
  - "alerts/*.yml"

scrape_configs:
  # åº”ç”¨ç›‘æ§
  - job_name: 'yyc3-cater-web'
    kubernetes_sd_configs:
    - role: pod
      namespaces:
        names:
        - production
    relabel_configs:
    - source_labels: [__meta_kubernetes_pod_label_app]
      action: keep
      regex: yyc3-cater
    - source_labels: [__meta_kubernetes_pod_label_component]
      action: keep
      regex: web
    - source_labels: [__meta_kubernetes_pod_ip]
      target_label: __address__
      replacement: $1:3200

  # æ•°æ®åº“ç›‘æ§
  - job_name: 'postgres'
    static_configs:
    - targets: ['postgres-exporter:9187']

  # Redis ç›‘æ§
  - job_name: 'redis'
    static_configs:
    - targets: ['redis-exporter:9121']

  # Node ç›‘æ§
  - job_name: 'node'
    static_configs:
    - targets: ['node-exporter:9100']
```

### 6.2 å‘Šè­¦è§„åˆ™

```yaml
groups:
- name: yyc3-cater-alerts
  interval: 30s
  rules:
  # åº”ç”¨å¯ç”¨æ€§å‘Šè­¦
  - alert: ApplicationDown
    expr: up{job="yyc3-cater-web"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "åº”ç”¨å®ä¾‹ {{ $labels.instance }} ä¸å¯ç”¨"
      description: "åº”ç”¨å®ä¾‹ {{ $labels.instance }} å·²ç»å®•æœºè¶…è¿‡ 1 åˆ†é’Ÿ"

  # é«˜é”™è¯¯ç‡å‘Šè­¦
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.05
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "é”™è¯¯ç‡è¿‡é«˜"
      description: "å®ä¾‹ {{ $labels.instance }} çš„ 5xx é”™è¯¯ç‡è¶…è¿‡ 5%"

  # é«˜å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighMemoryUsage
    expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) > 0.9
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
      description: "å®¹å™¨ {{ $labels.container }} çš„å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡ 90%"

  # é«˜ CPU ä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighCPUUsage
    expr: (rate(container_cpu_usage_seconds_total[5m]) / container_spec_cpu_quota) > 0.9
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "CPU ä½¿ç”¨ç‡è¿‡é«˜"
      description: "å®¹å™¨ {{ $labels.container }} çš„ CPU ä½¿ç”¨ç‡è¶…è¿‡ 90%"

  # æ•°æ®åº“è¿æ¥æ•°å‘Šè­¦
  - alert: DatabaseConnectionHigh
    expr: pg_stat_database_numbackends / pg_settings_max_connections > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "æ•°æ®åº“è¿æ¥æ•°è¿‡é«˜"
      description: "æ•°æ®åº“è¿æ¥æ•°å·²è¶…è¿‡æœ€å¤§è¿æ¥æ•°çš„ 80%"
```

### 6.3 æ—¥å¿—é…ç½®

```typescript
// Winston æ—¥å¿—é…ç½®
import winston from 'winston';

const logFormat = winston.format.combine(
  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
  winston.format.errors({ stack: true }),
  winston.format.splat(),
  winston.format.json()
);

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: logFormat,
  defaultMeta: {
    service: 'yyc3-cater',
    environment: process.env.NODE_ENV || 'development'
  },
  transports: [
    // æ§åˆ¶å°è¾“å‡º
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.printf(({ level, message, timestamp, ...metadata }) => {
          let msg = `${timestamp} [${level}]: ${message}`;
          if (Object.keys(metadata).length > 0) {
            msg += ` ${JSON.stringify(metadata)}`;
          }
          return msg;
        })
      )
    }),

    // é”™è¯¯æ—¥å¿—
    new winston.transports.File({
      filename: 'logs/error.log',
      level: 'error',
      maxsize: 5242880, // 5MB
      maxFiles: 5
    }),

    // æ‰€æœ‰æ—¥å¿—
    new winston.transports.File({
      filename: 'logs/combined.log',
      maxsize: 5242880, // 5MB
      maxFiles: 5
    })
  ]
});

// ç”Ÿäº§ç¯å¢ƒæ·»åŠ è¿œç¨‹æ—¥å¿—
if (process.env.NODE_ENV === 'production') {
  logger.add(new winston.transports.Http({
    host: process.env.LOG_HOST,
    port: parseInt(process.env.LOG_PORT || '8080'),
    path: '/logs',
    ssl: process.env.LOG_SSL === 'true'
  }));
}
```

---

## 7. å¤‡ä»½ä¸æ¢å¤

### 7.1 æ•°æ®åº“å¤‡ä»½

```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬

# é…ç½®
BACKUP_DIR="/backups/postgresql"
RETENTION_DAYS=30
DATABASE_URL="postgresql://user:password@postgres:5432/yyc3_cater"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p ${BACKUP_DIR}

# ç”Ÿæˆå¤‡ä»½æ–‡ä»¶å
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="${BACKUP_DIR}/backup_${TIMESTAMP}.sql.gz"

# æ‰§è¡Œå¤‡ä»½
pg_dump ${DATABASE_URL} | gzip > ${BACKUP_FILE}

# æ£€æŸ¥å¤‡ä»½æ˜¯å¦æˆåŠŸ
if [ $? -eq 0 ]; then
  echo "å¤‡ä»½æˆåŠŸ: ${BACKUP_FILE}"
else
  echo "å¤‡ä»½å¤±è´¥"
  exit 1
fi

# ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨
mc cp ${BACKUP_FILE} minio/yyc3-cater-backups/

# æ¸…ç†æ—§å¤‡ä»½
find ${BACKUP_DIR} -name "backup_*.sql.gz" -mtime +${RETENTION_DAYS} -delete

echo "å¤‡ä»½å®Œæˆ"
```

### 7.2 æ•°æ®æ¢å¤

```bash
#!/bin/bash
# æ•°æ®æ¢å¤è„šæœ¬

# é…ç½®
BACKUP_FILE=$1
DATABASE_URL="postgresql://user:password@postgres:5432/yyc3_cater"

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "${BACKUP_FILE}" ]; then
  echo "å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨: ${BACKUP_FILE}"
  exit 1
fi

# è§£å‹å¹¶æ¢å¤
gunzip -c ${BACKUP_FILE} | psql ${DATABASE_URL}

# æ£€æŸ¥æ¢å¤æ˜¯å¦æˆåŠŸ
if [ $? -eq 0 ]; then
  echo "æ¢å¤æˆåŠŸ"
else
  echo "æ¢å¤å¤±è´¥"
  exit 1
fi
```

### 7.3 è‡ªåŠ¨å¤‡ä»½é…ç½®

```yaml
# Kubernetes CronJob
apiVersion: batch/v1
kind: CronJob
metadata:
  name: postgres-backup
  namespace: production
spec:
  schedule: "0 2 * * *"  # æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œ
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: backup
            image: postgres:15-alpine
            command:
            - /bin/sh
            - -c
            - |
              pg_dump ${DATABASE_URL} | gzip > /backup/backup_$(date +%Y%m%d_%H%M%S).sql.gz
              mc cp /backup/backup_*.sql.gz minio/yyc3-cater-backups/
              find /backup -name "backup_*.sql.gz" -mtime +30 -delete
            env:
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: yyc3-cater-secrets
                  key: database-url
            - name: MINIO_ENDPOINT
              valueFrom:
                secretKeyRef:
                  name: yyc3-cater-secrets
                  key: minio-endpoint
            - name: MINIO_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: yyc3-cater-secrets
                  key: minio-access-key
            - name: MINIO_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  name: yyc3-cater-secrets
                  key: minio-secret-key
            volumeMounts:
            - name: backup
              mountPath: /backup
            - name: mc-config
              mountPath: /root/.mc
          volumes:
          - name: backup
            emptyDir: {}
          - name: mc-config
            configMap:
              name: mc-config
          restartPolicy: OnFailure
```

---

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 èµ„æºé™åˆ¶

```yaml
# èµ„æºé…ç½®ç¤ºä¾‹
resources:
  requests:
    memory: "512Mi"
    cpu: "250m"
  limits:
    memory: "1Gi"
    cpu: "500m"

# HPA é…ç½®
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: yyc3-cater-web-hpa
  namespace: production
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: yyc3-cater-web
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
```

### 8.2 æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_orders_merchant_id ON orders(merchant_id);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created_at ON orders(created_at);
CREATE INDEX idx_products_merchant_id ON products(merchant_id);
CREATE INDEX idx_products_category_id ON products(category_id);

-- æŸ¥è¯¢ä¼˜åŒ–
EXPLAIN ANALYZE
SELECT o.*, u.name as user_name
FROM orders o
JOIN users u ON o.user_id = u.id
WHERE o.merchant_id = 1
  AND o.status = 'completed'
  AND o.created_at >= '2025-01-01'
ORDER BY o.created_at DESC
LIMIT 20;

-- è¿æ¥æ± é…ç½®
ALTER SYSTEM SET max_connections = 200;
ALTER SYSTEM SET shared_buffers = '4GB';
ALTER SYSTEM SET effective_cache_size = '12GB';
ALTER SYSTEM SET maintenance_work_mem = '1GB';
ALTER SYSTEM SET checkpoint_completion_target = 0.9;
ALTER SYSTEM SET wal_buffers = '16MB';
ALTER SYSTEM SET default_statistics_target = 100;
```

### 8.3 Redis ä¼˜åŒ–

```bash
# Redis é…ç½®
maxmemory 2gb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec
```

---

## 9. å®‰å…¨åŠ å›º

### 9.1 ç½‘ç»œå®‰å…¨

```yaml
# NetworkPolicy é…ç½®
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: yyc3-cater-network-policy
  namespace: production
spec:
  podSelector:
    matchLabels:
      app: yyc3-cater
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: production
    ports:
    - protocol: TCP
      port: 3200
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: production
    ports:
    - protocol: TCP
      port: 5432
    - protocol: TCP
      port: 6379
```

### 9.2 Pod å®‰å…¨

```yaml
# PodSecurityPolicy
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: yyc3-cater-psp
spec:
  privileged: false
  allowPrivilegeEscalation: false
  requiredDropCapabilities:
  - ALL
  volumes:
  - 'configMap'
  - 'emptyDir'
  - 'projected'
  - 'secret'
  - 'downwardAPI'
  - 'persistentVolumeClaim'
  hostNetwork: false
  hostIPC: false
  hostPID: false
  runAsUser:
    rule: 'MustRunAsNonRoot'
  seLinux:
    rule: 'RunAsAny'
  fsGroup:
    rule: 'RunAsAny'
```

---

## 10. è¿ç»´è‡ªåŠ¨åŒ–

### 10.1 éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# è‡ªåŠ¨éƒ¨ç½²è„šæœ¬

set -euo pipefail

# é…ç½®
REGISTRY="registry.example.com"
IMAGE_NAME="yyc3-cater/web"
NAMESPACE="production"

# è·å–æœ€æ–°ç‰ˆæœ¬
VERSION=$(git describe --tags --always --dirty)

# æ„å»ºé•œåƒ
echo "æ„å»ºé•œåƒ: ${REGISTRY}/${IMAGE_NAME}:${VERSION}"
docker build -t ${REGISTRY}/${IMAGE_NAME}:${VERSION} .
docker tag ${REGISTRY}/${IMAGE_NAME}:${VERSION} ${REGISTRY}/${IMAGE_NAME}:latest

# æ¨é€é•œåƒ
echo "æ¨é€é•œåƒ"
docker push ${REGISTRY}/${IMAGE_NAME}:${VERSION}
docker push ${REGISTRY}/${IMAGE_NAME}:latest

# æ›´æ–° Kubernetes éƒ¨ç½²
echo "æ›´æ–°éƒ¨ç½²"
kubectl set image deployment/yyc3-cater-web \
  web=${REGISTRY}/${IMAGE_NAME}:${VERSION} \
  -n ${NAMESPACE}

# ç­‰å¾…éƒ¨ç½²å®Œæˆ
echo "ç­‰å¾…éƒ¨ç½²å®Œæˆ"
kubectl rollout status deployment/yyc3-cater-web -n ${NAMESPACE}

echo "éƒ¨ç½²å®Œæˆ"
```

### 10.2 å¥åº·æ£€æŸ¥

```typescript
// å¥åº·æ£€æŸ¥ç«¯ç‚¹
import { Request, Response } from 'express';

export async function healthCheck(req: Request, res: Response) {
  const checks = {
    status: 'healthy',
    timestamp: new Date().toISOString(),
    checks: {
      database: await checkDatabase(),
      redis: await checkRedis(),
      storage: await checkStorage()
    }
  };

  const allHealthy = Object.values(checks.checks).every(check => check.status === 'healthy');

  if (!allHealthy) {
    checks.status = 'unhealthy';
    return res.status(503).json(checks);
  }

  return res.json(checks);
}

async function checkDatabase() {
  try {
    await prisma.$queryRaw`SELECT 1`;
    return { status: 'healthy', message: 'Database connection OK' };
  } catch (error) {
    return { status: 'unhealthy', message: error.message };
  }
}

async function checkRedis() {
  try {
    await redis.ping();
    return { status: 'healthy', message: 'Redis connection OK' };
  } catch (error) {
    return { status: 'unhealthy', message: error.message };
  }
}

async function checkStorage() {
  try {
    // æ£€æŸ¥ MinIO è¿æ¥
    return { status: 'healthy', message: 'Storage connection OK' };
  } catch (error) {
    return { status: 'unhealthy', message: error.message };
  }
}
```

---

## ğŸ“„ æ–‡æ¡£æ ‡å°¾ (Footer)

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for Future***ã€
> ã€Œ***All things converge in cloud pivot; Deep stacks ignite a new era of intelligence***ã€




## æ¦‚è¿°

### æ¶æ„æ¦‚è¿°

æœ¬æ¶æ„æ–‡æ¡£è¯¦ç»†æè¿°äº†ç³»ç»Ÿçš„æ•´ä½“æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æ¶æ„ç›®æ ‡ã€è®¾è®¡åŸåˆ™ã€æŠ€æœ¯é€‰å‹ç­‰å…³é”®ä¿¡æ¯ã€‚

#### æ¶æ„ç›®æ ‡

- **é«˜å¯ç”¨æ€§**ï¼šç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤
- **é«˜æ€§èƒ½**ï¼šå“åº”è¿…é€Ÿï¼Œèµ„æºåˆ©ç”¨é«˜æ•ˆ
- **é«˜å®‰å…¨æ€§**ï¼šæ•°æ®åŠ å¯†ï¼Œæƒé™ä¸¥æ ¼æ§åˆ¶
- **é«˜æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºåŠŸèƒ½æ‰©å±•
- **é«˜å¯ç»´æŠ¤æ€§**ï¼šä»£ç æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„

#### è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **ä¾èµ–å€’ç½®**ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
- **æ¥å£éš”ç¦»**ï¼šä½¿ç”¨ç»†ç²’åº¦çš„æ¥å£
- **è¿ªç±³ç‰¹æ³•åˆ™**ï¼šæœ€å°‘çŸ¥è¯†åŸåˆ™



## æ¶æ„è®¾è®¡

### æ¶æ„è®¾è®¡

#### æ•´ä½“æ¶æ„

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

- **è¡¨ç°å±‚**ï¼šè´Ÿè´£ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
- **åº”ç”¨å±‚**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘
- **ä¸šåŠ¡å±‚**ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
- **æ•°æ®å±‚**ï¼šç®¡ç†æ•°æ®å­˜å‚¨å’Œè®¿é—®
- **åŸºç¡€è®¾æ–½å±‚**ï¼šæä¾›åŸºç¡€æœåŠ¡æ”¯æŒ

#### æ¨¡å—åˆ’åˆ†

ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šåŠŸèƒ½ï¼š

- **ç”¨æˆ·æ¨¡å—**ï¼šç”¨æˆ·ç®¡ç†å’Œè®¤è¯
- **è®¢å•æ¨¡å—**ï¼šè®¢å•å¤„ç†å’Œç®¡ç†
- **æ”¯ä»˜æ¨¡å—**ï¼šæ”¯ä»˜é›†æˆå’Œå¤„ç†
- **é€šçŸ¥æ¨¡å—**ï¼šæ¶ˆæ¯é€šçŸ¥å’Œæ¨é€
- **æŠ¥è¡¨æ¨¡å—**ï¼šæ•°æ®ç»Ÿè®¡å’Œåˆ†æ

#### æŠ€æœ¯é€‰å‹

- **å‰ç«¯æ¡†æ¶**ï¼šReact / Vue
- **åç«¯æ¡†æ¶**ï¼šNode.js / Express / Fastify
- **æ•°æ®åº“**ï¼šPostgreSQL / MongoDB
- **ç¼“å­˜**ï¼šRedis
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQ / Kafka



## æŠ€æœ¯å®ç°

### æŠ€æœ¯å®ç°

#### æ ¸å¿ƒæŠ€æœ¯æ ˆ

```typescript
// æ ¸å¿ƒä¾èµ–
{
  "dependencies": {
    "react": "^18.0.0",
    "typescript": "^5.0.0",
    "express": "^4.18.0",
    "prisma": "^5.0.0",
    "redis": "^4.6.0"
  }
}
```

#### å…³é”®å®ç°

1. **æœåŠ¡å±‚å®ç°**
```typescript
class UserService {
  async createUser(data: CreateUserDto): Promise<User> {
    // éªŒè¯è¾“å…¥
    this.validateUserData(data);
    
    // åŠ å¯†å¯†ç 
    const hashedPassword = await this.hashPassword(data.password);
    
    // åˆ›å»ºç”¨æˆ·
    const user = await this.userRepository.create({
      ...data,
      password: hashedPassword
    });
    
    return user;
  }
}
```

2. **ä¸­é—´ä»¶å®ç°**
```typescript
const authMiddleware = async (req: Request, res: Response, next: NextFunction) => {
  const token = req.headers.authorization?.split(' ')[1];
  
  if (!token) {
    return res.status(401).json({ error: 'æœªæˆæƒè®¿é—®' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'ä»¤ç‰Œæ— æ•ˆ' });
  }
};
```



## éƒ¨ç½²æ–¹æ¡ˆ

### éƒ¨ç½²æ–¹æ¡ˆ

#### éƒ¨ç½²æ¶æ„

é‡‡ç”¨å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼Œä½¿ç”¨Dockerå’ŒKubernetesè¿›è¡Œç¼–æ’ã€‚

#### éƒ¨ç½²æ­¥éª¤

1. **ç¯å¢ƒå‡†å¤‡**
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com | sh

# å®‰è£…Kubernetes
# æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„å®‰è£…æ–¹å¼
```

2. **æ„å»ºé•œåƒ**
```bash
# æ„å»ºåº”ç”¨é•œåƒ
docker build -t yyc3-app:latest .

# æ¨é€åˆ°é•œåƒä»“åº“
docker push registry.example.com/yyc3-app:latest
```

3. **éƒ¨ç½²åˆ°Kubernetes**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: yyc3-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: yyc3-app
  template:
    metadata:
      labels:
        app: yyc3-app
    spec:
      containers:
      - name: app
        image: registry.example.com/yyc3-app:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
```

4. **é…ç½®æœåŠ¡**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: yyc3-app-service
spec:
  selector:
    app: yyc3-app
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer
```



## æ€§èƒ½ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–

#### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**
```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));

function App() {
  return (
    <Suspense fallback={<Loading />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const MemoizedComponent = React.memo(({ data }) => {
  return <div>{data.value}</div>;
});

// useMemo ç¼“å­˜è®¡ç®—ç»“æœ
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(data);
}, [data]);
```

#### åç«¯ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**
```typescript
// ä½¿ç”¨ç´¢å¼•
CREATE INDEX idx_user_email ON users(email);

// æŸ¥è¯¢ä¼˜åŒ–
const users = await prisma.user.findMany({
  select: {
    id: true,
    name: true,
    email: true
  },
  where: {
    active: true
  },
  take: 100
});
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// Redisç¼“å­˜
async function getUser(id: string): Promise<User> {
  const cacheKey = `user:${id}`;
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }
  
  // ä»æ•°æ®åº“è·å–
  const user = await prisma.user.findUnique({ where: { id } });
  
  // å†™å…¥ç¼“å­˜
  await redis.setex(cacheKey, 3600, JSON.stringify(user));
  
  return user;
}
```



## å®‰å…¨è€ƒè™‘

### å®‰å…¨è€ƒè™‘

#### è®¤è¯ä¸æˆæƒ

1. **JWTè®¤è¯**
```typescript
// ç”ŸæˆJWTä»¤ç‰Œ
const token = jwt.sign(
  { userId: user.id, role: user.role },
  process.env.JWT_SECRET,
  { expiresIn: '24h' }
);

// éªŒè¯JWTä»¤ç‰Œ
const decoded = jwt.verify(token, process.env.JWT_SECRET);
```

2. **RBACæˆæƒ**
```typescript
// è§’è‰²æƒé™æ£€æŸ¥
function checkPermission(user: User, resource: string, action: string): boolean {
  const permissions = rolePermissions[user.role];
  return permissions.some(p => 
    p.resource === resource && p.actions.includes(action)
  );
}
```

#### æ•°æ®ä¿æŠ¤

1. **è¾“å…¥éªŒè¯**
```typescript
// ä½¿ç”¨Zodè¿›è¡Œè¾“å…¥éªŒè¯
const createUserSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8).regex(/[A-Z]/),
  name: z.string().min(2)
});

const validated = createUserSchema.parse(input);
```

2. **æ•°æ®åŠ å¯†**
```typescript
// ä½¿ç”¨bcryptåŠ å¯†å¯†ç 
const hashedPassword = await bcrypt.hash(password, 10);

// éªŒè¯å¯†ç 
const isValid = await bcrypt.compare(password, hashedPassword);
```

#### å®‰å…¨å¤´é…ç½®

```typescript
// Expresså®‰å…¨å¤´é…ç½®
app.use(helmet());
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS?.split(','),
  credentials: true
}));
```



## ç›‘æ§å‘Šè­¦

### ç›‘æ§å‘Šè­¦

#### ç›‘æ§æŒ‡æ ‡

1. **ç³»ç»ŸæŒ‡æ ‡**
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œI/O

2. **åº”ç”¨æŒ‡æ ‡**
- è¯·æ±‚é‡(RPS)
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
- å¹¶å‘ç”¨æˆ·æ•°

3. **ä¸šåŠ¡æŒ‡æ ‡**
- ç”¨æˆ·æ³¨å†Œæ•°
- è®¢å•åˆ›å»ºæ•°
- æ”¯ä»˜æˆåŠŸç‡
- ç”¨æˆ·æ´»è·ƒåº¦

#### ç›‘æ§å·¥å…·

```typescript
// PrometheusæŒ‡æ ‡æ”¶é›†
import { Counter, Histogram, Gauge } from 'prom-client';

const requestCounter = new Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status']
});

const responseTime = new Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTP request duration in seconds',
  labelNames: ['method', 'route']
});

// ä½¿ç”¨ä¸­é—´ä»¶è®°å½•æŒ‡æ ‡
app.use((req, res, next) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;
    requestCounter.inc({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    });
    responseTime.observe({
      method: req.method,
      route: req.route?.path || req.path
    }, duration);
  });
  
  next();
});
```

#### å‘Šè­¦è§„åˆ™

```yaml
groups:
- name: api_alerts
  rules:
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "APIé”™è¯¯ç‡è¿‡é«˜"
      description: "5åˆ†é’Ÿå†…é”™è¯¯ç‡è¶…è¿‡5%"
  
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, http_request_duration_seconds) > 1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "APIå“åº”æ—¶é—´è¿‡é•¿"
      description: "95%åˆ†ä½å“åº”æ—¶é—´è¶…è¿‡1ç§’"
```



## æœ€ä½³å®è·µ

### æœ€ä½³å®è·µ

#### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
```typescript
// å˜é‡ï¼šcamelCase
const userName = 'John';

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_RETRY_COUNT = 3;

// ç±»ï¼šPascalCase
class UserService { }

// æ¥å£ï¼šPascalCaseï¼Œå‰ç¼€Iï¼ˆå¯é€‰ï¼‰
interface IUserService { }
```

2. **æ³¨é‡Šè§„èŒƒ**
```typescript
/**
 * åˆ›å»ºç”¨æˆ·
 * @param email - ç”¨æˆ·é‚®ç®±
 * @param password - ç”¨æˆ·å¯†ç 
 * @returns åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
 * @throws {Error} å½“é‚®ç®±å·²å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 */
async function createUser(
  email: string, 
  password: string
): Promise<User> {
  // å®ç°
}
```

#### é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message);
    this.name = this.constructor.name;
    Error.captureStackTrace(this, this.constructor);
  }
}

// ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      success: false,
      error: err.message
    });
  }
  
  // è®°å½•æœªé¢„æœŸçš„é”™è¯¯
  logger.error('Unexpected error:', err);
  
  return res.status(500).json({
    success: false,
    error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  });
});
```

#### æ—¥å¿—è®°å½•

```typescript
// ç»“æ„åŒ–æ—¥å¿—
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// ä½¿ç”¨æ—¥å¿—
logger.info('User created', { userId: user.id, email: user.email });
logger.error('Database connection failed', { error: error.message });
```



## æœ€ä½³å®è·µ

### æœ€ä½³å®è·µ

#### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
```typescript
// å˜é‡ï¼šcamelCase
const userName = 'John';

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_RETRY_COUNT = 3;

// ç±»ï¼šPascalCase
class UserService { }

// æ¥å£ï¼šPascalCaseï¼Œå‰ç¼€Iï¼ˆå¯é€‰ï¼‰
interface IUserService { }
```

2. **æ³¨é‡Šè§„èŒƒ**
```typescript
/**
 * åˆ›å»ºç”¨æˆ·
 * @param email - ç”¨æˆ·é‚®ç®±
 * @param password - ç”¨æˆ·å¯†ç 
 * @returns åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
 * @throws {Error} å½“é‚®ç®±å·²å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 */
async function createUser(
  email: string, 
  password: string
): Promise<User> {
  // å®ç°
}
```

#### é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message);
    this.name = this.constructor.name;
    Error.captureStackTrace(this, this.constructor);
  }
}

// ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      success: false,
      error: err.message
    });
  }
  
  // è®°å½•æœªé¢„æœŸçš„é”™è¯¯
  logger.error('Unexpected error:', err);
  
  return res.status(500).json({
    success: false,
    error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  });
});
```

#### æ—¥å¿—è®°å½•

```typescript
// ç»“æ„åŒ–æ—¥å¿—
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// ä½¿ç”¨æ—¥å¿—
logger.info('User created', { userId: user.id, email: user.email });
logger.error('Database connection failed', { error: error.message });
```


## ç›¸å…³æ–‡æ¡£

- [ğŸ”– YYCÂ³ CI/CD æµæ°´çº¿æ¶æ„æ–‡æ¡£](YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»/02-YYC3-Cater--æ¶æ„ç±»-CI_CDæµæ°´çº¿æ¶æ„æ–‡æ¡£.md) - YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ å¤šç¯å¢ƒéƒ¨ç½²æ¶æ„å·®å¼‚æ–‡æ¡£](YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»/03-YYC3-Cater--æ¶æ„ç±»-å¤šç¯å¢ƒéƒ¨ç½²æ¶æ„å·®å¼‚æ–‡æ¡£.md) - YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»
- [YYCÂ³æ™ºæ¢æœåŠ¡åŒ–å¹³å° - é£é™©ç®¡ç†ä¸è´¨é‡ä¿éšœè®¡åˆ’](YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»/05-YYC3-Cater--æ¶æ„ç±»-é£é™©ç®¡ç†ä¸è´¨é‡ä¿éšœè®¡åˆ’.md) - YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ ç°åº¦å‘å¸ƒæ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»/04-YYC3-Cater--æ¶æ„ç±»-ç°åº¦å‘å¸ƒæ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ K8séƒ¨ç½²è¿ç»´æŠ€å·§](YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æŠ€å·§ç±»/02-YYC3-Cater--æŠ€å·§ç±»-K8séƒ¨ç½²è¿ç»´æŠ€å·§.md) - YYC3-Cater-éƒ¨ç½²å‘å¸ƒ/æŠ€å·§ç±»
