---

**@file**ï¼šYYCÂ³-APIæ¥å£è®¾è®¡æ–‡æ¡£
**@description**ï¼šYYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°çš„APIæ¥å£è®¾è®¡æ–‡æ¡£ï¼ŒåŒ…å«æ¥å£è®¾è®¡åŸåˆ™ã€æ¥å£è§„èŒƒã€æ¥å£åˆ—è¡¨ã€æ¥å£æ–‡æ¡£ã€æ¥å£æµ‹è¯•ç­‰æ ¸å¿ƒå†…å®¹
**@author**ï¼šYYCÂ³
**@version**ï¼šv1.0.0
**@created**ï¼š2025-01-30
**@updated**ï¼š2025-01-30
**@status**ï¼špublished
**@tags**ï¼šæ¶æ„è®¾è®¡,API,YYCÂ³,æ¥å£è®¾è®¡

---
# ğŸ”– YYCÂ³ API æ¥å£è®¾è®¡æ–‡æ¡£

> ***YanYuCloudCube***
> **æ ‡è¯­**ï¼šè¨€å¯è±¡é™ | è¯­æ¢æœªæ¥
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **æ ‡è¯­**ï¼šä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| å±æ€§ | å†…å®¹ |
|------|------|
| **æ–‡æ¡£æ ‡é¢˜** | YYCÂ³ API æ¥å£è®¾è®¡æ–‡æ¡£ |
| **æ–‡æ¡£ç±»å‹** | æ¶æ„è®¾è®¡ç±»æ–‡æ¡£ |
| **æ‰€å±é˜¶æ®µ** | æ¶æ„è®¾è®¡ |
| **éµå¾ªè§„èŒƒ** | YYCÂ³ å›¢é˜Ÿæ ‡å‡†åŒ–è§„èŒƒ v1.0.0 |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-01-30 |
| **ä½œè€…** | YYCÂ³ Team |
| **æ›´æ–°æ—¥æœŸ** | 2025-01-30 |

---

## ğŸ“‘ ç›®å½•

1. [API è®¾è®¡åŸåˆ™](#1-api-è®¾è®¡åŸåˆ™)
2. [API æ¶æ„](#2-api-æ¶æ„)
3. [æ¥å£è§„èŒƒ](#3-æ¥å£è§„èŒƒ)
4. [è®¤è¯æˆæƒ](#4-è®¤è¯æˆæƒ)
5. [æ ¸å¿ƒæ¥å£](#5-æ ¸å¿ƒæ¥å£)
6. [é”™è¯¯å¤„ç†](#6-é”™è¯¯å¤„ç†)
7. [ç‰ˆæœ¬æ§åˆ¶](#7-ç‰ˆæœ¬æ§åˆ¶)
8. [é™æµç­–ç•¥](#8-é™æµç­–ç•¥)
9. [æ–‡æ¡£ç®¡ç†](#9-æ–‡æ¡£ç®¡ç†)
10. [æµ‹è¯•ä¸ç›‘æ§](#10-æµ‹è¯•ä¸ç›‘æ§)

---

## 1. æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

æœ¬æ¶æ„è®¾è®¡æ–‡æ¡£æ—¨åœ¨ä¸ºYYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°æä¾›æ¸…æ™°ã€å®Œæ•´çš„æŠ€æœ¯æ¶æ„æŒ‡å¯¼ã€‚ä¸»è¦ç›®æ ‡åŒ…æ‹¬ï¼š

- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒä¸šåŠ¡å¿«é€Ÿæ‰©å±•ï¼Œæ¨¡å—åŒ–è®¾è®¡ä¾¿äºåŠŸèƒ½è¿­ä»£
- **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Œç¡®ä¿é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šè¿è¡Œ
- **é«˜å¯ç”¨æ€§**ï¼šå®ç°ç³»ç»Ÿé«˜å¯ç”¨ï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤ï¼Œä¿éšœä¸šåŠ¡è¿ç»­æ€§
- **å®‰å…¨æ€§**ï¼šå»ºç«‹å®Œå–„çš„å®‰å…¨ä½“ç³»ï¼Œä¿æŠ¤æ•°æ®å’Œç³»ç»Ÿå®‰å…¨
- **æ˜“ç»´æŠ¤æ€§**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„ï¼Œä¾¿äºå›¢é˜Ÿåä½œå’Œç»´æŠ¤

é€šè¿‡æœ¬æ¶æ„è®¾è®¡ï¼Œç¡®ä¿å¹³å°èƒ½å¤Ÿæ»¡è¶³å½“å‰ä¸šåŠ¡éœ€æ±‚ï¼Œå¹¶ä¸ºæœªæ¥çš„å‘å±•å¥ å®šåšå®åŸºç¡€ã€‚

### 1.2 è®¾è®¡åŸåˆ™

æ¶æ„è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

- **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„ä¸šåŠ¡åŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- **ä¾èµ–å€’ç½®åŸåˆ™**ï¼šé«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡
- **æ¥å£éš”ç¦»åŸåˆ™**ï¼šä½¿ç”¨ç»†ç²’åº¦çš„æ¥å£ï¼Œé¿å…æ¥å£æ±¡æŸ“
- **æœ€å°‘çŸ¥è¯†åŸåˆ™**ï¼šæ¨¡å—é—´æœ€å°åŒ–ä¾èµ–ï¼Œé™ä½è€¦åˆåº¦

åŒæ—¶éµå¾ªYYCÂ³ã€Œäº”é«˜äº”æ ‡äº”åŒ–ã€æ ¸å¿ƒç†å¿µï¼š
- **äº”é«˜**ï¼šé«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜å®‰å…¨ã€é«˜æ‰©å±•ã€é«˜å¯ç»´æŠ¤
- **äº”æ ‡**ï¼šæ ‡å‡†åŒ–ã€è§„èŒƒåŒ–ã€è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€å¯è§†åŒ–
- **äº”åŒ–**ï¼šæµç¨‹åŒ–ã€æ–‡æ¡£åŒ–ã€å·¥å…·åŒ–ã€æ•°å­—åŒ–ã€ç”Ÿæ€åŒ–

### 1.3 æŠ€æœ¯é€‰å‹

æŠ€æœ¯æ ˆé€‰æ‹©åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

**å‰ç«¯æŠ€æœ¯æ ˆ**
- React 18+ï¼šé‡‡ç”¨ç°ä»£åŒ–å‰ç«¯æ¡†æ¶ï¼Œç»„ä»¶åŒ–å¼€å‘
- TypeScript 5.0+ï¼šç±»å‹å®‰å…¨ï¼Œæé«˜ä»£ç è´¨é‡
- Next.js 14+ï¼šSSR/SSGæ”¯æŒï¼Œä¼˜åŒ–SEOå’Œæ€§èƒ½
- Tailwind CSSï¼šåŸå­åŒ–CSSï¼Œå¿«é€Ÿæ„å»ºUI

**åç«¯æŠ€æœ¯æ ˆ**
- Node.js 18+ï¼šé«˜æ€§èƒ½JavaScriptè¿è¡Œæ—¶
- Express/Fastifyï¼šè½»é‡çº§Webæ¡†æ¶
- PostgreSQL 15+ï¼šå…³ç³»å‹æ•°æ®åº“ï¼ŒACIDä¿è¯
- Redis 7+ï¼šç¼“å­˜å’Œä¼šè¯å­˜å‚¨

**åŸºç¡€è®¾æ–½**
- Dockerï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¯å¢ƒä¸€è‡´æ€§
- Kubernetesï¼šå®¹å™¨ç¼–æ’ï¼Œè‡ªåŠ¨åŒ–è¿ç»´
- Nginxï¼šåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
- Prometheus + Grafanaï¼šç›‘æ§å’Œå‘Šè­¦

**å¼€å‘å·¥å…·**
- Gitï¼šç‰ˆæœ¬æ§åˆ¶
- ESLint + Prettierï¼šä»£ç è§„èŒƒ
- Jest + Vitestï¼šå•å…ƒæµ‹è¯•
- GitHub Actionsï¼šCI/CDè‡ªåŠ¨åŒ–

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„

YYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºä»¥ä¸‹å±‚æ¬¡ï¼š

**è¡¨ç°å±‚ï¼ˆPresentation Layerï¼‰**
- Webå‰ç«¯ï¼šReact + Next.jsæ„å»ºçš„å•é¡µåº”ç”¨
- ç§»åŠ¨ç«¯ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒå¤šè®¾å¤‡è®¿é—®
- ç®¡ç†åå°ï¼šç‹¬ç«‹çš„ç®¡ç†ç•Œé¢

**åº”ç”¨å±‚ï¼ˆApplication Layerï¼‰**
- APIç½‘å…³ï¼šç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±åˆ†å‘
- ä¸šåŠ¡æœåŠ¡ï¼šè®¢å•ã€ç”¨æˆ·ã€å•†å“ç­‰æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- è®¤è¯æˆæƒï¼šJWTè®¤è¯ï¼ŒRBACæƒé™æ§åˆ¶

**é¢†åŸŸå±‚ï¼ˆDomain Layerï¼‰**
- é¢†åŸŸæ¨¡å‹ï¼šæ ¸å¿ƒä¸šåŠ¡å®ä½“å’Œè§„åˆ™
- é¢†åŸŸæœåŠ¡ï¼šå¤æ‚ä¸šåŠ¡é€»è¾‘å°è£…
- ä»“å‚¨æ¥å£ï¼šæ•°æ®è®¿é—®æŠ½è±¡

**åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructure Layerï¼‰**
- æ•°æ®åº“ï¼šPostgreSQLä¸»ä»æ¶æ„
- ç¼“å­˜ï¼šRedisé›†ç¾¤
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ/Kafka
- æ–‡ä»¶å­˜å‚¨ï¼šOSS/MinIO

**è·¨å±‚å…³æ³¨ç‚¹**
- æ—¥å¿—ç›‘æ§ï¼šELK Stack
- é…ç½®ç®¡ç†ï¼šApollo/Nacos
- æœåŠ¡å‘ç°ï¼šConsul/Eureka
- é“¾è·¯è¿½è¸ªï¼šJaeger/SkyWalking

### 2.2 æ¨¡å—åˆ’åˆ†

ç³»ç»ŸæŒ‰ç…§ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†ä¸ºä»¥ä¸‹æ ¸å¿ƒæ¨¡å—ï¼š

**ç”¨æˆ·æ¨¡å—ï¼ˆUser Moduleï¼‰**
- ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€è®¤è¯
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- æƒé™å’Œè§’è‰²ç®¡ç†

**å•†å“æ¨¡å—ï¼ˆProduct Moduleï¼‰**
- å•†å“ä¿¡æ¯ç®¡ç†
- å•†å“åˆ†ç±»å’Œæ ‡ç­¾
- åº“å­˜ç®¡ç†

**è®¢å•æ¨¡å—ï¼ˆOrder Moduleï¼‰**
- è®¢å•åˆ›å»ºå’Œæ”¯ä»˜
- è®¢å•çŠ¶æ€æµè½¬
- è®¢å•æŸ¥è¯¢å’Œç»Ÿè®¡

**æ”¯ä»˜æ¨¡å—ï¼ˆPayment Moduleï¼‰**
- æ”¯ä»˜æ¥å£é›†æˆ
- æ”¯ä»˜çŠ¶æ€åŒæ­¥
- é€€æ¬¾å¤„ç†

**è¥é”€æ¨¡å—ï¼ˆMarketing Moduleï¼‰**
- ä¼˜æƒ åˆ¸ç®¡ç†
- ä¿ƒé”€æ´»åŠ¨
- ä¼šå‘˜ç§¯åˆ†

**æŠ¥è¡¨æ¨¡å—ï¼ˆReport Moduleï¼‰**
- é”€å”®æŠ¥è¡¨
- æ•°æ®åˆ†æ
- å¯è§†åŒ–å±•ç¤º

**ç³»ç»Ÿæ¨¡å—ï¼ˆSystem Moduleï¼‰**
- é…ç½®ç®¡ç†
- æ—¥å¿—ç®¡ç†
- ç›‘æ§å‘Šè­¦

### 2.3 æ•°æ®æµå‘

## 3. æŠ€æœ¯å®ç°

### 3.1 æ ¸å¿ƒæŠ€æœ¯

### 3.2 å…³é”®ç®—æ³•

### 3.3 æ€§èƒ½ä¼˜åŒ–

## 4. æ¥å£è®¾è®¡

### 4.1 APIæ¥å£

### 4.2 æ•°æ®æ¥å£

### 4.3 æ¶ˆæ¯æ¥å£

## 5. éƒ¨ç½²æ–¹æ¡ˆ

### 5.1 éƒ¨ç½²æ¶æ„

### 5.2 é…ç½®ç®¡ç†

### 5.3 ç›‘æ§å‘Šè­¦

## 6. é™„å½•

### 6.1 æœ¯è¯­è¡¨

### 6.2 å‚è€ƒèµ„æ–™

## 1. API è®¾è®¡åŸåˆ™

### 1.1 RESTful è®¾è®¡åŸåˆ™

- **èµ„æºå¯¼å‘**ï¼šä»¥èµ„æºä¸ºä¸­å¿ƒè®¾è®¡ API
- **ç»Ÿä¸€æ¥å£**ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ¥å£è§„èŒƒ
- **æ— çŠ¶æ€**ï¼šæ¯ä¸ªè¯·æ±‚åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
- **å¯ç¼“å­˜**ï¼šæ”¯æŒ HTTP ç¼“å­˜æœºåˆ¶
- **åˆ†å±‚ç³»ç»Ÿ**ï¼šæ”¯æŒåˆ†å±‚æ¶æ„

### 1.2 è®¾è®¡è§„èŒƒ

| åŸåˆ™ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| åè¯å¤æ•° | èµ„æºä½¿ç”¨å¤æ•°å½¢å¼ | `/users`, `/orders` |
| HTTP æ–¹æ³• | ä½¿ç”¨æ­£ç¡®çš„ HTTP æ–¹æ³• | GET, POST, PUT, DELETE |
| çŠ¶æ€ç  | è¿”å›æ­£ç¡®çš„ HTTP çŠ¶æ€ç  | 200, 201, 400, 401, 404, 500 |
| åˆ†é¡µ | å¤§æ•°æ®é›†ä½¿ç”¨åˆ†é¡µ | `?page=1&limit=20` |
| è¿‡æ»¤ | æ”¯æŒæŸ¥è¯¢è¿‡æ»¤ | `?status=active&category=food` |
| æ’åº | æ”¯æŒç»“æœæ’åº | `?sort=createdAt&order=desc` |
| å­—æ®µé€‰æ‹© | æ”¯æŒå­—æ®µè¿‡æ»¤ | `?fields=id,name,email` |

### 1.3 å‘½åè§„èŒƒ

- **URL è·¯å¾„**ï¼šä½¿ç”¨ kebab-caseï¼Œå°å†™å­—æ¯
- **æŸ¥è¯¢å‚æ•°**ï¼šä½¿ç”¨ camelCase
- **JSON å­—æ®µ**ï¼šä½¿ç”¨ camelCase
- **æšä¸¾å€¼**ï¼šä½¿ç”¨ snake_case

```typescript
// URL è·¯å¾„ç¤ºä¾‹
GET /api/v1/merchants/{merchantId}/products
POST /api/v1/orders
PUT /api/v1/users/{userId}

// æŸ¥è¯¢å‚æ•°ç¤ºä¾‹
?status=active&page=1&limit=20&sortBy=createdAt&order=desc

// JSON å­—æ®µç¤ºä¾‹
{
  "userId": 123,
  "userName": "å¼ ä¸‰",
  "createdAt": "2025-01-30T10:00:00Z"
}
```

---

## 2. API æ¶æ„

### 2.1 æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å®¢æˆ·ç«¯å±‚ (Client)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      API ç½‘å…³å±‚ (API Gateway)            â”‚
â”‚      - è·¯ç”±åˆ†å‘                          â”‚
â”‚      - è®¤è¯æˆæƒ                          â”‚
â”‚      - é™æµç†”æ–­                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      åº”ç”¨å±‚ (Application)                â”‚
â”‚      - ä¸šåŠ¡é€»è¾‘                          â”‚
â”‚      - æ•°æ®éªŒè¯                          â”‚
â”‚      - äº‹åŠ¡ç®¡ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æœåŠ¡å±‚ (Service)                    â”‚
â”‚      - ç”¨æˆ·æœåŠ¡                          â”‚
â”‚      - å•†æˆ·æœåŠ¡                          â”‚
â”‚      - è®¢å•æœåŠ¡                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®è®¿é—®å±‚ (Repository)             â”‚
â”‚      - ORM æ“ä½œ                          â”‚
â”‚      - ç¼“å­˜ç®¡ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ•°æ®å±‚ (Database)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | ç”¨é€” |
|------|---------|------|------|
| API æ¡†æ¶ | Hono | 3+ | Web æ¡†æ¶ |
| éªŒè¯åº“ | Zod | 3+ | æ•°æ®éªŒè¯ |
| è®¤è¯ | JWT | 9+ | èº«ä»½è®¤è¯ |
| æ–‡æ¡£ | OpenAPI | 3.0 | API æ–‡æ¡£ |
| æµ‹è¯• | Vitest | 1+ | å•å…ƒæµ‹è¯• |

---

## 3. æ¥å£è§„èŒƒ

### 3.1 è¯·æ±‚è§„èŒƒ

#### 3.1.1 è¯·æ±‚å¤´

```typescript
// æ ‡å‡†è¯·æ±‚å¤´
{
  "Content-Type": "application/json",
  "Accept": "application/json",
  "Authorization": "Bearer {access_token}",
  "X-Request-ID": "uuid",
  "X-Client-Version": "1.0.0",
  "X-Device-ID": "device_uuid"
}
```

#### 3.1.2 è¯·æ±‚ä½“

```typescript
// åˆ›å»ºè®¢å•è¯·æ±‚ä½“ç¤ºä¾‹
{
  "merchantId": 123,
  "orderType": "dine_in",
  "tableNumber": "A01",
  "items": [
    {
      "productId": 456,
      "quantity": 2,
      "specialInstructions": "å°‘è¾£"
    }
  ],
  "notes": "å°½å¿«ä¸Šèœ"
}
```

### 3.2 å“åº”è§„èŒƒ

#### 3.2.1 å“åº”æ ¼å¼

```typescript
// æˆåŠŸå“åº”
{
  "success": true,
  "data": {
    // ä¸šåŠ¡æ•°æ®
  },
  "meta": {
    "timestamp": "2025-01-30T10:00:00Z",
    "requestId": "uuid"
  }
}

// åˆ†é¡µå“åº”
{
  "success": true,
  "data": [
    // æ•°æ®åˆ—è¡¨
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  },
  "meta": {
    "timestamp": "2025-01-30T10:00:00Z",
    "requestId": "uuid"
  }
}

// é”™è¯¯å“åº”
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å‚æ•°éªŒè¯å¤±è´¥",
    "details": [
      {
        "field": "email",
        "message": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
      }
    ]
  },
  "meta": {
    "timestamp": "2025-01-30T10:00:00Z",
    "requestId": "uuid"
  }
}
```

#### 3.2.2 HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|--------|------|---------|
| 200 | OK | è¯·æ±‚æˆåŠŸ |
| 201 | Created | èµ„æºåˆ›å»ºæˆåŠŸ |
| 204 | No Content | åˆ é™¤æˆåŠŸ |
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | Unauthorized | æœªè®¤è¯ |
| 403 | Forbidden | æ— æƒé™ |
| 404 | Not Found | èµ„æºä¸å­˜åœ¨ |
| 409 | Conflict | èµ„æºå†²çª |
| 422 | Unprocessable Entity | éªŒè¯å¤±è´¥ |
| 429 | Too Many Requests | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | Internal Server Error | æœåŠ¡å™¨é”™è¯¯ |

### 3.3 åˆ†é¡µè§„èŒƒ

#### 3.3.1 åˆ†é¡µå‚æ•°

```typescript
// è¯·æ±‚å‚æ•°
{
  "page": 1,        // é¡µç ï¼Œä» 1 å¼€å§‹
  "limit": 20,      // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20ï¼Œæœ€å¤§ 100
  "sortBy": "createdAt",  // æ’åºå­—æ®µ
  "order": "desc"   // æ’åºæ–¹å‘ï¼šasc, desc
}
```

#### 3.3.2 åˆ†é¡µå“åº”

```typescript
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5,
    "hasNext": true,
    "hasPrev": false
  }
}
```

---

## 4. è®¤è¯æˆæƒ

### 4.1 è®¤è¯æ–¹å¼

#### 4.1.1 JWT è®¤è¯

```typescript
// JWT Token ç»“æ„
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "userId": 123,
    "email": "user@example.com",
    "role": "user",
    "merchantId": 456,
    "iat": 1706625600,
    "exp": 1706712000
  }
}
```

#### 4.1.2 Token åˆ·æ–°

```typescript
// åˆ·æ–° Token è¯·æ±‚
POST /api/v1/auth/refresh
{
  "refreshToken": "refresh_token_string"
}

// åˆ·æ–° Token å“åº”
{
  "success": true,
  "data": {
    "accessToken": "new_access_token",
    "refreshToken": "new_refresh_token",
    "expiresIn": 3600
  }
}
```

### 4.2 æˆæƒç­–ç•¥

#### 4.2.1 è§’è‰²æƒé™

| è§’è‰² | æƒé™èŒƒå›´ |
|------|---------|
| admin | ç³»ç»Ÿç®¡ç†ï¼Œæ‰€æœ‰æƒé™ |
| manager | å•†æˆ·ç®¡ç†ï¼Œå•†æˆ·å†…æ‰€æœ‰æƒé™ |
| staff | å‘˜å·¥ï¼Œè®¢å•å¤„ç†ã€å•†å“ç®¡ç† |
| user | æ™®é€šç”¨æˆ·ï¼Œä¸‹å•ã€æŸ¥çœ‹è®¢å• |

#### 4.2.2 æƒé™æ£€æŸ¥ä¸­é—´ä»¶

```typescript
import { Context, Next } from 'hono';

export function requireRole(roles: string[]) {
  return async (c: Context, next: Next) => {
    const user = c.get('user');
    
    if (!user || !roles.includes(user.role)) {
      return c.json(
        {
          success: false,
          error: {
            code: 'FORBIDDEN',
            message: 'æƒé™ä¸è¶³'
          }
        },
        403
      );
    }
    
    await next();
  };
}

export function requireMerchantAccess() {
  return async (c: Context, next: Next) => {
    const user = c.get('user');
    const merchantId = c.req.param('merchantId');
    
    if (user.role === 'admin') {
      await next();
      return;
    }
    
    if (user.merchantId !== parseInt(merchantId)) {
      return c.json(
        {
          success: false,
          error: {
            code: 'FORBIDDEN',
            message: 'æ— æƒè®¿é—®è¯¥å•†æˆ·æ•°æ®'
          }
        },
        403
      );
    }
    
    await next();
  };
}
```

---

## 5. æ ¸å¿ƒæ¥å£

### 5.1 ç”¨æˆ·è®¤è¯æ¥å£

#### 5.1.1 ç”¨æˆ·æ³¨å†Œ

```typescript
POST /api/v1/auth/register

// è¯·æ±‚ä½“
{
  "email": "user@example.com",
  "password": "password123",
  "name": "å¼ ä¸‰",
  "phone": "13800138000"
}

// å“åº” (201)
{
  "success": true,
  "data": {
    "user": {
      "id": 123,
      "email": "user@example.com",
      "name": "å¼ ä¸‰",
      "phone": "13800138000",
      "role": "user",
      "emailVerified": false,
      "createdAt": "2025-01-30T10:00:00Z"
    },
    "tokens": {
      "accessToken": "access_token",
      "refreshToken": "refresh_token",
      "expiresIn": 3600
    }
  }
}
```

#### 5.1.2 ç”¨æˆ·ç™»å½•

```typescript
POST /api/v1/auth/login

// è¯·æ±‚ä½“
{
  "email": "user@example.com",
  "password": "password123"
}

// å“åº” (200)
{
  "success": true,
  "data": {
    "user": {
      "id": 123,
      "email": "user@example.com",
      "name": "å¼ ä¸‰",
      "role": "user",
      "merchantId": 456
    },
    "tokens": {
      "accessToken": "access_token",
      "refreshToken": "refresh_token",
      "expiresIn": 3600
    }
  }
}
```

### 5.2 å•†æˆ·ç®¡ç†æ¥å£

#### 5.2.1 è·å–å•†æˆ·åˆ—è¡¨

```typescript
GET /api/v1/merchants?page=1&limit=20&status=active

// å“åº” (200)
{
  "success": true,
  "data": [
    {
      "id": 123,
      "name": "ç¾å‘³é¤å…",
      "logoUrl": "https://example.com/logo.png",
      "businessType": "restaurant",
      "address": "åŒ—äº¬å¸‚æœé˜³åŒº",
      "rating": 4.5,
      "reviewCount": 100,
      "status": "active"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

#### 5.2.2 è·å–å•†æˆ·è¯¦æƒ…

```typescript
GET /api/v1/merchants/{merchantId}

// å“åº” (200)
{
  "success": true,
  "data": {
    "id": 123,
    "name": "ç¾å‘³é¤å…",
    "logoUrl": "https://example.com/logo.png",
    "description": "æä¾›ç¾å‘³çš„ä¸­å¼èœè‚´",
    "businessType": "restaurant",
    "businessHours": {
      "monday": { "open": "09:00", "close": "22:00" },
      "tuesday": { "open": "09:00", "close": "22:00" }
    },
    "address": "åŒ—äº¬å¸‚æœé˜³åŒº",
    "contactPhone": "010-12345678",
    "rating": 4.5,
    "reviewCount": 100,
    "status": "active"
  }
}
```

### 5.3 å•†å“ç®¡ç†æ¥å£

#### 5.3.1 è·å–å•†å“åˆ—è¡¨

```typescript
GET /api/v1/merchants/{merchantId}/products?page=1&limit=20&categoryId=1&isAvailable=true

// å“åº” (200)
{
  "success": true,
  "data": [
    {
      "id": 456,
      "name": "å®«ä¿é¸¡ä¸",
      "description": "ç»å…¸å·èœ",
      "images": ["https://example.com/image.jpg"],
      "price": 38.00,
      "originalPrice": 45.00,
      "categoryId": 1,
      "isAvailable": true,
      "isFeatured": true,
      "stockQuantity": 50,
      "rating": 4.5
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 50,
    "totalPages": 3
  }
}
```

#### 5.3.2 åˆ›å»ºå•†å“

```typescript
POST /api/v1/merchants/{merchantId}/products

// è¯·æ±‚ä½“
{
  "name": "å®«ä¿é¸¡ä¸",
  "description": "ç»å…¸å·èœ",
  "images": ["https://example.com/image.jpg"],
  "price": 38.00,
  "originalPrice": 45.00,
  "categoryId": 1,
  "stockQuantity": 50,
  "isAvailable": true,
  "isFeatured": true
}

// å“åº” (201)
{
  "success": true,
  "data": {
    "id": 456,
    "name": "å®«ä¿é¸¡ä¸",
    "description": "ç»å…¸å·èœ",
    "images": ["https://example.com/image.jpg"],
    "price": 38.00,
    "originalPrice": 45.00,
    "categoryId": 1,
    "stockQuantity": 50,
    "isAvailable": true,
    "isFeatured": true,
    "createdAt": "2025-01-30T10:00:00Z"
  }
}
```

### 5.4 è®¢å•ç®¡ç†æ¥å£

#### 5.4.1 åˆ›å»ºè®¢å•

```typescript
POST /api/v1/orders

// è¯·æ±‚ä½“
{
  "merchantId": 123,
  "orderType": "dine_in",
  "tableNumber": "A01",
  "items": [
    {
      "productId": 456,
      "quantity": 2,
      "specialInstructions": "å°‘è¾£"
    }
  ],
  "notes": "å°½å¿«ä¸Šèœ"
}

// å“åº” (201)
{
  "success": true,
  "data": {
    "id": 789,
    "orderNumber": "ORD2025013000001",
    "merchantId": 123,
    "userId": 123,
    "status": "pending",
    "orderType": "dine_in",
    "tableNumber": "A01",
    "subtotal": 76.00,
    "taxAmount": 0,
    "serviceFee": 0,
    "deliveryFee": 0,
    "discountAmount": 0,
    "totalAmount": 76.00,
    "paymentStatus": "unpaid",
    "createdAt": "2025-01-30T10:00:00Z"
  }
}
```

#### 5.4.2 è·å–è®¢å•è¯¦æƒ…

```typescript
GET /api/v1/orders/{orderId}

// å“åº” (200)
{
  "success": true,
  "data": {
    "id": 789,
    "orderNumber": "ORD2025013000001",
    "merchantId": 123,
    "userId": 123,
    "status": "confirmed",
    "orderType": "dine_in",
    "tableNumber": "A01",
    "subtotal": 76.00,
    "taxAmount": 0,
    "serviceFee": 0,
    "deliveryFee": 0,
    "discountAmount": 0,
    "totalAmount": 76.00,
    "paidAmount": 76.00,
    "paymentStatus": "paid",
    "paymentMethod": "wechat_pay",
    "paymentTime": "2025-01-30T10:05:00Z",
    "items": [
      {
        "id": 100,
        "productId": 456,
        "productName": "å®«ä¿é¸¡ä¸",
        "quantity": 2,
        "unitPrice": 38.00,
        "totalPrice": 76.00,
        "specialInstructions": "å°‘è¾£"
      }
    ],
    "createdAt": "2025-01-30T10:00:00Z",
    "updatedAt": "2025-01-30T10:05:00Z"
  }
}
```

#### 5.4.3 æ›´æ–°è®¢å•çŠ¶æ€

```typescript
PATCH /api/v1/orders/{orderId}/status

// è¯·æ±‚ä½“
{
  "status": "confirmed",
  "notes": "è®¢å•å·²ç¡®è®¤"
}

// å“åº” (200)
{
  "success": true,
  "data": {
    "id": 789,
    "status": "confirmed",
    "updatedAt": "2025-01-30T10:05:00Z"
  }
}
```

### 5.5 æ”¯ä»˜æ¥å£

#### 5.5.1 åˆ›å»ºæ”¯ä»˜

```typescript
POST /api/v1/payments

// è¯·æ±‚ä½“
{
  "orderId": 789,
  "paymentMethod": "wechat_pay",
  "amount": 76.00
}

// å“åº” (201)
{
  "success": true,
  "data": {
    "id": 999,
    "orderId": 789,
    "paymentMethod": "wechat_pay",
    "amount": 76.00,
    "currency": "CNY",
    "status": "processing",
    "transactionId": "WX202501301000000000",
    "paymentUrl": "weixin://wxpay/bizpayurl?pr=xxxxx",
    "expiresAt": "2025-01-30T10:15:00Z",
    "createdAt": "2025-01-30T10:00:00Z"
  }
}
```

#### 5.5.2 æ”¯ä»˜å›è°ƒ

```typescript
POST /api/v1/payments/callback/{paymentGateway}

// è¯·æ±‚ä½“ (å¾®ä¿¡æ”¯ä»˜å›è°ƒ)
{
  "transaction_id": "WX202501301000000000",
  "out_trade_no": "PAY2025013000001",
  "total_fee": 7600,
  "trade_state": "SUCCESS"
}

// å“åº” (200)
{
  "success": true,
  "data": {
    "status": "completed"
  }
}
```

---

## 6. é”™è¯¯å¤„ç†

### 6.1 é”™è¯¯ç è§„èŒƒ

| é”™è¯¯ç  | HTTP çŠ¶æ€ç  | è¯´æ˜ |
|--------|------------|------|
| VALIDATION_ERROR | 400 | å‚æ•°éªŒè¯å¤±è´¥ |
| UNAUTHORIZED | 401 | æœªè®¤è¯ |
| FORBIDDEN | 403 | æ— æƒé™ |
| NOT_FOUND | 404 | èµ„æºä¸å­˜åœ¨ |
| CONFLICT | 409 | èµ„æºå†²çª |
| RATE_LIMIT_EXCEEDED | 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| INTERNAL_ERROR | 500 | æœåŠ¡å™¨é”™è¯¯ |

### 6.2 é”™è¯¯å“åº”æ ¼å¼

```typescript
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å‚æ•°éªŒè¯å¤±è´¥",
    "details": [
      {
        "field": "email",
        "message": "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
      },
      {
        "field": "password",
        "message": "å¯†ç é•¿åº¦ä¸èƒ½å°‘äº 8 ä½"
      }
    ]
  },
  "meta": {
    "timestamp": "2025-01-30T10:00:00Z",
    "requestId": "uuid"
  }
}
```

### 6.3 é”™è¯¯å¤„ç†ä¸­é—´ä»¶

```typescript
import { Context, Next } from 'hono';
import { ZodError } from 'zod';

export async function errorHandler(c: Context, next: Next) {
  try {
    await next();
  } catch (error) {
    console.error('Error:', error);

    if (error instanceof ZodError) {
      return c.json(
        {
          success: false,
          error: {
            code: 'VALIDATION_ERROR',
            message: 'å‚æ•°éªŒè¯å¤±è´¥',
            details: error.errors.map(e => ({
              field: e.path.join('.'),
              message: e.message
            }))
          }
        },
        400
      );
    }

    if (error instanceof AppError) {
      return c.json(
        {
          success: false,
          error: {
            code: error.code,
            message: error.message
          }
        },
        error.statusCode
      );
    }

    return c.json(
      {
        success: false,
        error: {
          code: 'INTERNAL_ERROR',
          message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
        }
      },
      500
    );
  }
}

export class AppError extends Error {
  constructor(
    public code: string,
    public message: string,
    public statusCode: number = 500
  ) {
    super(message);
    this.name = 'AppError';
  }
}
```

---

## 7. ç‰ˆæœ¬æ§åˆ¶

### 7.1 ç‰ˆæœ¬ç­–ç•¥

- **URL ç‰ˆæœ¬**ï¼šåœ¨ URL ä¸­åŒ…å«ç‰ˆæœ¬å·
- **ç‰ˆæœ¬æ ¼å¼**ï¼š`/api/v{major_version}`
- **å…¼å®¹æ€§**ï¼šä¸»ç‰ˆæœ¬å˜æ›´æ—¶åˆ›å»ºæ–°ç‰ˆæœ¬
- **åºŸå¼ƒç­–ç•¥**ï¼šæå‰é€šçŸ¥ï¼Œä¿ç•™è‡³å°‘ 6 ä¸ªæœˆ

### 7.2 ç‰ˆæœ¬ç¤ºä¾‹

```typescript
// v1 ç‰ˆæœ¬
GET /api/v1/users
POST /api/v1/orders

// v2 ç‰ˆæœ¬ï¼ˆé‡å¤§å˜æ›´ï¼‰
GET /api/v2/users
POST /api/v2/orders
```

### 7.3 ç‰ˆæœ¬å‡çº§é€šçŸ¥

```typescript
// å“åº”å¤´æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯
{
  "success": true,
  "data": {...},
  "meta": {
    "apiVersion": "v1",
    "latestVersion": "v2",
    "deprecationNotice": "v1 å°†åœ¨ 2025-07-30 åºŸå¼ƒï¼Œè¯·å‡çº§åˆ° v2"
  }
}
```

---

## 8. é™æµç­–ç•¥

### 8.1 é™æµè§„åˆ™

| æ¥å£ç±»å‹ | é™æµè§„åˆ™ | æ—¶é—´çª—å£ |
|---------|---------|---------|
| è®¤è¯æ¥å£ | 5 æ¬¡/åˆ†é’Ÿ | 1 åˆ†é’Ÿ |
| æŸ¥è¯¢æ¥å£ | 100 æ¬¡/åˆ†é’Ÿ | 1 åˆ†é’Ÿ |
| å†™å…¥æ¥å£ | 20 æ¬¡/åˆ†é’Ÿ | 1 åˆ†é’Ÿ |
| æ–‡ä»¶ä¸Šä¼  | 10 æ¬¡/å°æ—¶ | 1 å°æ—¶ |

### 8.2 é™æµå®ç°

```typescript
import { Context, Next } from 'hono';
import Redis from 'ioredis';

const redis = new Redis();

export async function rateLimit(
  key: string,
  limit: number,
  window: number
) {
  return async (c: Context, next: Next) => {
    const identifier = c.get('userId') || c.req.header('X-Forwarded-For');
    const rateKey = `rate_limit:${key}:${identifier}`;
    
    const current = await redis.incr(rateKey);
    
    if (current === 1) {
      await redis.expire(rateKey, window);
    }
    
    if (current > limit) {
      return c.json(
        {
          success: false,
          error: {
            code: 'RATE_LIMIT_EXCEEDED',
            message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
          }
        },
        429
      );
    }
    
    c.header('X-RateLimit-Limit', limit.toString());
    c.header('X-RateLimit-Remaining', (limit - current).toString());
    
    await next();
  };
}
```

---

## 9. æ–‡æ¡£ç®¡ç†

### 9.1 OpenAPI è§„èŒƒ

```typescript
import { OpenAPIHono } from '@hono/zod-openapi';

const app = new OpenAPIHono();

app.openapi(
  {
    method: 'post',
    path: '/api/v1/auth/login',
    summary: 'ç”¨æˆ·ç™»å½•',
    description: 'ä½¿ç”¨é‚®ç®±å’Œå¯†ç ç™»å½•',
    request: {
      body: {
        content: {
          'application/json': {
            schema: loginSchema
          }
        }
      }
    },
    responses: {
      200: {
        description: 'ç™»å½•æˆåŠŸ',
        content: {
          'application/json': {
            schema: loginResponseSchema
          }
        }
      },
      401: {
        description: 'è®¤è¯å¤±è´¥'
      }
    }
  },
  async (c) => {
    // å®ç°é€»è¾‘
  }
);

// ç”Ÿæˆ OpenAPI æ–‡æ¡£
app.doc('/api-docs', {
  openapi: '3.0.0',
  info: {
    title: 'YYCÂ³ API',
    version: '1.0.0'
  }
});
```

### 9.2 Swagger UI

```typescript
// é›†æˆ Swagger UI
app.get('/swagger', swaggerUI({ url: '/api-docs' }));
```

---

## 10. æµ‹è¯•ä¸ç›‘æ§

### 10.1 API æµ‹è¯•

```typescript
import { describe, it, expect } from 'vitest';
import { app } from '../app';

describe('API æµ‹è¯•', () => {
  it('åº”è¯¥æˆåŠŸç™»å½•', async () => {
    const res = await app.request('/api/v1/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        email: 'user@example.com',
        password: 'password123'
      })
    });

    expect(res.status).toBe(200);
    const data = await res.json();
    expect(data.success).toBe(true);
    expect(data.data.tokens).toBeDefined();
  });

  it('åº”è¯¥è¿”å› 401 å½“å¯†ç é”™è¯¯', async () => {
    const res = await app.request('/api/v1/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        email: 'user@example.com',
        password: 'wrong_password'
      })
    });

    expect(res.status).toBe(401);
    const data = await res.json();
    expect(data.success).toBe(false);
  });
});
```

### 10.2 API ç›‘æ§

```typescript
// è®°å½• API è°ƒç”¨
export async function apiLogger(c: Context, next: Next) {
  const start = Date.now();
  
  await next();
  
  const duration = Date.now() - start;
  
  console.log({
    method: c.req.method,
    path: c.req.path,
    status: c.res.status,
    duration,
    userId: c.get('userId'),
    requestId: c.get('requestId')
  });
}

// æ€§èƒ½ç›‘æ§
export async function performanceMonitor(c: Context, next: Next) {
  const start = Date.now();
  
  await next();
  
  const duration = Date.now() - start;
  
  if (duration > 1000) {
    console.warn(`Slow API: ${c.req.method} ${c.req.path} took ${duration}ms`);
  }
}
```

---

## ğŸ“„ æ–‡æ¡£æ ‡å°¾ (Footer)

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for Future***ã€
> ã€Œ***All things converge in cloud pivot; Deep stacks ignite a new era of intelligence***ã€




## æ¦‚è¿°

### æ¶æ„æ¦‚è¿°

æœ¬æ¶æ„æ–‡æ¡£è¯¦ç»†æè¿°äº†ç³»ç»Ÿçš„æ•´ä½“æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æ¶æ„ç›®æ ‡ã€è®¾è®¡åŸåˆ™ã€æŠ€æœ¯é€‰å‹ç­‰å…³é”®ä¿¡æ¯ã€‚

#### æ¶æ„ç›®æ ‡

- **é«˜å¯ç”¨æ€§**ï¼šç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤
- **é«˜æ€§èƒ½**ï¼šå“åº”è¿…é€Ÿï¼Œèµ„æºåˆ©ç”¨é«˜æ•ˆ
- **é«˜å®‰å…¨æ€§**ï¼šæ•°æ®åŠ å¯†ï¼Œæƒé™ä¸¥æ ¼æ§åˆ¶
- **é«˜æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºåŠŸèƒ½æ‰©å±•
- **é«˜å¯ç»´æŠ¤æ€§**ï¼šä»£ç æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„

#### è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **ä¾èµ–å€’ç½®**ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
- **æ¥å£éš”ç¦»**ï¼šä½¿ç”¨ç»†ç²’åº¦çš„æ¥å£
- **è¿ªç±³ç‰¹æ³•åˆ™**ï¼šæœ€å°‘çŸ¥è¯†åŸåˆ™



## æ¶æ„è®¾è®¡

### æ¶æ„è®¾è®¡

#### æ•´ä½“æ¶æ„

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

- **è¡¨ç°å±‚**ï¼šè´Ÿè´£ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
- **åº”ç”¨å±‚**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘
- **ä¸šåŠ¡å±‚**ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
- **æ•°æ®å±‚**ï¼šç®¡ç†æ•°æ®å­˜å‚¨å’Œè®¿é—®
- **åŸºç¡€è®¾æ–½å±‚**ï¼šæä¾›åŸºç¡€æœåŠ¡æ”¯æŒ

#### æ¨¡å—åˆ’åˆ†

ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šåŠŸèƒ½ï¼š

- **ç”¨æˆ·æ¨¡å—**ï¼šç”¨æˆ·ç®¡ç†å’Œè®¤è¯
- **è®¢å•æ¨¡å—**ï¼šè®¢å•å¤„ç†å’Œç®¡ç†
- **æ”¯ä»˜æ¨¡å—**ï¼šæ”¯ä»˜é›†æˆå’Œå¤„ç†
- **é€šçŸ¥æ¨¡å—**ï¼šæ¶ˆæ¯é€šçŸ¥å’Œæ¨é€
- **æŠ¥è¡¨æ¨¡å—**ï¼šæ•°æ®ç»Ÿè®¡å’Œåˆ†æ

#### æŠ€æœ¯é€‰å‹

- **å‰ç«¯æ¡†æ¶**ï¼šReact / Vue
- **åç«¯æ¡†æ¶**ï¼šNode.js / Express / Fastify
- **æ•°æ®åº“**ï¼šPostgreSQL / MongoDB
- **ç¼“å­˜**ï¼šRedis
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQ / Kafka



## æŠ€æœ¯å®ç°

### æŠ€æœ¯å®ç°

#### æ ¸å¿ƒæŠ€æœ¯æ ˆ

```typescript
// æ ¸å¿ƒä¾èµ–
{
  "dependencies": {
    "react": "^18.0.0",
    "typescript": "^5.0.0",
    "express": "^4.18.0",
    "prisma": "^5.0.0",
    "redis": "^4.6.0"
  }
}
```

#### å…³é”®å®ç°

1. **æœåŠ¡å±‚å®ç°**
```typescript
class UserService {
  async createUser(data: CreateUserDto): Promise<User> {
    // éªŒè¯è¾“å…¥
    this.validateUserData(data);
    
    // åŠ å¯†å¯†ç 
    const hashedPassword = await this.hashPassword(data.password);
    
    // åˆ›å»ºç”¨æˆ·
    const user = await this.userRepository.create({
      ...data,
      password: hashedPassword
    });
    
    return user;
  }
}
```

2. **ä¸­é—´ä»¶å®ç°**
```typescript
const authMiddleware = async (req: Request, res: Response, next: NextFunction) => {
  const token = req.headers.authorization?.split(' ')[1];
  
  if (!token) {
    return res.status(401).json({ error: 'æœªæˆæƒè®¿é—®' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'ä»¤ç‰Œæ— æ•ˆ' });
  }
};
```



## éƒ¨ç½²æ–¹æ¡ˆ

### éƒ¨ç½²æ–¹æ¡ˆ

#### éƒ¨ç½²æ¶æ„

é‡‡ç”¨å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼Œä½¿ç”¨Dockerå’ŒKubernetesè¿›è¡Œç¼–æ’ã€‚

#### éƒ¨ç½²æ­¥éª¤

1. **ç¯å¢ƒå‡†å¤‡**
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com | sh

# å®‰è£…Kubernetes
# æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„å®‰è£…æ–¹å¼
```

2. **æ„å»ºé•œåƒ**
```bash
# æ„å»ºåº”ç”¨é•œåƒ
docker build -t yyc3-app:latest .

# æ¨é€åˆ°é•œåƒä»“åº“
docker push registry.example.com/yyc3-app:latest
```

3. **éƒ¨ç½²åˆ°Kubernetes**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: yyc3-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: yyc3-app
  template:
    metadata:
      labels:
        app: yyc3-app
    spec:
      containers:
      - name: app
        image: registry.example.com/yyc3-app:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
```

4. **é…ç½®æœåŠ¡**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: yyc3-app-service
spec:
  selector:
    app: yyc3-app
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer
```



## æ€§èƒ½ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–

#### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**
```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));

function App() {
  return (
    <Suspense fallback={<Loading />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const MemoizedComponent = React.memo(({ data }) => {
  return <div>{data.value}</div>;
});

// useMemo ç¼“å­˜è®¡ç®—ç»“æœ
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(data);
}, [data]);
```

#### åç«¯ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**
```typescript
// ä½¿ç”¨ç´¢å¼•
CREATE INDEX idx_user_email ON users(email);

// æŸ¥è¯¢ä¼˜åŒ–
const users = await prisma.user.findMany({
  select: {
    id: true,
    name: true,
    email: true
  },
  where: {
    active: true
  },
  take: 100
});
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// Redisç¼“å­˜
async function getUser(id: string): Promise<User> {
  const cacheKey = `user:${id}`;
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }
  
  // ä»æ•°æ®åº“è·å–
  const user = await prisma.user.findUnique({ where: { id } });
  
  // å†™å…¥ç¼“å­˜
  await redis.setex(cacheKey, 3600, JSON.stringify(user));
  
  return user;
}
```



## å®‰å…¨è€ƒè™‘

### å®‰å…¨è€ƒè™‘

#### è®¤è¯ä¸æˆæƒ

1. **JWTè®¤è¯**
```typescript
// ç”ŸæˆJWTä»¤ç‰Œ
const token = jwt.sign(
  { userId: user.id, role: user.role },
  process.env.JWT_SECRET,
  { expiresIn: '24h' }
);

// éªŒè¯JWTä»¤ç‰Œ
const decoded = jwt.verify(token, process.env.JWT_SECRET);
```

2. **RBACæˆæƒ**
```typescript
// è§’è‰²æƒé™æ£€æŸ¥
function checkPermission(user: User, resource: string, action: string): boolean {
  const permissions = rolePermissions[user.role];
  return permissions.some(p => 
    p.resource === resource && p.actions.includes(action)
  );
}
```

#### æ•°æ®ä¿æŠ¤

1. **è¾“å…¥éªŒè¯**
```typescript
// ä½¿ç”¨Zodè¿›è¡Œè¾“å…¥éªŒè¯
const createUserSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8).regex(/[A-Z]/),
  name: z.string().min(2)
});

const validated = createUserSchema.parse(input);
```

2. **æ•°æ®åŠ å¯†**
```typescript
// ä½¿ç”¨bcryptåŠ å¯†å¯†ç 
const hashedPassword = await bcrypt.hash(password, 10);

// éªŒè¯å¯†ç 
const isValid = await bcrypt.compare(password, hashedPassword);
```

#### å®‰å…¨å¤´é…ç½®

```typescript
// Expresså®‰å…¨å¤´é…ç½®
app.use(helmet());
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS?.split(','),
  credentials: true
}));
```



## ç›‘æ§å‘Šè­¦

### ç›‘æ§å‘Šè­¦

#### ç›‘æ§æŒ‡æ ‡

1. **ç³»ç»ŸæŒ‡æ ‡**
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œI/O

2. **åº”ç”¨æŒ‡æ ‡**
- è¯·æ±‚é‡(RPS)
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
- å¹¶å‘ç”¨æˆ·æ•°

3. **ä¸šåŠ¡æŒ‡æ ‡**
- ç”¨æˆ·æ³¨å†Œæ•°
- è®¢å•åˆ›å»ºæ•°
- æ”¯ä»˜æˆåŠŸç‡
- ç”¨æˆ·æ´»è·ƒåº¦

#### ç›‘æ§å·¥å…·

```typescript
// PrometheusæŒ‡æ ‡æ”¶é›†
import { Counter, Histogram, Gauge } from 'prom-client';

const requestCounter = new Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status']
});

const responseTime = new Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTP request duration in seconds',
  labelNames: ['method', 'route']
});

// ä½¿ç”¨ä¸­é—´ä»¶è®°å½•æŒ‡æ ‡
app.use((req, res, next) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;
    requestCounter.inc({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    });
    responseTime.observe({
      method: req.method,
      route: req.route?.path || req.path
    }, duration);
  });
  
  next();
});
```

#### å‘Šè­¦è§„åˆ™

```yaml
groups:
- name: api_alerts
  rules:
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "APIé”™è¯¯ç‡è¿‡é«˜"
      description: "5åˆ†é’Ÿå†…é”™è¯¯ç‡è¶…è¿‡5%"
  
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, http_request_duration_seconds) > 1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "APIå“åº”æ—¶é—´è¿‡é•¿"
      description: "95%åˆ†ä½å“åº”æ—¶é—´è¶…è¿‡1ç§’"
```



## æœ€ä½³å®è·µ

### æœ€ä½³å®è·µ

#### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
```typescript
// å˜é‡ï¼šcamelCase
const userName = 'John';

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_RETRY_COUNT = 3;

// ç±»ï¼šPascalCase
class UserService { }

// æ¥å£ï¼šPascalCaseï¼Œå‰ç¼€Iï¼ˆå¯é€‰ï¼‰
interface IUserService { }
```

2. **æ³¨é‡Šè§„èŒƒ**
```typescript
/**
 * åˆ›å»ºç”¨æˆ·
 * @param email - ç”¨æˆ·é‚®ç®±
 * @param password - ç”¨æˆ·å¯†ç 
 * @returns åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
 * @throws {Error} å½“é‚®ç®±å·²å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 */
async function createUser(
  email: string, 
  password: string
): Promise<User> {
  // å®ç°
}
```

#### é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message);
    this.name = this.constructor.name;
    Error.captureStackTrace(this, this.constructor);
  }
}

// ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      success: false,
      error: err.message
    });
  }
  
  // è®°å½•æœªé¢„æœŸçš„é”™è¯¯
  logger.error('Unexpected error:', err);
  
  return res.status(500).json({
    success: false,
    error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  });
});
```

#### æ—¥å¿—è®°å½•

```typescript
// ç»“æ„åŒ–æ—¥å¿—
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// ä½¿ç”¨æ—¥å¿—
logger.info('User created', { userId: user.id, email: user.email });
logger.error('Database connection failed', { error: error.message });
```



## æœ€ä½³å®è·µ

### æœ€ä½³å®è·µ

#### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
```typescript
// å˜é‡ï¼šcamelCase
const userName = 'John';

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_RETRY_COUNT = 3;

// ç±»ï¼šPascalCase
class UserService { }

// æ¥å£ï¼šPascalCaseï¼Œå‰ç¼€Iï¼ˆå¯é€‰ï¼‰
interface IUserService { }
```

2. **æ³¨é‡Šè§„èŒƒ**
```typescript
/**
 * åˆ›å»ºç”¨æˆ·
 * @param email - ç”¨æˆ·é‚®ç®±
 * @param password - ç”¨æˆ·å¯†ç 
 * @returns åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
 * @throws {Error} å½“é‚®ç®±å·²å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 */
async function createUser(
  email: string, 
  password: string
): Promise<User> {
  // å®ç°
}
```

#### é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message);
    this.name = this.constructor.name;
    Error.captureStackTrace(this, this.constructor);
  }
}

// ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      success: false,
      error: err.message
    });
  }
  
  // è®°å½•æœªé¢„æœŸçš„é”™è¯¯
  logger.error('Unexpected error:', err);
  
  return res.status(500).json({
    success: false,
    error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  });
});
```

#### æ—¥å¿—è®°å½•

```typescript
// ç»“æ„åŒ–æ—¥å¿—
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// ä½¿ç”¨æ—¥å¿—
logger.info('User created', { userId: user.id, email: user.email });
logger.error('Database connection failed', { error: error.message });
```


## ç›¸å…³æ–‡æ¡£

- [ğŸ”– YYCÂ³ æ¥å£æ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/06-YYC3-Cater--æ¶æ„ç±»-æ¥å£æ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [YYC3 åˆç°ç³»ç»Ÿè‰²](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/16-YYC3-Cater--æ¶æ„ç±»-ç³»ç»Ÿè‰²è®¾è®¡è§„èŒƒ.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ æ™ºèƒ½æ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/08-YYC3-Cater--æ¶æ„ç±»-æ™ºèƒ½æ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ ç›‘æ§æ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/09-YYC3-Cater--æ¶æ„ç±»-ç›‘æ§æ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
- [ğŸ”– YYCÂ³ éƒ¨ç½²æ¶æ„è®¾è®¡æ–‡æ¡£](YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»/07-YYC3-Cater--æ¶æ„ç±»-éƒ¨ç½²æ¶æ„è®¾è®¡æ–‡æ¡£.md) - YYC3-Cater-æ¶æ„è®¾è®¡/æ¶æ„ç±»
