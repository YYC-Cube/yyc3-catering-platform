---

**@file**ï¼šYYCÂ³-ç¾å¤‡æ¶æ„è¿ç»´æ–‡æ¡£
**@description**ï¼šYYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°çš„ç¾å¤‡æ¶æ„è¿ç»´æ–‡æ¡£
**@author**ï¼šYYCÂ³
**@version**ï¼šv1.0.0
**@created**ï¼š2025-01-30
**@updated**ï¼š2025-01-30
**@status**ï¼špublished
**@tags**ï¼šYYCÂ³,æ–‡æ¡£

---
# ğŸ”– YYCÂ³ ç¾å¤‡æ¶æ„è¿ç»´æ–‡æ¡£

> ***YanYuCloudCube***
> **æ ‡è¯­**ï¼šè¨€å¯è±¡é™ | è¯­æ¢æœªæ¥
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **æ ‡è¯­**ï¼šä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

| å±æ€§ | å†…å®¹ |
|------|------|
| **æ–‡æ¡£æ ‡é¢˜** | YYCÂ³ ç¾å¤‡æ¶æ„è¿ç»´æ–‡æ¡£ |
| **æ–‡æ¡£ç±»å‹** | æ¶æ„è®¾è®¡æ–‡æ¡£ |
| **æ‰€å±é˜¶æ®µ** | è¿ç»´è¿è¥ |
| **éµå¾ªè§„èŒƒ** | YYCÂ³ å›¢é˜Ÿæ ‡å‡†åŒ–è§„èŒƒ v1.0.0 |
| **ç‰ˆæœ¬å·** | v1.0.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-01-30 |
| **ä½œè€…** | YYCÂ³ Team |
| **æ›´æ–°æ—¥æœŸ** | 2025-01-30 |

---

## ğŸ“‘ ç›®å½•

1. [ç¾å¤‡æ¶æ„æ¦‚è¿°](#1-ç¾å¤‡æ¶æ„æ¦‚è¿°)
2. [ç¾å¤‡ç­–ç•¥è®¾è®¡](#2-ç¾å¤‡ç­–ç•¥è®¾è®¡)
3. [æ•°æ®å¤‡ä»½](#3-æ•°æ®å¤‡ä»½)
4. [æ•…éšœåˆ‡æ¢](#4-æ•…éšœåˆ‡æ¢)
5. [ç¾éš¾æ¢å¤](#5-ç¾éš¾æ¢å¤)
6. [ç¾å¤‡æ¼”ç»ƒ](#6-ç¾å¤‡æ¼”ç»ƒ)
7. [ç¾å¤‡ç›‘æ§](#7-ç¾å¤‡ç›‘æ§)
8. [ç¾å¤‡æœ€ä½³å®è·µ](#8-ç¾å¤‡æœ€ä½³å®è·µ)

---

## 1. æ¦‚è¿°

### 1.1 è¯´æ˜

æœ¬æ–‡æ¡£æ˜¯YYCÂ³é¤é¥®è¡Œä¸šæ™ºèƒ½åŒ–å¹³å°æ–‡æ¡£ä½“ç³»çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ—¨åœ¨æä¾›æ¸…æ™°ã€å®Œæ•´ã€å‡†ç¡®çš„ä¿¡æ¯ã€‚

é€šè¿‡æœ¬æ–‡æ¡£ï¼Œè¯»è€…å¯ä»¥ï¼š
- äº†è§£ç›¸å…³æ¦‚å¿µå’ŒèƒŒæ™¯
- æŒæ¡æ ¸å¿ƒå†…å®¹å’Œè¦ç‚¹
- è·å¾—å®ç”¨çš„æŒ‡å¯¼å’Œå¸®åŠ©
- å‚è€ƒç›¸å…³çš„èµ„æºå’Œèµ„æ–™

æ–‡æ¡£éµå¾ªYYCÂ³å›¢é˜Ÿæ ‡å‡†åŒ–è§„èŒƒï¼Œç¡®ä¿å†…å®¹è´¨é‡å’Œä¸€è‡´æ€§ã€‚

### 1.2 ç›®æ ‡

æœ¬æ–‡æ¡£çš„ä¸»è¦ç›®æ ‡åŒ…æ‹¬ï¼š

- **ä¿¡æ¯ä¼ é€’**ï¼šå‡†ç¡®ä¼ é€’ç›¸å…³ä¿¡æ¯å’ŒçŸ¥è¯†
- **æŒ‡å¯¼å®è·µ**ï¼šæä¾›å®ç”¨çš„æŒ‡å¯¼å’Œå‚è€ƒ
- **é™ä½æˆæœ¬**ï¼šå‡å°‘æ²Ÿé€šæˆæœ¬å’Œå­¦ä¹ æˆæœ¬
- **æé«˜æ•ˆç‡**ï¼šå¸®åŠ©è¯»è€…å¿«é€Ÿç†è§£å’Œåº”ç”¨

é€šè¿‡å®ç°è¿™äº›ç›®æ ‡ï¼Œæ–‡æ¡£èƒ½å¤Ÿä¸ºé¡¹ç›®çš„æˆåŠŸåšå‡ºé‡è¦è´¡çŒ®ã€‚

### 1.3 èŒƒå›´

æœ¬æ–‡æ¡£çš„é€‚ç”¨èŒƒå›´ï¼š

- **é€‚ç”¨å¯¹è±¡**ï¼šå¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜ã€è¿ç»´äººå‘˜ã€äº§å“ç»ç†ç­‰
- **é€‚ç”¨é˜¶æ®µ**ï¼šå¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ã€è¿ç»´ç­‰å„ä¸ªé˜¶æ®µ
- **é€‚ç”¨åœºæ™¯**ï¼šæ—¥å¸¸å¼€å‘ã€é—®é¢˜æ’æŸ¥ã€ç³»ç»Ÿç»´æŠ¤ç­‰

è¶…å‡ºæœ¬æ–‡æ¡£èŒƒå›´çš„å†…å®¹ï¼Œè¯·å‚è€ƒå…¶ä»–ç›¸å…³æ–‡æ¡£ã€‚

## 2. è¯¦ç»†å†…å®¹

### 2.1 æ ¸å¿ƒå†…å®¹

### 2.2 å®ç°ç»†èŠ‚

### 2.3 æ³¨æ„äº‹é¡¹

## 3. å‚è€ƒä¿¡æ¯

### 3.1 ç›¸å…³æ–‡æ¡£

### 3.2 å‚è€ƒèµ„æ–™

### 3.3 é™„å½•

## 1. ç¾å¤‡æ¶æ„æ¦‚è¿°

### 1.1 æ¶æ„ç®€ä»‹

YYCÂ³ ç¾å¤‡æ¶æ„åŸºäºå¤šæ´»å’Œä¸»å¤‡æ¶æ„ï¼Œæ„å»ºé«˜å¯ç”¨ã€å¿«é€Ÿæ¢å¤çš„ç¾å¤‡ä½“ç³»ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨ç¾éš¾å‘ç”Ÿæ—¶èƒ½å¤Ÿå¿«é€Ÿæ¢å¤ä¸šåŠ¡ã€‚

### 1.2 ç¾å¤‡å±‚æ¬¡

```
åº”ç”¨å±‚ç¾å¤‡
  â”œâ”€â”€ å¤šæ´»éƒ¨ç½²
  â”œâ”€â”€ è´Ÿè½½å‡è¡¡
  â”œâ”€â”€ è‡ªåŠ¨åˆ‡æ¢
  â””â”€â”€ æµé‡è°ƒåº¦

æ•°æ®å±‚ç¾å¤‡
  â”œâ”€â”€ æ•°æ®åŒæ­¥
  â”œâ”€â”€ æ•°æ®å¤‡ä»½
  â”œâ”€â”€ æ•°æ®æ¢å¤
  â””â”€â”€ æ•°æ®ä¸€è‡´æ€§

åŸºç¡€è®¾æ–½å±‚ç¾å¤‡
  â”œâ”€â”€ å¤šæœºæˆ¿éƒ¨ç½²
  â”œâ”€â”€ è·¨åŒºåŸŸå®¹ç¾
  â”œâ”€â”€ èµ„æºå†—ä½™
  â””â”€â”€ ç½‘ç»œå†—ä½™

ç®¡ç†å±‚ç¾å¤‡
  â”œâ”€â”€ ç›‘æ§å‘Šè­¦
  â”œâ”€â”€ æ•…éšœæ£€æµ‹
  â”œâ”€â”€ è‡ªåŠ¨åˆ‡æ¢
  â””â”€â”€ æ¼”ç»ƒéªŒè¯
```

### 1.3 ç¾å¤‡ç›®æ ‡

- **RPOï¼ˆæ¢å¤ç‚¹ç›®æ ‡ï¼‰**ï¼šâ‰¤ 5 åˆ†é’Ÿ
- **RTOï¼ˆæ¢å¤æ—¶é—´ç›®æ ‡ï¼‰**ï¼šâ‰¤ 30 åˆ†é’Ÿ
- **æ•°æ®ä¸€è‡´æ€§**ï¼šå¼ºä¸€è‡´æ€§
- **å¯ç”¨æ€§**ï¼šâ‰¥ 99.99%

---

## 2. ç¾å¤‡ç­–ç•¥è®¾è®¡

### 2.1 ç¾å¤‡æ¶æ„

#### 2.1.1 å¤šæ´»æ¶æ„

```yaml
# === multi-active-architecture.yaml ===
apiVersion: v1
kind: ConfigMap
metadata:
  name: disaster-recovery-config
  namespace: yyc3-production
data:
  # å¤šæ´»é…ç½®
  multi-active: "true"
  
  # æ´»è·ƒåŒºåŸŸ
  active-regions: "cn-north-1,cn-south-1"
  
  # æµé‡åˆ†é…
  traffic-distribution: "50:50"
  
  # æ•°æ®åŒæ­¥æ¨¡å¼
  sync-mode: "async"
  
  # æ•…éšœåˆ‡æ¢é˜ˆå€¼
  failover-threshold: "3"
  
  # å¥åº·æ£€æŸ¥é—´éš”
  health-check-interval: "10s"
```

### 2.2 ç¾å¤‡çº§åˆ«

#### 2.2.1 ç¾å¤‡çº§åˆ«å®šä¹‰

| çº§åˆ« | åç§° | RPO | RTO | æ¶æ„ç±»å‹ | é€‚ç”¨åœºæ™¯ |
|------|------|-----|-----|----------|----------|
| Level 1 | å†·å¤‡ | 24å°æ—¶ | 24å°æ—¶ | ä¸»å¤‡ | éæ ¸å¿ƒç³»ç»Ÿ |
| Level 2 | æ¸©å¤‡ | 4å°æ—¶ | 4å°æ—¶ | ä¸»å¤‡ | æ¬¡è¦ç³»ç»Ÿ |
| Level 3 | çƒ­å¤‡ | 1å°æ—¶ | 1å°æ—¶ | ä¸»å¤‡ | é‡è¦ç³»ç»Ÿ |
| Level 4 | åŒæ´» | 5åˆ†é’Ÿ | 30åˆ†é’Ÿ | å¤šæ´» | æ ¸å¿ƒç³»ç»Ÿ |
| Level 5 | å¤šæ´» | å®æ—¶ | å®æ—¶ | å¤šæ´» | å…³é”®ç³»ç»Ÿ |

---

## 3. æ•°æ®å¤‡ä»½

### 3.1 å¤‡ä»½ç­–ç•¥

#### 3.1.1 å¤‡ä»½é…ç½®

```bash
#!/bin/bash
# === backup.sh ===

set -euo pipefail

# é…ç½®
BACKUP_DIR="/backup/yyc3"
RETENTION_DAYS=30
S3_BUCKET="s3://yyc3-backups"

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

log_warn() {
    echo -e "${YELLOW}[WARN]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# æ•°æ®åº“å¤‡ä»½
backup_database() {
    log_info "Starting database backup..."
    
    # PostgreSQL å¤‡ä»½
    pg_dump -h $DB_HOST -U $DB_USER -d $DB_NAME | gzip > $BACKUP_DIR/db_$(date +%Y%m%d_%H%M%S).sql.gz
    
    # MySQL å¤‡ä»½
    mysqldump -h $DB_HOST -u $DB_USER -p$DB_PASSWORD $DB_NAME | gzip > $BACKUP_DIR/mysql_$(date +%Y%m%d_%H%M%S).sql.gz
    
    log_info "Database backup completed"
}

# Redis å¤‡ä»½
backup_redis() {
    log_info "Starting Redis backup..."
    
    # RDB å¤‡ä»½
    redis-cli --rdb $BACKUP_DIR/redis_$(date +%Y%m%d_%H%M%S).rdb
    
    # AOF å¤‡ä»½
    cp /var/lib/redis/appendonly.aof $BACKUP_DIR/redis_aof_$(date +%Y%m%d_%H%M%S).aof
    
    log_info "Redis backup completed"
}

# æ–‡ä»¶å¤‡ä»½
backup_files() {
    log_info "Starting file backup..."
    
    # åº”ç”¨æ–‡ä»¶å¤‡ä»½
    tar -czf $BACKUP_DIR/app_$(date +%Y%m%d_%H%M%S).tar.gz /opt/yyc3
    
    # é…ç½®æ–‡ä»¶å¤‡ä»½
    tar -czf $BACKUP_DIR/config_$(date +%Y%m%d_%H%M%S).tar.gz /etc/yyc3
    
    log_info "File backup completed"
}

# ä¸Šä¼ åˆ° S3
upload_to_s3() {
    log_info "Uploading backups to S3..."
    
    aws s3 sync $BACKUP_DIR $S3_BUCKET/$(date +%Y%m%d)
    
    log_info "Upload completed"
}

# æ¸…ç†æ—§å¤‡ä»½
cleanup_old_backups() {
    log_info "Cleaning up old backups..."
    
    find $BACKUP_DIR -type f -mtime +$RETENTION_DAYS -delete
    
    log_info "Cleanup completed"
}

# ä¸»æµç¨‹
main() {
    log_info "Starting backup process..."
    
    backup_database
    backup_redis
    backup_files
    upload_to_s3
    cleanup_old_backups
    
    log_info "Backup process completed!"
}

main "$@"
```

### 3.2 å¤‡ä»½éªŒè¯

#### 3.2.1 å¤‡ä»½éªŒè¯è„šæœ¬

```bash
#!/bin/bash
# === verify-backup.sh ===

set -euo pipefail

# é…ç½®
BACKUP_DIR="/backup/yyc3"
TEST_DB="yyc3_test"

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# éªŒè¯æ•°æ®åº“å¤‡ä»½
verify_database_backup() {
    log_info "Verifying database backup..."
    
    # è·å–æœ€æ–°å¤‡ä»½
    LATEST_BACKUP=$(ls -t $BACKUP_DIR/db_*.sql.gz | head -1)
    
    if [ -z "$LATEST_BACKUP" ]; then
        log_error "No database backup found"
        exit 1
    fi
    
    # è§£å‹å¤‡ä»½
    gunzip -c $LATEST_BACKUP > /tmp/verify_backup.sql
    
    # éªŒè¯ SQL æ–‡ä»¶
    if grep -q "PostgreSQL database dump" /tmp/verify_backup.sql; then
        log_info "PostgreSQL backup is valid"
    elif grep -q "MySQL dump" /tmp/verify_backup.sql; then
        log_info "MySQL backup is valid"
    else
        log_error "Invalid database backup"
        exit 1
    fi
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f /tmp/verify_backup.sql
    
    log_info "Database backup verification completed"
}

# éªŒè¯ Redis å¤‡ä»½
verify_redis_backup() {
    log_info "Verifying Redis backup..."
    
    # è·å–æœ€æ–°å¤‡ä»½
    LATEST_BACKUP=$(ls -t $BACKUP_DIR/redis_*.rdb | head -1)
    
    if [ -z "$LATEST_BACKUP" ]; then
        log_error "No Redis backup found"
        exit 1
    fi
    
    # éªŒè¯ RDB æ–‡ä»¶
    if redis-cli --rdb $LATEST_BACKUP; then
        log_info "Redis backup is valid"
    else
        log_error "Invalid Redis backup"
        exit 1
    fi
    
    log_info "Redis backup verification completed"
}

# éªŒè¯æ–‡ä»¶å¤‡ä»½
verify_file_backup() {
    log_info "Verifying file backup..."
    
    # è·å–æœ€æ–°å¤‡ä»½
    LATEST_BACKUP=$(ls -t $BACKUP_DIR/app_*.tar.gz | head -1)
    
    if [ -z "$LATEST_BACKUP" ]; then
        log_error "No file backup found"
        exit 1
    fi
    
    # éªŒè¯ tar æ–‡ä»¶
    if tar -tzf $LATEST_BACKUP > /dev/null 2>&1; then
        log_info "File backup is valid"
    else
        log_error "Invalid file backup"
        exit 1
    fi
    
    log_info "File backup verification completed"
}

# ä¸»æµç¨‹
main() {
    log_info "Starting backup verification..."
    
    verify_database_backup
    verify_redis_backup
    verify_file_backup
    
    log_info "Backup verification completed!"
}

main "$@"
```

---

## 4. æ•…éšœåˆ‡æ¢

### 4.1 è‡ªåŠ¨åˆ‡æ¢

#### 4.1.1 æ•…éšœæ£€æµ‹ä¸åˆ‡æ¢

```typescript
/**
 * @file æ•…éšœåˆ‡æ¢
 * @description è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œåˆ‡æ¢
 * @module disaster-recovery/failover
 * @author YYCÂ³
 * @version 1.0.0
 * @created 2025-01-30
 */

import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

/**
 * å¥åº·æ£€æŸ¥ç»“æœ
 */
interface HealthCheckResult {
  healthy: boolean;
  responseTime: number;
  error?: string;
}

/**
 * æ•…éšœåˆ‡æ¢é…ç½®
 */
interface FailoverConfig {
  // å¥åº·æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  healthCheckInterval: number;
  
  // æ•…éšœé˜ˆå€¼ï¼ˆè¿ç»­å¤±è´¥æ¬¡æ•°ï¼‰
  failureThreshold: number;
  
  // æ¢å¤é˜ˆå€¼ï¼ˆè¿ç»­æˆåŠŸæ¬¡æ•°ï¼‰
  recoveryThreshold: number;
  
  // åˆ‡æ¢è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
  failoverTimeout: number;
}

/**
 * æ•…éšœåˆ‡æ¢æ§åˆ¶å™¨
 */
export class FailoverController {
  private config: FailoverConfig;
  private primaryRegion: string;
  private secondaryRegion: string;
  private currentRegion: string;
  private failureCount: number = 0;
  private recoveryCount: number = 0;
  private isSwitching: boolean = false;

  constructor(
    primaryRegion: string,
    secondaryRegion: string,
    config: FailoverConfig
  ) {
    this.primaryRegion = primaryRegion;
    this.secondaryRegion = secondaryRegion;
    this.currentRegion = primaryRegion;
    this.config = config;
  }

  /**
   * å¯åŠ¨æ•…éšœç›‘æ§
   */
  async startMonitoring(): Promise<void> {
    console.log(`Starting failover monitoring for ${this.primaryRegion}...`);
    
    setInterval(async () => {
      if (this.isSwitching) {
        return;
      }
      
      await this.checkAndFailover();
    }, this.config.healthCheckInterval);
  }

  /**
   * å¥åº·æ£€æŸ¥
   * @param region åŒºåŸŸ
   * @returns å¥åº·æ£€æŸ¥ç»“æœ
   */
  private async healthCheck(region: string): Promise<HealthCheckResult> {
    const startTime = Date.now();
    
    try {
      // æ£€æŸ¥åº”ç”¨å¥åº·ç«¯ç‚¹
      const { stdout } = await execAsync(
        `curl -f -s -o /dev/null -w '%{http_code}' http://${region}.yyc3.com/health`
      );
      
      const responseTime = Date.now() - startTime;
      
      if (stdout === '200') {
        return {
          healthy: true,
          responseTime,
        };
      } else {
        return {
          healthy: false,
          responseTime,
          error: `HTTP status: ${stdout}`,
        };
      }
    } catch (error) {
      return {
        healthy: false,
        responseTime: Date.now() - startTime,
        error: error.message,
      };
    }
  }

  /**
   * æ£€æŸ¥å¹¶æ‰§è¡Œæ•…éšœåˆ‡æ¢
   */
  private async checkAndFailover(): Promise<void> {
    const result = await this.healthCheck(this.currentRegion);
    
    if (result.healthy) {
      // å¥åº·æ£€æŸ¥æˆåŠŸ
      this.failureCount = 0;
      this.recoveryCount++;
      
      // å¦‚æœæ˜¯ä»æ•…éšœä¸­æ¢å¤ï¼Œè€ƒè™‘åˆ‡æ¢å›ä¸»åŒºåŸŸ
      if (this.currentRegion !== this.primaryRegion && this.recoveryCount >= this.config.recoveryThreshold) {
        console.log(`Primary region ${this.primaryRegion} has recovered`);
        await this.switchToRegion(this.primaryRegion);
      }
    } else {
      // å¥åº·æ£€æŸ¥å¤±è´¥
      this.failureCount++;
      this.recoveryCount = 0;
      
      console.error(`Health check failed: ${result.error}`);
      
      // è¾¾åˆ°æ•…éšœé˜ˆå€¼ï¼Œæ‰§è¡Œåˆ‡æ¢
      if (this.failureCount >= this.config.failureThreshold) {
        console.error(`Failure threshold reached, initiating failover...`);
        await this.performFailover();
      }
    }
  }

  /**
   * æ‰§è¡Œæ•…éšœåˆ‡æ¢
   */
  private async performFailover(): Promise<void> {
    if (this.isSwitching) {
      return;
    }
    
    this.isSwitching = true;
    
    try {
      // ç¡®å®šç›®æ ‡åŒºåŸŸ
      const targetRegion = this.currentRegion === this.primaryRegion
        ? this.secondaryRegion
        : this.primaryRegion;
      
      console.log(`Switching from ${this.currentRegion} to ${targetRegion}...`);
      
      // åˆ‡æ¢ DNS
      await this.updateDNS(targetRegion);
      
      // æ›´æ–°è´Ÿè½½å‡è¡¡å™¨
      await this.updateLoadBalancer(targetRegion);
      
      // æ›´æ–°å½“å‰åŒºåŸŸ
      this.currentRegion = targetRegion;
      this.failureCount = 0;
      
      console.log(`Failover completed. Current region: ${this.currentRegion}`);
    } catch (error) {
      console.error(`Failover failed: ${error}`);
      throw error;
    } finally {
      this.isSwitching = false;
    }
  }

  /**
   * åˆ‡æ¢åˆ°æŒ‡å®šåŒºåŸŸ
   * @param region ç›®æ ‡åŒºåŸŸ
   */
  private async switchToRegion(region: string): Promise<void> {
    console.log(`Switching to ${region}...`);
    
    await this.updateDNS(region);
    await this.updateLoadBalancer(region);
    
    this.currentRegion = region;
    this.recoveryCount = 0;
    
    console.log(`Switch completed. Current region: ${this.currentRegion}`);
  }

  /**
   * æ›´æ–° DNS
   * @param region åŒºåŸŸ
   */
  private async updateDNS(region: string): Promise<void> {
    console.log(`Updating DNS to ${region}...`);
    
    // ä½¿ç”¨ AWS Route 53 æ›´æ–° DNS
    const command = `aws route53 change-resource-record-sets \
      --hosted-zone-id ZXXXXXXXX \
      --change-batch '{
        "Changes": [{
          "Action": "UPSERT",
          "ResourceRecordSet": {
            "Name": "api.yyc3.com",
            "Type": "CNAME",
            "TTL": 60,
            "ResourceRecords": [{
              "Value": "${region}.yyc3.com"
            }]
          }
        }]
      }'`;
    
    await execAsync(command);
    
    console.log(`DNS updated successfully`);
  }

  /**
   * æ›´æ–°è´Ÿè½½å‡è¡¡å™¨
   * @param region åŒºåŸŸ
   */
  private async updateLoadBalancer(region: string): Promise<void> {
    console.log(`Updating load balancer to ${region}...`);
    
    // ä½¿ç”¨ AWS ALB æ›´æ–°ç›®æ ‡ç»„
    const command = `aws elbv2 modify-target-group-attributes \
      --target-group-arn arn:aws:elasticloadbalancing:region:account-id:targetgroup/yyc3-targets/xxxxxxxx \
      --attributes Key=stickiness.enabled,Value=false`;
    
    await execAsync(command);
    
    console.log(`Load balancer updated successfully`);
  }
}
```

---

## 5. ç¾éš¾æ¢å¤

### 5.1 æ¢å¤æµç¨‹

#### 5.1.1 ç¾éš¾æ¢å¤è„šæœ¬

```bash
#!/bin/bash
# === disaster-recovery.sh ===

set -euo pipefail

# é…ç½®
BACKUP_DIR="/backup/yyc3"
S3_BUCKET="s3://yyc3-backups"
RECOVERY_DIR="/recovery/yyc3"

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# æ¢å¤æ•°æ®åº“
recover_database() {
    log_info "Starting database recovery..."
    
    # ä» S3 ä¸‹è½½æœ€æ–°å¤‡ä»½
    aws s3 cp $S3_BUCKET/latest/db_backup.sql.gz /tmp/db_backup.sql.gz
    
    # è§£å‹å¤‡ä»½
    gunzip /tmp/db_backup.sql.gz
    
    # æ¢å¤æ•°æ®åº“
    psql -h $DB_HOST -U $DB_USER -d $DB_NAME < /tmp/db_backup.sql
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f /tmp/db_backup.sql
    
    log_info "Database recovery completed"
}

# æ¢å¤ Redis
recover_redis() {
    log_info "Starting Redis recovery..."
    
    # ä» S3 ä¸‹è½½æœ€æ–°å¤‡ä»½
    aws s3 cp $S3_BUCKET/latest/redis_backup.rdb /tmp/redis_backup.rdb
    
    # åœæ­¢ Redis
    systemctl stop redis
    
    # æ¢å¤ RDB æ–‡ä»¶
    cp /tmp/redis_backup.rdb /var/lib/redis/dump.rdb
    
    # å¯åŠ¨ Redis
    systemctl start redis
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f /tmp/redis_backup.rdb
    
    log_info "Redis recovery completed"
}

# æ¢å¤æ–‡ä»¶
recover_files() {
    log_info "Starting file recovery..."
    
    # ä» S3 ä¸‹è½½æœ€æ–°å¤‡ä»½
    aws s3 cp $S3_BUCKET/latest/app_backup.tar.gz /tmp/app_backup.tar.gz
    
    # è§£å‹å¤‡ä»½
    tar -xzf /tmp/app_backup.tar.gz -C $RECOVERY_DIR
    
    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f /tmp/app_backup.tar.gz
    
    log_info "File recovery completed"
}

# éªŒè¯æ¢å¤
verify_recovery() {
    log_info "Verifying recovery..."
    
    # éªŒè¯æ•°æ®åº“
    if psql -h $DB_HOST -U $DB_USER -d $DB_NAME -c "SELECT 1" > /dev/null 2>&1; then
        log_info "Database is accessible"
    else
        log_error "Database is not accessible"
        exit 1
    fi
    
    # éªŒè¯ Redis
    if redis-cli ping > /dev/null 2>&1; then
        log_info "Redis is accessible"
    else
        log_error "Redis is not accessible"
        exit 1
    fi
    
    # éªŒè¯åº”ç”¨æ–‡ä»¶
    if [ -d "$RECOVERY_DIR/opt/yyc3" ]; then
        log_info "Application files are present"
    else
        log_error "Application files are missing"
        exit 1
    fi
    
    log_info "Recovery verification completed"
}

# ä¸»æµç¨‹
main() {
    log_info "Starting disaster recovery process..."
    
    recover_database
    recover_redis
    recover_files
    verify_recovery
    
    log_info "Disaster recovery process completed!"
}

main "$@"
```

---

## 6. ç¾å¤‡æ¼”ç»ƒ

### 6.1 æ¼”ç»ƒè®¡åˆ’

#### 6.1.1 æ¼”ç»ƒæµç¨‹

```markdown
## ç¾å¤‡æ¼”ç»ƒæµç¨‹

### 1. æ¼”ç»ƒå‡†å¤‡
- åˆ¶å®šæ¼”ç»ƒè®¡åˆ’
- ç¡®å®šæ¼”ç»ƒèŒƒå›´
- å‡†å¤‡æ¼”ç»ƒç¯å¢ƒ
- é€šçŸ¥ç›¸å…³äººå‘˜

### 2. æ¼”ç»ƒæ‰§è¡Œ
- æ¨¡æ‹Ÿæ•…éšœåœºæ™¯
- æ‰§è¡Œæ•…éšœåˆ‡æ¢
- éªŒè¯ç³»ç»Ÿæ¢å¤
- è®°å½•æ¼”ç»ƒè¿‡ç¨‹

### 3. æ¼”ç»ƒè¯„ä¼°
- è¯„ä¼°æ¼”ç»ƒç»“æœ
- åˆ†æé—®é¢˜åŸå› 
- æå‡ºæ”¹è¿›å»ºè®®
- æ›´æ–°æ¼”ç»ƒæ–‡æ¡£

### 4. æ¼”ç»ƒæ€»ç»“
- ç¼–å†™æ¼”ç»ƒæŠ¥å‘Š
- åˆ†äº«ç»éªŒæ•™è®­
- æ›´æ–°åº”æ€¥é¢„æ¡ˆ
- è®¡åˆ’ä¸‹æ¬¡æ¼”ç»ƒ
```

### 6.2 æ¼”ç»ƒåœºæ™¯

#### 6.2.1 å¸¸è§æ¼”ç»ƒåœºæ™¯

| åœºæ™¯ | æè¿° | é¢‘ç‡ | é¢„æœŸç»“æœ |
|------|------|------|----------|
| æ•°æ®åº“æ•…éšœ | æ¨¡æ‹Ÿæ•°æ®åº“å®•æœº | æ¯æœˆ | è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“ |
| ç½‘ç»œæ•…éšœ | æ¨¡æ‹Ÿç½‘ç»œä¸­æ–­ | æ¯å­£åº¦ | è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨åŒºåŸŸ |
| æœåŠ¡å™¨æ•…éšœ | æ¨¡æ‹ŸæœåŠ¡å™¨å®•æœº | æ¯æœˆ | è‡ªåŠ¨æ‰©å®¹å’Œè´Ÿè½½å‡è¡¡ |
| æ•°æ®ä¸¢å¤± | æ¨¡æ‹Ÿæ•°æ®æŸå | æ¯å­£åº¦ | ä»å¤‡ä»½æ¢å¤æ•°æ® |
| åŒºåŸŸæ•…éšœ | æ¨¡æ‹Ÿæ•´ä¸ªåŒºåŸŸæ•…éšœ | æ¯åŠå¹´ | åˆ‡æ¢åˆ°å¤‡ç”¨åŒºåŸŸ |

---

## 7. ç¾å¤‡ç›‘æ§

### 7.1 ç›‘æ§æŒ‡æ ‡

#### 7.1.1 å…³é”®æŒ‡æ ‡

```typescript
/**
 * @file ç¾å¤‡ç›‘æ§
 * @description ç¾å¤‡ç³»ç»Ÿç›‘æ§
 * @module disaster-recovery/monitoring
 * @author YYCÂ³
 * @version 1.0.0
 * @created 2025-01-30
 */

/**
 * ç¾å¤‡ç›‘æ§æŒ‡æ ‡
 */
interface DisasterRecoveryMetrics {
  // å¤‡ä»½çŠ¶æ€
  backupStatus: {
    lastBackupTime: number;
    backupSuccess: boolean;
    backupSize: number;
    backupDuration: number;
  };
  
  // åŒæ­¥çŠ¶æ€
  syncStatus: {
    lastSyncTime: number;
    syncLag: number;
    syncSuccess: boolean;
  };
  
  // æ•…éšœåˆ‡æ¢çŠ¶æ€
  failoverStatus: {
    currentRegion: string;
    lastFailoverTime: number;
    failoverCount: number;
  };
  
  // æ¢å¤ç‚¹ç›®æ ‡ï¼ˆRPOï¼‰
  rpo: number;
  
  // æ¢å¤æ—¶é—´ç›®æ ‡ï¼ˆRTOï¼‰
  rto: number;
}

/**
 * ç¾å¤‡ç›‘æ§å™¨
 */
export class DisasterRecoveryMonitor {
  /**
   * è·å–ç¾å¤‡æŒ‡æ ‡
   * @returns ç¾å¤‡æŒ‡æ ‡
   */
  async getMetrics(): Promise<DisasterRecoveryMetrics> {
    const backupStatus = await this.getBackupStatus();
    const syncStatus = await this.getSyncStatus();
    const failoverStatus = await this.getFailoverStatus();
    const rpo = this.calculateRPO(backupStatus.lastBackupTime);
    const rto = this.calculateRTO();

    return {
      backupStatus,
      syncStatus,
      failoverStatus,
      rpo,
      rto,
    };
  }

  /**
   * è·å–å¤‡ä»½çŠ¶æ€
   * @returns å¤‡ä»½çŠ¶æ€
   */
  private async getBackupStatus(): Promise<DisasterRecoveryMetrics['backupStatus']> {
    // æŸ¥è¯¢æœ€æ–°å¤‡ä»½ä¿¡æ¯
    const lastBackupTime = await this.queryLastBackupTime();
    const backupSuccess = await this.verifyBackup();
    const backupSize = await this.getBackupSize();
    const backupDuration = await this.getBackupDuration();

    return {
      lastBackupTime,
      backupSuccess,
      backupSize,
      backupDuration,
    };
  }

  /**
   * è·å–åŒæ­¥çŠ¶æ€
   * @returns åŒæ­¥çŠ¶æ€
   */
  private async getSyncStatus(): Promise<DisasterRecoveryMetrics['syncStatus']> {
    // æŸ¥è¯¢åŒæ­¥ä¿¡æ¯
    const lastSyncTime = await this.queryLastSyncTime();
    const syncLag = await this.calculateSyncLag();
    const syncSuccess = await this.verifySync();

    return {
      lastSyncTime,
      syncLag,
      syncSuccess,
    };
  }

  /**
   * è·å–æ•…éšœåˆ‡æ¢çŠ¶æ€
   * @returns æ•…éšœåˆ‡æ¢çŠ¶æ€
   */
  private async getFailoverStatus(): Promise<DisasterRecoveryMetrics['failoverStatus']> {
    // æŸ¥è¯¢æ•…éšœåˆ‡æ¢ä¿¡æ¯
    const currentRegion = await this.getCurrentRegion();
    const lastFailoverTime = await this.getLastFailoverTime();
    const failoverCount = await this.getFailoverCount();

    return {
      currentRegion,
      lastFailoverTime,
      failoverCount,
    };
  }

  /**
   * è®¡ç®— RPO
   * @param lastBackupTime æœ€åå¤‡ä»½æ—¶é—´
   * @returns RPOï¼ˆåˆ†é’Ÿï¼‰
   */
  private calculateRPO(lastBackupTime: number): number {
    const now = Date.now();
    const rpo = (now - lastBackupTime) / 60000; // è½¬æ¢ä¸ºåˆ†é’Ÿ
    return Math.round(rpo);
  }

  /**
   * è®¡ç®— RTO
   * @returns RTOï¼ˆåˆ†é’Ÿï¼‰
   */
  private calculateRTO(): number {
    // åŸºäº RPO å’Œæ¢å¤é€Ÿåº¦ä¼°ç®—
    return 30; // 30 åˆ†é’Ÿ
  }

  /**
   * æŸ¥è¯¢æœ€åå¤‡ä»½æ—¶é—´
   * @returns æœ€åå¤‡ä»½æ—¶é—´
   */
  private async queryLastBackupTime(): Promise<number> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
    return Date.now() - 300000; // 5 åˆ†é’Ÿå‰
  }

  /**
   * éªŒè¯å¤‡ä»½
   * @returns å¤‡ä»½æ˜¯å¦æˆåŠŸ
   */
  private async verifyBackup(): Promise<boolean> {
    // å®ç°éªŒè¯é€»è¾‘
    return true;
  }

  /**
   * è·å–å¤‡ä»½å¤§å°
   * @returns å¤‡ä»½å¤§å°ï¼ˆå­—èŠ‚ï¼‰
   */
  private async getBackupSize(): Promise<number> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
    return 1024 * 1024 * 1024; // 1 GB
  }

  /**
   * è·å–å¤‡ä»½æŒç»­æ—¶é—´
   * @returns å¤‡ä»½æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
   */
  private async getBackupDuration(): Promise<number> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
    return 300; // 5 åˆ†é’Ÿ
  }

  /**
   * æŸ¥è¯¢æœ€ååŒæ­¥æ—¶é—´
   * @returns æœ€ååŒæ­¥æ—¶é—´
   */
  private async queryLastSyncTime(): Promise<number> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
    return Date.now() - 60000; // 1 åˆ†é’Ÿå‰
  }

  /**
   * è®¡ç®—åŒæ­¥å»¶è¿Ÿ
   * @returns åŒæ­¥å»¶è¿Ÿï¼ˆç§’ï¼‰
   */
  private async calculateSyncLag(): Promise<number> {
    // å®ç°è®¡ç®—é€»è¾‘
    return 10; // 10 ç§’
  }

  /**
   * éªŒè¯åŒæ­¥
   * @returns åŒæ­¥æ˜¯å¦æˆåŠŸ
   */
  private async verifySync(): Promise<boolean> {
    // å®ç°éªŒè¯é€»è¾‘
    return true;
  }

  /**
   * è·å–å½“å‰åŒºåŸŸ
   * @returns å½“å‰åŒºåŸŸ
   */
  private async getCurrentRegion(): Promise<string> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
    return 'cn-north-1';
  }

  /**
   * è·å–æœ€åæ•…éšœåˆ‡æ¢æ—¶é—´
   * @returns æœ€åæ•…éšœåˆ‡æ¢æ—¶é—´
   */
  private async getLastFailoverTime(): Promise<number> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
    return Date.now() - 86400000; // 1 å¤©å‰
  }

  /**
   * è·å–æ•…éšœåˆ‡æ¢æ¬¡æ•°
   * @returns æ•…éšœåˆ‡æ¢æ¬¡æ•°
   */
  private async getFailoverCount(): Promise<number> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
    return 3;
  }
}
```

---

## 8. ç¾å¤‡æœ€ä½³å®è·µ

### 8.1 æœ€ä½³å®è·µ

#### 8.1.1 å®è·µå»ºè®®

```markdown
## ç¾å¤‡æœ€ä½³å®è·µ

### 1. å®šæœŸå¤‡ä»½
- æ¯æ—¥å¢é‡å¤‡ä»½
- æ¯å‘¨å…¨é‡å¤‡ä»½
- å¼‚åœ°å¤‡ä»½å­˜å‚¨
- å¤‡ä»½éªŒè¯æµ‹è¯•

### 2. è‡ªåŠ¨åŒ–
- è‡ªåŠ¨åŒ–å¤‡ä»½æµç¨‹
- è‡ªåŠ¨åŒ–æ•…éšœæ£€æµ‹
- è‡ªåŠ¨åŒ–æ•…éšœåˆ‡æ¢
- è‡ªåŠ¨åŒ–æ¢å¤æµç¨‹

### 3. ç›‘æ§å‘Šè­¦
- å®æ—¶ç›‘æ§å¤‡ä»½çŠ¶æ€
- å®æ—¶ç›‘æ§åŒæ­¥çŠ¶æ€
- å®æ—¶ç›‘æ§ç³»ç»Ÿå¥åº·
- åŠæ—¶å‘Šè­¦é€šçŸ¥

### 4. æ¼”ç»ƒéªŒè¯
- å®šæœŸç¾å¤‡æ¼”ç»ƒ
- æ¼”ç»ƒç»“æœè¯„ä¼°
- é—®é¢˜æ•´æ”¹ä¼˜åŒ–
- æ–‡æ¡£æŒç»­æ›´æ–°

### 5. å®‰å…¨é˜²æŠ¤
- å¤‡ä»½æ•°æ®åŠ å¯†
- è®¿é—®æƒé™æ§åˆ¶
- å®¡è®¡æ—¥å¿—è®°å½•
- å®‰å…¨åˆè§„æ£€æŸ¥
```

---

## ğŸ“„ æ–‡æ¡£æ ‡å°¾ (Footer)

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for the Future***ã€
> ã€Œ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***ã€




## æ¦‚è¿°

### æ¶æ„æ¦‚è¿°

æœ¬æ¶æ„æ–‡æ¡£è¯¦ç»†æè¿°äº†ç³»ç»Ÿçš„æ•´ä½“æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬æ¶æ„ç›®æ ‡ã€è®¾è®¡åŸåˆ™ã€æŠ€æœ¯é€‰å‹ç­‰å…³é”®ä¿¡æ¯ã€‚

#### æ¶æ„ç›®æ ‡

- **é«˜å¯ç”¨æ€§**ï¼šç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œæ•…éšœè‡ªåŠ¨æ¢å¤
- **é«˜æ€§èƒ½**ï¼šå“åº”è¿…é€Ÿï¼Œèµ„æºåˆ©ç”¨é«˜æ•ˆ
- **é«˜å®‰å…¨æ€§**ï¼šæ•°æ®åŠ å¯†ï¼Œæƒé™ä¸¥æ ¼æ§åˆ¶
- **é«˜æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºåŠŸèƒ½æ‰©å±•
- **é«˜å¯ç»´æŠ¤æ€§**ï¼šä»£ç æ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„

#### è®¾è®¡åŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **ä¾èµ–å€’ç½®**ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°
- **æ¥å£éš”ç¦»**ï¼šä½¿ç”¨ç»†ç²’åº¦çš„æ¥å£
- **è¿ªç±³ç‰¹æ³•åˆ™**ï¼šæœ€å°‘çŸ¥è¯†åŸåˆ™



## æ¶æ„è®¾è®¡

### æ¶æ„è®¾è®¡

#### æ•´ä½“æ¶æ„

ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

- **è¡¨ç°å±‚**ï¼šè´Ÿè´£ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
- **åº”ç”¨å±‚**ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘
- **ä¸šåŠ¡å±‚**ï¼šå®ç°æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
- **æ•°æ®å±‚**ï¼šç®¡ç†æ•°æ®å­˜å‚¨å’Œè®¿é—®
- **åŸºç¡€è®¾æ–½å±‚**ï¼šæä¾›åŸºç¡€æœåŠ¡æ”¯æŒ

#### æ¨¡å—åˆ’åˆ†

ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šåŠŸèƒ½ï¼š

- **ç”¨æˆ·æ¨¡å—**ï¼šç”¨æˆ·ç®¡ç†å’Œè®¤è¯
- **è®¢å•æ¨¡å—**ï¼šè®¢å•å¤„ç†å’Œç®¡ç†
- **æ”¯ä»˜æ¨¡å—**ï¼šæ”¯ä»˜é›†æˆå’Œå¤„ç†
- **é€šçŸ¥æ¨¡å—**ï¼šæ¶ˆæ¯é€šçŸ¥å’Œæ¨é€
- **æŠ¥è¡¨æ¨¡å—**ï¼šæ•°æ®ç»Ÿè®¡å’Œåˆ†æ

#### æŠ€æœ¯é€‰å‹

- **å‰ç«¯æ¡†æ¶**ï¼šReact / Vue
- **åç«¯æ¡†æ¶**ï¼šNode.js / Express / Fastify
- **æ•°æ®åº“**ï¼šPostgreSQL / MongoDB
- **ç¼“å­˜**ï¼šRedis
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQ / Kafka



## æŠ€æœ¯å®ç°

### æŠ€æœ¯å®ç°

#### æ ¸å¿ƒæŠ€æœ¯æ ˆ

```typescript
// æ ¸å¿ƒä¾èµ–
{
  "dependencies": {
    "react": "^18.0.0",
    "typescript": "^5.0.0",
    "express": "^4.18.0",
    "prisma": "^5.0.0",
    "redis": "^4.6.0"
  }
}
```

#### å…³é”®å®ç°

1. **æœåŠ¡å±‚å®ç°**
```typescript
class UserService {
  async createUser(data: CreateUserDto): Promise<User> {
    // éªŒè¯è¾“å…¥
    this.validateUserData(data);
    
    // åŠ å¯†å¯†ç 
    const hashedPassword = await this.hashPassword(data.password);
    
    // åˆ›å»ºç”¨æˆ·
    const user = await this.userRepository.create({
      ...data,
      password: hashedPassword
    });
    
    return user;
  }
}
```

2. **ä¸­é—´ä»¶å®ç°**
```typescript
const authMiddleware = async (req: Request, res: Response, next: NextFunction) => {
  const token = req.headers.authorization?.split(' ')[1];
  
  if (!token) {
    return res.status(401).json({ error: 'æœªæˆæƒè®¿é—®' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ error: 'ä»¤ç‰Œæ— æ•ˆ' });
  }
};
```



## éƒ¨ç½²æ–¹æ¡ˆ

### éƒ¨ç½²æ–¹æ¡ˆ

#### éƒ¨ç½²æ¶æ„

é‡‡ç”¨å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼Œä½¿ç”¨Dockerå’ŒKubernetesè¿›è¡Œç¼–æ’ã€‚

#### éƒ¨ç½²æ­¥éª¤

1. **ç¯å¢ƒå‡†å¤‡**
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com | sh

# å®‰è£…Kubernetes
# æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„å®‰è£…æ–¹å¼
```

2. **æ„å»ºé•œåƒ**
```bash
# æ„å»ºåº”ç”¨é•œåƒ
docker build -t yyc3-app:latest .

# æ¨é€åˆ°é•œåƒä»“åº“
docker push registry.example.com/yyc3-app:latest
```

3. **éƒ¨ç½²åˆ°Kubernetes**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: yyc3-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: yyc3-app
  template:
    metadata:
      labels:
        app: yyc3-app
    spec:
      containers:
      - name: app
        image: registry.example.com/yyc3-app:latest
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "production"
```

4. **é…ç½®æœåŠ¡**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: yyc3-app-service
spec:
  selector:
    app: yyc3-app
  ports:
  - protocol: TCP
    port: 80
    targetPort: 3000
  type: LoadBalancer
```



## æ€§èƒ½ä¼˜åŒ–

### æ€§èƒ½ä¼˜åŒ–

#### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**
```typescript
// è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));

function App() {
  return (
    <Suspense fallback={<Loading />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
const MemoizedComponent = React.memo(({ data }) => {
  return <div>{data.value}</div>;
});

// useMemo ç¼“å­˜è®¡ç®—ç»“æœ
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(data);
}, [data]);
```

#### åç«¯ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**
```typescript
// ä½¿ç”¨ç´¢å¼•
CREATE INDEX idx_user_email ON users(email);

// æŸ¥è¯¢ä¼˜åŒ–
const users = await prisma.user.findMany({
  select: {
    id: true,
    name: true,
    email: true
  },
  where: {
    active: true
  },
  take: 100
});
```

2. **ç¼“å­˜ç­–ç•¥**
```typescript
// Redisç¼“å­˜
async function getUser(id: string): Promise<User> {
  const cacheKey = `user:${id}`;
  
  // å°è¯•ä»ç¼“å­˜è·å–
  const cached = await redis.get(cacheKey);
  if (cached) {
    return JSON.parse(cached);
  }
  
  // ä»æ•°æ®åº“è·å–
  const user = await prisma.user.findUnique({ where: { id } });
  
  // å†™å…¥ç¼“å­˜
  await redis.setex(cacheKey, 3600, JSON.stringify(user));
  
  return user;
}
```



## å®‰å…¨è€ƒè™‘

### å®‰å…¨è€ƒè™‘

#### è®¤è¯ä¸æˆæƒ

1. **JWTè®¤è¯**
```typescript
// ç”ŸæˆJWTä»¤ç‰Œ
const token = jwt.sign(
  { userId: user.id, role: user.role },
  process.env.JWT_SECRET,
  { expiresIn: '24h' }
);

// éªŒè¯JWTä»¤ç‰Œ
const decoded = jwt.verify(token, process.env.JWT_SECRET);
```

2. **RBACæˆæƒ**
```typescript
// è§’è‰²æƒé™æ£€æŸ¥
function checkPermission(user: User, resource: string, action: string): boolean {
  const permissions = rolePermissions[user.role];
  return permissions.some(p => 
    p.resource === resource && p.actions.includes(action)
  );
}
```

#### æ•°æ®ä¿æŠ¤

1. **è¾“å…¥éªŒè¯**
```typescript
// ä½¿ç”¨Zodè¿›è¡Œè¾“å…¥éªŒè¯
const createUserSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8).regex(/[A-Z]/),
  name: z.string().min(2)
});

const validated = createUserSchema.parse(input);
```

2. **æ•°æ®åŠ å¯†**
```typescript
// ä½¿ç”¨bcryptåŠ å¯†å¯†ç 
const hashedPassword = await bcrypt.hash(password, 10);

// éªŒè¯å¯†ç 
const isValid = await bcrypt.compare(password, hashedPassword);
```

#### å®‰å…¨å¤´é…ç½®

```typescript
// Expresså®‰å…¨å¤´é…ç½®
app.use(helmet());
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS?.split(','),
  credentials: true
}));
```



## ç›‘æ§å‘Šè­¦

### ç›‘æ§å‘Šè­¦

#### ç›‘æ§æŒ‡æ ‡

1. **ç³»ç»ŸæŒ‡æ ‡**
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç£ç›˜ä½¿ç”¨ç‡
- ç½‘ç»œI/O

2. **åº”ç”¨æŒ‡æ ‡**
- è¯·æ±‚é‡(RPS)
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
- å¹¶å‘ç”¨æˆ·æ•°

3. **ä¸šåŠ¡æŒ‡æ ‡**
- ç”¨æˆ·æ³¨å†Œæ•°
- è®¢å•åˆ›å»ºæ•°
- æ”¯ä»˜æˆåŠŸç‡
- ç”¨æˆ·æ´»è·ƒåº¦

#### ç›‘æ§å·¥å…·

```typescript
// PrometheusæŒ‡æ ‡æ”¶é›†
import { Counter, Histogram, Gauge } from 'prom-client';

const requestCounter = new Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status']
});

const responseTime = new Histogram({
  name: 'http_request_duration_seconds',
  help: 'HTTP request duration in seconds',
  labelNames: ['method', 'route']
});

// ä½¿ç”¨ä¸­é—´ä»¶è®°å½•æŒ‡æ ‡
app.use((req, res, next) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = (Date.now() - start) / 1000;
    requestCounter.inc({
      method: req.method,
      route: req.route?.path || req.path,
      status: res.statusCode
    });
    responseTime.observe({
      method: req.method,
      route: req.route?.path || req.path
    }, duration);
  });
  
  next();
});
```

#### å‘Šè­¦è§„åˆ™

```yaml
groups:
- name: api_alerts
  rules:
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "APIé”™è¯¯ç‡è¿‡é«˜"
      description: "5åˆ†é’Ÿå†…é”™è¯¯ç‡è¶…è¿‡5%"
  
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, http_request_duration_seconds) > 1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "APIå“åº”æ—¶é—´è¿‡é•¿"
      description: "95%åˆ†ä½å“åº”æ—¶é—´è¶…è¿‡1ç§’"
```



## æœ€ä½³å®è·µ

### æœ€ä½³å®è·µ

#### ä»£ç è§„èŒƒ

1. **å‘½åè§„èŒƒ**
```typescript
// å˜é‡ï¼šcamelCase
const userName = 'John';

// å¸¸é‡ï¼šUPPER_SNAKE_CASE
const MAX_RETRY_COUNT = 3;

// ç±»ï¼šPascalCase
class UserService { }

// æ¥å£ï¼šPascalCaseï¼Œå‰ç¼€Iï¼ˆå¯é€‰ï¼‰
interface IUserService { }
```

2. **æ³¨é‡Šè§„èŒƒ**
```typescript
/**
 * åˆ›å»ºç”¨æˆ·
 * @param email - ç”¨æˆ·é‚®ç®±
 * @param password - ç”¨æˆ·å¯†ç 
 * @returns åˆ›å»ºçš„ç”¨æˆ·å¯¹è±¡
 * @throws {Error} å½“é‚®ç®±å·²å­˜åœ¨æ—¶æŠ›å‡ºé”™è¯¯
 */
async function createUser(
  email: string, 
  password: string
): Promise<User> {
  // å®ç°
}
```

#### é”™è¯¯å¤„ç†

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
class AppError extends Error {
  constructor(
    public statusCode: number,
    public message: string,
    public isOperational = true
  ) {
    super(message);
    this.name = this.constructor.name;
    Error.captureStackTrace(this, this.constructor);
  }
}

// ä½¿ç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use((err: Error, req: Request, res: Response, next: NextFunction) => {
  if (err instanceof AppError) {
    return res.status(err.statusCode).json({
      success: false,
      error: err.message
    });
  }
  
  // è®°å½•æœªé¢„æœŸçš„é”™è¯¯
  logger.error('Unexpected error:', err);
  
  return res.status(500).json({
    success: false,
    error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  });
});
```

#### æ—¥å¿—è®°å½•

```typescript
// ç»“æ„åŒ–æ—¥å¿—
import winston from 'winston';

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

// ä½¿ç”¨æ—¥å¿—
logger.info('User created', { userId: user.id, email: user.email });
logger.error('Database connection failed', { error: error.message });
```


## ç›¸å…³æ–‡æ¡£

- [ğŸ”– YYCÂ³ ç³»ç»Ÿæ‰©å®¹æ¶æ„æ–‡æ¡£](YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»/04-YYC3-Cater--æ¶æ„ç±»-ç³»ç»Ÿæ‰©å®¹æ¶æ„æ–‡æ¡£.md) - YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»
- [YYCÂ³èŠ‚ç‚¹æ‰§è¡Œæ€»ç»“æŠ¥å‘Š](YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»/07-YYC3-Cater--æ¶æ„ç±»-èŠ‚ç‚¹æ‰§è¡Œæ€»ç»“.md) - YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»
- [YYCÂ³èŠ‚ç‚¹æ‰§è¡Œè®¡åˆ’](YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»/05-YYC3-Cater--æ¶æ„ç±»-èŠ‚ç‚¹æ‰§è¡Œè®¡åˆ’.md) - YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»
- [YYCÂ³é¤é¥®å¹³å° - èŠ‚ç‚¹æ§åˆ¶æ¨è¿›è·¯çº¿å›¾](YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»/06-YYC3-Cater--æ¶æ„ç±»-èŠ‚ç‚¹æ§åˆ¶æ¨è¿›è·¯çº¿å›¾.md) - YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»
- [YYCÂ³é¤é¥®å¹³å° - çœŸå®è¿›åº¦è¿½è¸ªç³»ç»Ÿ](YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»/08-YYC3-Cater--æ¶æ„ç±»-çœŸå®è¿›åº¦è¿½è¸ªç³»ç»Ÿ.md) - YYC3-Cater-è¿ç»´è¿è¥/æ¶æ„ç±»
