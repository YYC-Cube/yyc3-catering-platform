---
@file: 104-YYC3-AICP-å¼€å‘é˜¶æ®µ-è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²è„šæœ¬.md
@description: YYC3-AICP å‰ç«¯ã€åç«¯çš„è‡ªåŠ¨åŒ–æ„å»ºã€æ‰“åŒ…ã€éƒ¨ç½²è„šæœ¬ä¸è§„èŒƒ
@author: YanYuCloudCube Team
@version: v1.0.0
@created: 2025-12-29
@updated: 2025-12-29
@status: published
@tags: [å¼€å‘é˜¶æ®µ],[è‡ªåŠ¨åŒ–],[æ„å»ºéƒ¨ç½²]
---

> ***YanYuCloudCube***
> **æ ‡è¯­**ï¼šè¨€å¯è±¡é™ | è¯­æ¢æœªæ¥
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **æ ‡è¯­**ï¼šä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 104-YYC3-AICP-å¼€å‘é˜¶æ®µ-è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²è„šæœ¬

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°YYC3-YYC3-AICP-å¼€å‘é˜¶æ®µ-è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²è„šæœ¬ç›¸å…³å†…å®¹ï¼Œç¡®ä¿é¡¹ç›®æŒ‰ç…§YYCÂ³æ ‡å‡†è§„èŒƒè¿›è¡Œå¼€å‘å’Œå®æ–½ã€‚

## æ ¸å¿ƒå†…å®¹

### 1. èƒŒæ™¯ä¸ç›®æ ‡

#### 1.1 é¡¹ç›®èƒŒæ™¯
YYCÂ³(YanYuCloudCube)-ã€Œæ™ºèƒ½æ•™è‚²ã€é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºã€Œäº”é«˜äº”æ ‡äº”åŒ–ã€ç†å¿µçš„æ™ºèƒ½åŒ–åº”ç”¨ç³»ç»Ÿï¼Œè‡´åŠ›äºæä¾›é«˜è´¨é‡ã€é«˜å¯ç”¨ã€é«˜å®‰å…¨çš„æˆé•¿å®ˆæŠ¤ä½“ç³»ã€‚

#### 1.2 æ–‡æ¡£ç›®æ ‡
- è§„èŒƒè‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²è„šæœ¬ç›¸å…³çš„ä¸šåŠ¡æ ‡å‡†ä¸æŠ€æœ¯è½åœ°è¦æ±‚
- ä¸ºé¡¹ç›®ç›¸å…³äººå‘˜æä¾›æ¸…æ™°çš„å‚è€ƒä¾æ®
- ä¿éšœç›¸å…³æ¨¡å—å¼€å‘ã€å®æ–½ã€è¿ç»´çš„ä¸€è‡´æ€§ä¸è§„èŒƒæ€§

### 2. è®¾è®¡åŸåˆ™

#### 2.1 äº”é«˜åŸåˆ™
- **é«˜å¯ç”¨æ€§**ï¼šç¡®ä¿ç³»ç»Ÿ7x24å°æ—¶ç¨³å®šè¿è¡Œ
- **é«˜æ€§èƒ½**ï¼šä¼˜åŒ–å“åº”æ—¶é—´å’Œå¤„ç†èƒ½åŠ›
- **é«˜å®‰å…¨æ€§**ï¼šä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œéšç§å®‰å…¨
- **é«˜æ‰©å±•æ€§**ï¼šæ”¯æŒä¸šåŠ¡å¿«é€Ÿæ‰©å±•
- **é«˜å¯ç»´æŠ¤æ€§**ï¼šä¾¿äºåç»­ç»´æŠ¤å’Œå‡çº§

#### 2.2 äº”æ ‡ä½“ç³»
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„æŠ€æœ¯å’Œæµç¨‹æ ‡å‡†
- **è§„èŒƒåŒ–**ï¼šä¸¥æ ¼çš„å¼€å‘å’Œç®¡ç†è§„èŒƒ
- **è‡ªåŠ¨åŒ–**ï¼šæé«˜å¼€å‘æ•ˆç‡å’Œè´¨é‡
- **æ™ºèƒ½åŒ–**ï¼šåˆ©ç”¨AIæŠ€æœ¯æå‡èƒ½åŠ›
- **å¯è§†åŒ–**ï¼šç›´è§‚çš„ç›‘æ§å’Œç®¡ç†ç•Œé¢

#### 2.3 äº”åŒ–æ¶æ„
- **æµç¨‹åŒ–**ï¼šæ ‡å‡†åŒ–çš„å¼€å‘æµç¨‹
- **æ–‡æ¡£åŒ–**ï¼šå®Œå–„çš„æ–‡æ¡£ä½“ç³»
- **å·¥å…·åŒ–**ï¼šé«˜æ•ˆçš„å¼€å‘å·¥å…·é“¾
- **æ•°å­—åŒ–**ï¼šæ•°æ®é©±åŠ¨çš„å†³ç­–
- **ç”Ÿæ€åŒ–**ï¼šå¼€æ”¾çš„ç”Ÿæ€ç³»ç»Ÿ

### 3. è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²è„šæœ¬

#### 3.1 æ„å»ºè‡ªåŠ¨åŒ–è§„èŒƒ

##### 3.1.1 å‰ç«¯æ„å»ºè§„èŒƒ

**æ„å»ºå·¥å…·é…ç½®**
- ä½¿ç”¨ Next.js 14+ ä½œä¸ºå‰ç«¯æ¡†æ¶
- ä½¿ç”¨ pnpm ä½œä¸ºåŒ…ç®¡ç†å™¨
- Node.js ç‰ˆæœ¬ï¼š18.x

**æ„å»ºå‘½ä»¤**
```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘ç¯å¢ƒæ„å»º
pnpm run build:dev

# ç”Ÿäº§ç¯å¢ƒæ„å»º
pnpm run build:prod

# ç±»å‹æ£€æŸ¥
pnpm run type-check

# ä»£ç æ ¼å¼åŒ–
pnpm run format

# ä»£ç è´¨é‡æ£€æŸ¥
pnpm run lint
```

**æ„å»ºäº§ç‰©è§„èŒƒ**
- è¾“å‡ºç›®å½•ï¼š`frontend/dist/`
- é™æ€èµ„æºï¼š`frontend/dist/static/`
- æ„å»ºäº§ç‰©å¿…é¡»åŒ…å«ï¼š
  - HTML æ–‡ä»¶
  - JavaScript æ–‡ä»¶ï¼ˆå‹ç¼©ã€æ··æ·†ï¼‰
  - CSS æ–‡ä»¶ï¼ˆå‹ç¼©ï¼‰
  - é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€å­—ä½“ç­‰ï¼‰

##### 3.1.2 åç«¯æ„å»ºè§„èŒƒ

**æ„å»ºå·¥å…·é…ç½®**
- ä½¿ç”¨ Bun ä½œä¸ºè¿è¡Œæ—¶å’Œæ„å»ºå·¥å…·
- TypeScript ç‰ˆæœ¬ï¼š5.0+
- ä¾èµ–ç®¡ç†ï¼šBun lockfile

**æ„å»ºå‘½ä»¤**
```bash
# å®‰è£…ä¾èµ–
bun install --frozen-lockfile

# å¼€å‘ç¯å¢ƒæ„å»º
bun run build:dev

# ç”Ÿäº§ç¯å¢ƒæ„å»º
bun run build

# ç±»å‹æ£€æŸ¥
bun run type-check

# ä»£ç æ ¼å¼åŒ–
bun run format

# ä»£ç è´¨é‡æ£€æŸ¥
bun run lint
```

**æ„å»ºäº§ç‰©è§„èŒƒ**
- è¾“å‡ºç›®å½•ï¼š`backend/dist/`
- å¿…é¡»åŒ…å«ï¼š
  - ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶
  - TypeScript å£°æ˜æ–‡ä»¶ï¼ˆ.d.tsï¼‰
  - é…ç½®æ–‡ä»¶
  - å¿…è¦çš„ä¾èµ–

#### 3.2 CI/CDæµæ°´çº¿é…ç½®

##### 3.2.1 ä¸»æµæ°´çº¿æ¶æ„

**æµæ°´çº¿é˜¶æ®µ**
1. ä»£ç è´¨é‡æ£€æŸ¥
2. SonarQube ä»£ç è´¨é‡åˆ†æ
3. å•å…ƒæµ‹è¯•
4. æ„å»º
5. å®‰å…¨æ‰«æ
6. éƒ¨ç½²

**è§¦å‘æ¡ä»¶**
```yaml
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
```

##### 3.2.2 ä»£ç è´¨é‡æ£€æŸ¥

**æ£€æŸ¥é¡¹**
- ä»£ç æ ¼å¼åŒ–æ£€æŸ¥
- ä»£ç è´¨é‡æ£€æŸ¥
- TypeScript ç±»å‹æ£€æŸ¥
- å®‰å…¨å®¡è®¡

**é…ç½®ç¤ºä¾‹**
```yaml
lint-and-format:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'
        cache: 'pnpm'
    
    - name: å®‰è£…ä¾èµ–
      run: npm install -g pnpm && pnpm install
    
    - name: ä»£ç æ ¼å¼æ£€æŸ¥
      run: pnpm run format
    
    - name: ä»£ç è´¨é‡æ£€æŸ¥
      run: pnpm run lint
    
    - name: TypeScript ç±»å‹æ£€æŸ¥
      run: pnpm run type-check
```

##### 3.2.3 SonarQube ä»£ç è´¨é‡åˆ†æ

**è´¨é‡é—¨é…ç½®**
- ä»£ç è¦†ç›–ç‡ï¼šâ‰¥ 80%
- ä»£ç é‡å¤ç‡ï¼šâ‰¤ 3%
- ä»£ç å¼‚å‘³ï¼šâ‰¤ 5
- å®‰å…¨çƒ­ç‚¹ï¼š0

**é…ç½®ç¤ºä¾‹**
```yaml
sonarqube-analysis:
  runs-on: ubuntu-latest
  needs: lint-and-format
  steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'
        cache: 'pnpm'
    
    - name: å®‰è£…ä¾èµ–
      run: npm install -g pnpm && pnpm install
    
    - name: è¿è¡Œæµ‹è¯•è·å–è¦†ç›–ç‡æŠ¥å‘Š
      run: pnpm run test:coverage
    
    - name: SonarQube æ‰«æ
      uses: SonarSource/sonarqube-scan-action@master
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
    
    - name: ç­‰å¾…è´¨é‡é—¨ç»“æœ
      uses: SonarSource/sonarqube-quality-gate-action@master
      timeout-minutes: 5
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
```

##### 3.2.4 å•å…ƒæµ‹è¯•

**æµ‹è¯•æ¡†æ¶**
- å‰ç«¯ï¼šJest / Vitest
- åç«¯ï¼šBun Test

**æµ‹è¯•è¦æ±‚**
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼šâ‰¥ 80%
- å…³é”®è·¯å¾„è¦†ç›–ç‡ï¼š100%
- æ‰€æœ‰æµ‹è¯•å¿…é¡»é€šè¿‡

**é…ç½®ç¤ºä¾‹**
```yaml
test:
  runs-on: ubuntu-latest
  needs: sonarqube-analysis
  steps:
    - uses: actions/checkout@v4
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'
        cache: 'pnpm'
    
    - name: å®‰è£…ä¾èµ–
      run: npm install -g pnpm && pnpm install
    
    - name: è¿è¡Œå•å…ƒæµ‹è¯•
      run: pnpm run test:unit
    
    - name: ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
      run: pnpm run test:coverage
    
    - name: ä¸Šä¼ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
      uses: actions/upload-artifact@v4
      with:
        name: test-coverage
        path: coverage/
```

##### 3.2.5 æ„å»ºé˜¶æ®µ

**åç«¯æ„å»º**
```yaml
build-backend:
  runs-on: ubuntu-latest
  needs: test
  steps:
    - uses: actions/checkout@v4
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'
        cache: 'pnpm'
    
    - name: å®‰è£…ä¾èµ–
      run: npm install -g pnpm && pnpm install
    
    - name: æ„å»ºåç«¯
      run: pnpm run build:backend
    
    - name: ä¸Šä¼ åç«¯æ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: backend-build
        path: dist/backend/
```

**å‰ç«¯æ„å»º**
```yaml
build-frontend:
  runs-on: ubuntu-latest
  needs: test
  steps:
    - uses: actions/checkout@v4
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'
        cache: 'pnpm'
    
    - name: å®‰è£…ä¾èµ–
      run: npm install -g pnpm && pnpm install
    
    - name: æ„å»ºå‰ç«¯
      run: pnpm run build:frontend
    
    - name: ä¸Šä¼ å‰ç«¯æ„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: frontend-build
        path: frontend/dist/
```

##### 3.2.6 å®‰å…¨æ‰«æ

**æ‰«æé¡¹**
- ä»£ç å®‰å…¨æ‰«æ
- ä¾èµ–æ¼æ´æ‰«æ
- å®¹å™¨é•œåƒæ‰«æ

**é…ç½®ç¤ºä¾‹**
```yaml
security-scan:
  runs-on: ubuntu-latest
  needs: [ build-backend, build-frontend ]
  steps:
    - uses: actions/checkout@v4
    
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'
        cache: 'pnpm'
    
    - name: å®‰è£…ä¾èµ–
      run: npm install -g pnpm && pnpm install
    
    # ä»£ç å®‰å…¨æ‰«æ
    - name: å®‰è£…å®‰å…¨æ‰«æå·¥å…·
      run: pnpm add -D eslint-plugin-security
    
    - name: è¿è¡Œä»£ç å®‰å…¨æ‰«æ
      run: pnpm run lint:security
    
    # å®¹å™¨é•œåƒæ‰«æ
    - name: è®¾ç½® Docker Buildx
      uses: docker/setup-buildx-action@v2
    
    - name: æ„å»ºåç«¯Dockeré•œåƒ
      uses: docker/build-push-action@v4
      with:
        context: ./backend
        push: false
        load: true
        tags: yyc3-backend:latest
        cache-from: type=gha
        cache-to: type=gha,mode=max
    
    - name: è¿è¡ŒTrivyæ¼æ´æ‰«æ
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: 'yyc3-backend:latest'
        format: 'sarif'
        output: 'trivy-results.sarif'
        severity: 'CRITICAL,HIGH'
    
    - name: ä¸Šä¼ Trivyæ‰«æç»“æœåˆ°GitHub Security tab
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: 'trivy-results.sarif'
      if: always()
```

#### 3.3 éƒ¨ç½²è‡ªåŠ¨åŒ–

##### 3.3.1 ç¯å¢ƒé…ç½®

**ç¯å¢ƒå®šä¹‰**
- å¼€å‘ç¯å¢ƒï¼ˆdevelopmentï¼‰ï¼šå¼€å‘ã€æµ‹è¯•
- æµ‹è¯•ç¯å¢ƒï¼ˆtestingï¼‰ï¼šé›†æˆæµ‹è¯•ã€éªŒæ”¶æµ‹è¯•
- é¢„å‘å¸ƒç¯å¢ƒï¼ˆstagingï¼‰ï¼šç”Ÿäº§å‰éªŒè¯
- ç”Ÿäº§ç¯å¢ƒï¼ˆproductionï¼‰ï¼šæ­£å¼è¿è¡Œ

**ç¯å¢ƒå˜é‡ç®¡ç†**
- ä½¿ç”¨ GitHub Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯
- ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ Secrets
- ç¯å¢ƒå˜é‡å‘½åè§„èŒƒï¼š`{ENV}_{SERVICE}_{KEY}`

##### 3.3.2 å¼€å‘ç¯å¢ƒéƒ¨ç½²

**éƒ¨ç½²ç­–ç•¥**
- è‡ªåŠ¨éƒ¨ç½²ï¼šdevelop åˆ†æ”¯æ¨é€æ—¶è‡ªåŠ¨éƒ¨ç½²
- éƒ¨ç½²ç›®æ ‡ï¼šå¼€å‘ç¯å¢ƒå‘½åç©ºé—´
- å‰¯æœ¬æ•°ï¼š2

**é…ç½®ç¤ºä¾‹**
```yaml
deploy-dev:
  name: Deploy to Development Environment
  runs-on: ubuntu-latest
  needs: [security-scan]
  if: github.ref == 'refs/heads/develop'
  environment:
    name: development
    url: https://dev.yyc3-catering.com
  steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Helm
      uses: azure/setup-helm@v3
      with:
        version: v3.9.0
    
    - name: Set up Kubernetes context
      uses: azure/k8s-set-context@v3
      with:
        kubeconfig: ${{ secrets.KUBE_CONFIG_DEV }}
    
    - name: Deploy API Gateway with Helm
      run: |
        helm upgrade --install yyc3-api-gateway ./helm \
          --namespace yyc3-dev \
          --create-namespace \
          --set gateway.image.tag=${{ github.sha }} \
          --set gateway.replicaCount=2 \
          --set environment=development \
          --set database.host=$DB_HOST \
          --set database.port=$DB_PORT \
          --set database.name=$DB_NAME \
          --set database.user=$DB_USER \
          --set database.password=$DB_PASSWORD \
          --set redis.host=$REDIS_HOST \
          --set redis.port=$REDIS_PORT \
          --set jwt.secret=$JWT_SECRET
```

##### 3.3.3 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**éƒ¨ç½²ç­–ç•¥**
- æ‰‹åŠ¨å®¡æ‰¹ï¼šéœ€è¦äººå·¥å®¡æ‰¹æ‰èƒ½éƒ¨ç½²
- éƒ¨ç½²ç›®æ ‡ï¼šç”Ÿäº§ç¯å¢ƒå‘½åç©ºé—´
- å‰¯æœ¬æ•°ï¼š3
- è‡ªåŠ¨æ‰©ç¼©å®¹ï¼šå¯ç”¨

**é…ç½®ç¤ºä¾‹**
```yaml
deploy-prod:
  name: Deploy to Production Environment
  runs-on: ubuntu-latest
  needs: [security-scan]
  if: github.ref == 'refs/heads/main'
  environment:
    name: production
    url: https://api.yyc3-catering.com
  steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Backup database before migration
      run: |
        kubectl run backup-job --rm -i --restart=Never \
          --image=yyc3-backend:${{ github.sha }} \
          --namespace=yyc3-prod \
          --env="DB_HOST=$DB_HOST" \
          --env="DB_PORT=$DB_PORT" \
          --env="DB_NAME=$DB_NAME" \
          --env="DB_USER=$DB_USER" \
          --env="DB_PASSWORD=$DB_PASSWORD" \
          -- npm run backup
    
    - name: Run database migrations
      run: |
        kubectl run migration-job --rm -i --restart=Never \
          --image=yyc3-backend:${{ github.sha }} \
          --namespace=yyc3-prod \
          --env="DB_HOST=$DB_HOST" \
          --env="DB_PORT=$DB_PORT" \
          --env="DB_NAME=$DB_NAME" \
          --env="DB_USER=$DB_USER" \
          --env="DB_PASSWORD=$DB_PASSWORD" \
          -- npm run migrate
    
    - name: Deploy API Gateway with Helm
      run: |
        helm upgrade --install yyc3-api-gateway ./helm \
          --namespace yyc3-prod \
          --create-namespace \
          --set gateway.image.tag=${{ github.sha }} \
          --set gateway.replicaCount=3 \
          --set environment=production \
          --set database.host=$DB_HOST \
          --set database.port=$DB_PORT \
          --set database.name=$DB_NAME \
          --set database.user=$DB_USER \
          --set database.password=$DB_PASSWORD \
          --set redis.host=$REDIS_HOST \
          --set redis.port=$REDIS_PORT \
          --set jwt.secret=$JWT_SECRET \
          --set resources.requests.cpu=500m \
          --set resources.requests.memory=512Mi \
          --set resources.limits.cpu=1000m \
          --set resources.limits.memory=1Gi \
          --set autoscaling.enabled=true \
          --set autoscaling.minReplicas=3 \
          --set autoscaling.maxReplicas=10
    
    - name: Rollback on failure
      if: failure()
      run: |
        helm rollback yyc3-api-gateway -n yyc3-prod
```

##### 3.3.4 Helm éƒ¨ç½²è„šæœ¬

**è„šæœ¬åŠŸèƒ½**
- æ£€æŸ¥ Helm å’Œ Kubernetes è¿æ¥
- åˆ›å»ºå‘½åç©ºé—´
- æ›´æ–° Chart ä¾èµ–
- éƒ¨ç½²æˆ–å‡çº§ Release
- æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

**è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CHART_DIR="${SCRIPT_DIR}/charts/yyc3-catering-platform"
RELEASE_NAME="${RELEASE_NAME:-yyc3-test}"
NAMESPACE="${NAMESPACE:-test}"
VALUES_FILE="${VALUES_FILE:-${CHART_DIR}/values-test.yaml}"

echo "=== YYCÂ³ é¤é¥®å¹³å° Helm éƒ¨ç½²è„šæœ¬ ==="
echo ""
echo "é…ç½®ä¿¡æ¯:"
echo "  Release åç§°: ${RELEASE_NAME}"
echo "  å‘½åç©ºé—´: ${NAMESPACE}"
echo "  Values æ–‡ä»¶: ${VALUES_FILE}"
echo ""

echo "1. æ£€æŸ¥ Helm æ˜¯å¦å®‰è£…..."
if ! command -v helm &> /dev/null; then
    echo "âŒ Helm æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Helm"
    echo "   å®‰è£…å‘½ä»¤: brew install helm"
    exit 1
fi
echo "âœ… Helm å·²å®‰è£…: $(helm version --short)"
echo ""

echo "2. æ£€æŸ¥ Kubernetes è¿æ¥..."
if ! kubectl cluster-info &> /dev/null; then
    echo "âŒ æ— æ³•è¿æ¥åˆ° Kubernetes é›†ç¾¤"
    echo "   è¯·ç¡®ä¿ kubectl é…ç½®æ­£ç¡®"
    exit 1
fi
echo "âœ… Kubernetes è¿æ¥æ­£å¸¸"
echo ""

echo "3. åˆ›å»ºå‘½åç©ºé—´ (å¦‚æœä¸å­˜åœ¨)..."
if ! kubectl get namespace "${NAMESPACE}" &> /dev/null; then
    echo "   åˆ›å»ºå‘½åç©ºé—´: ${NAMESPACE}"
    kubectl create namespace "${NAMESPACE}"
else
    echo "   å‘½åç©ºé—´å·²å­˜åœ¨: ${NAMESPACE}"
fi
echo ""

echo "4. æ›´æ–° Chart ä¾èµ–..."
helm dependency update "${CHART_DIR}"
echo "âœ… ä¾èµ–æ›´æ–°å®Œæˆ"
echo ""

echo "5. æ£€æŸ¥ Release æ˜¯å¦å·²å­˜åœ¨..."
if helm status "${RELEASE_NAME}" -n "${NAMESPACE}" &> /dev/null; then
    echo "âš ï¸  Release å·²å­˜åœ¨ï¼Œå‡†å¤‡å‡çº§..."
    helm upgrade "${RELEASE_NAME}" "${CHART_DIR}" \
        -f "${VALUES_FILE}" \
        -n "${NAMESPACE}" \
        --wait \
        --timeout 10m
    echo "âœ… Release å‡çº§æˆåŠŸ"
else
    echo "ğŸ“¦ å‡†å¤‡å®‰è£…æ–° Release..."
    helm install "${RELEASE_NAME}" "${CHART_DIR}" \
        -f "${VALUES_FILE}" \
        -n "${NAMESPACE}" \
        --wait \
        --timeout 10m
    echo "âœ… Release å®‰è£…æˆåŠŸ"
fi
echo ""

echo "6. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€..."
helm status "${RELEASE_NAME}" -n "${NAMESPACE}"
echo ""

echo "7. æŸ¥çœ‹ Pod çŠ¶æ€..."
kubectl get pods -n "${NAMESPACE}" -l "app.kubernetes.io/instance=${RELEASE_NAME}"
echo ""

echo "8. æŸ¥çœ‹ Service çŠ¶æ€..."
kubectl get svc -n "${NAMESPACE}" -l "app.kubernetes.io/instance=${RELEASE_NAME}"
echo ""

echo "=== âœ… éƒ¨ç½²å®Œæˆ ==="
echo ""
echo "ğŸ“‹ éƒ¨ç½²æ‘˜è¦:"
echo "   - Release åç§°: ${RELEASE_NAME}"
echo "   - å‘½åç©ºé—´: ${NAMESPACE}"
echo "   - çŠ¶æ€: å·²éƒ¨ç½²"
echo ""
echo "ğŸ” å¸¸ç”¨å‘½ä»¤:"
echo "   æŸ¥çœ‹çŠ¶æ€: helm status ${RELEASE_NAME} -n ${NAMESPACE}"
echo "   æŸ¥çœ‹ Pod: kubectl get pods -n ${NAMESPACE}"
echo "   æŸ¥çœ‹æ—¥å¿—: kubectl logs -n ${NAMESPACE} -l app.kubernetes.io/instance=${RELEASE_NAME} --tail=100"
echo "   å¸è½½: helm uninstall ${RELEASE_NAME} -n ${NAMESPACE}"
```

#### 3.4 Docker é•œåƒæ„å»º

##### 3.4.1 å¤šé˜¶æ®µæ„å»ºè§„èŒƒ

**æ„å»ºé˜¶æ®µ**
1. builderï¼šä¾èµ–å®‰è£…å’Œæ„å»º
2. depsï¼šç”Ÿäº§ä¾èµ–å®‰è£…
3. productionï¼šæœ€ç»ˆé•œåƒ

**Dockerfile ç¤ºä¾‹**
```dockerfile
# YYCÂ³ APIç½‘å…³ Dockerfile
# å¤šé˜¶æ®µæ„å»ºï¼Œä¼˜åŒ–é•œåƒå¤§å°å’Œå®‰å…¨æ€§

# æ„å»ºé˜¶æ®µ - ä½¿ç”¨Bunè¿›è¡Œä¾èµ–å®‰è£…å’Œæ„å»º
FROM oven/bun:1-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=development

# å¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼ˆå…ˆå¤åˆ¶è¿™äº›æ–‡ä»¶å¯ä»¥åˆ©ç”¨Dockerç¼“å­˜ï¼‰
COPY package.json bun.lockb ./

# å®‰è£…ä¾èµ–ï¼ˆåŒ…æ‹¬å¼€å‘ä¾èµ–ï¼‰
RUN bun install --frozen-lockfile --prod=false

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN bun run build

# ç”Ÿäº§ä¾èµ–å®‰è£…é˜¶æ®µ - åªå®‰è£…ç”Ÿäº§ä¾èµ–
FROM oven/bun:1-alpine AS deps

WORKDIR /app

ENV NODE_ENV=production

COPY package.json bun.lockb ./

# åªå®‰è£…ç”Ÿäº§ä¾èµ–ï¼Œå‡å°‘é•œåƒå¤§å°
RUN bun install --frozen-lockfile --production

# ç”Ÿäº§é˜¶æ®µ
FROM oven/bun:1-alpine AS production

# å®‰å…¨é…ç½®
RUN addgroup -g 1001 -S yyc3 && \
    adduser -S yyc3 -u 1001 -G yyc3

# å®‰è£…å¿…è¦çš„ç³»ç»ŸåŒ…ï¼ˆæœ€å°åŒ–å®‰è£…ï¼‰
RUN apk add --no-cache \
    curl=7.88.1-r1 \
    dumb-init=1.2.5-r1

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=production
ENV PORT=8080
ENV LOG_LEVEL=info
ENV LOG_DIR=/app/logs

# å¤åˆ¶ç”Ÿäº§ä¾èµ–
COPY --from=deps --chown=yyc3:yyc3 /app/node_modules ./node_modules

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder --chown=yyc3:yyc3 /app/dist ./dist

# å¤åˆ¶å¿…è¦çš„é…ç½®æ–‡ä»¶
COPY --from=builder --chown=yyc3:yyc3 /app/package.json ./package.json
COPY --from=builder --chown=yyc3:yyc3 /app/.env.example ./

# åˆ›å»ºå¿…è¦çš„ç›®å½•
RUN mkdir -p $LOG_DIR && \
    chown -R yyc3:yyc3 $LOG_DIR && \
    chmod 755 $LOG_DIR

# åˆ‡æ¢åˆ°érootç”¨æˆ·
USER yyc3

# æš´éœ²ç«¯å£
EXPOSE $PORT

# å¥åº·æ£€æŸ¥ - æ›´è¯¦ç»†çš„å¥åº·æ£€æŸ¥é…ç½®
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD curl -s -f -X GET http://localhost:$PORT/health \
  && echo "OK" || exit 1

# ä½¿ç”¨dumb-initä½œä¸ºPID 1ï¼Œç¡®ä¿ä¿¡å·æ­£ç¡®å¤„ç†
ENTRYPOINT ["dumb-init", "--"]

# å¯åŠ¨åº”ç”¨
CMD ["bun", "run", "start"]
```

##### 3.4.2 é•œåƒå®‰å…¨è§„èŒƒ

**å®‰å…¨è¦æ±‚**
- ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ
- æœ€å°åŒ–ç³»ç»ŸåŒ…å®‰è£…
- ä½¿ç”¨ Alpine Linux åŸºç¡€é•œåƒ
- å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
- æ‰«æé•œåƒæ¼æ´

**å®‰å…¨æ£€æŸ¥**
```bash
# ä½¿ç”¨ Trivy æ‰«æé•œåƒ
trivy image yyc3-backend:latest

# ä½¿ç”¨ Docker Scout æ‰«æ
docker scout quickview yyc3-backend:latest
```

#### 3.5 æœ€ä½³å®è·µ

##### 3.5.1 æ„å»ºä¼˜åŒ–

**ä¾èµ–ç¼“å­˜**
- ä½¿ç”¨ Docker å±‚ç¼“å­˜
- ä½¿ç”¨ GitHub Actions ç¼“å­˜
- åˆ†ç¦»ä¾èµ–å®‰è£…å’Œä»£ç å¤åˆ¶

**æ„å»ºåŠ é€Ÿ**
- å¹¶è¡Œæ„å»º
- å¢é‡æ„å»º
- ç¼“å­˜æ„å»ºäº§ç‰©

##### 3.5.2 éƒ¨ç½²ä¼˜åŒ–

**æ»šåŠ¨æ›´æ–°**
- ä½¿ç”¨ Kubernetes æ»šåŠ¨æ›´æ–°
- è®¾ç½®å°±ç»ªæ¢é’ˆ
- é…ç½®ä¼˜é›…åœæœº

**å›æ»šç­–ç•¥**
- è‡ªåŠ¨å›æ»šï¼šéƒ¨ç½²å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
- æ‰‹åŠ¨å›æ»šï¼šæä¾›å¿«é€Ÿå›æ»šå‘½ä»¤
- ç‰ˆæœ¬ä¿ç•™ï¼šä¿ç•™æœ€è¿‘ N ä¸ªç‰ˆæœ¬

##### 3.5.3 ç›‘æ§ä¸å‘Šè­¦

**éƒ¨ç½²ç›‘æ§**
- éƒ¨ç½²çŠ¶æ€ç›‘æ§
- Pod å¥åº·çŠ¶æ€ç›‘æ§
- èµ„æºä½¿ç”¨ç›‘æ§

**å‘Šè­¦é…ç½®**
- éƒ¨ç½²å¤±è´¥å‘Šè­¦
- Pod å¼‚å¸¸å‘Šè­¦
- èµ„æºè¶…é™å‘Šè­¦

##### 3.5.4 å®‰å…¨æœ€ä½³å®è·µ

**å¯†é’¥ç®¡ç†**
- ä½¿ç”¨ Kubernetes Secrets
- ä½¿ç”¨ GitHub Secrets
- å®šæœŸè½®æ¢å¯†é’¥
- æœ€å°æƒé™åŸåˆ™

**ç½‘ç»œå®‰å…¨**
- ä½¿ç”¨ Network Policy
- é™åˆ¶ Pod é—´é€šä¿¡
- ä½¿ç”¨ TLS åŠ å¯†

---

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for the Future***ã€
> ã€Œ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***ã€
